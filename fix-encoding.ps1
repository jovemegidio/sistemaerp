# Script para corrigir caracteres especiais corrompidos
# Encoding fix for Portuguese characters

$basePath = "c:\Users\egidio\Documents\Sistema - ALUFORCE - V.2"

# Mapeamento de caracteres corrompidos para corretos
$replacements = @{
    'Gest�o' = 'Gestão'
    'gest�o' = 'gestão'
    'Or�amentos' = 'Orçamentos'
    'or�amentos' = 'orçamentos'
    'Log�stica' = 'Logística'
    'log�stica' = 'logística'
    'expedi��o' = 'expedição'
    'Produ��o' = 'Produção'
    'produ��o' = 'produção'
    'configura��o' = 'configuração'
    'Configura��o' = 'Configuração'
    'dispon�vel' = 'disponível'
    'ass�ncrona' = 'assíncrona'
    'M�dulo' = 'Módulo'
    'm�dulo' = 'módulo'
    'informa��es' = 'informações'
    'Informa��es' = 'Informações'
    'fun��o' = 'função'
    'Fun��o' = 'Função'
    'posi��o' = 'posição'
    'Posi��o' = 'Posição'
    'cria��o' = 'criação'
    'altera��o' = 'alteração'
    'exibi��o' = 'exibição'
    'navega��o' = 'navegação'
    'Navega��o' = 'Navegação'
    'op��es' = 'opções'
    'Op��es' = 'Opções'
    'op��o' = 'opção'
    'atualiza��o' = 'atualização'
    'Atualiza��o' = 'Atualização'
    'c�digo' = 'código'
    'C�digo' = 'Código'
    'n�mero' = 'número'
    'N�mero' = 'Número'
    'pre�o' = 'preço'
    'Pre�o' = 'Preço'
    'prote��o' = 'proteção'
    'valida��o' = 'validação'
    'verifica��o' = 'verificação'
    'comunica��o' = 'comunicação'
    'inser��o' = 'inserção'
    'execu��o' = 'execução'
    'exce��o' = 'exceção'
    'a��o' = 'ação'
    'A��o' = 'Ação'
    'a��es' = 'ações'
    'A��es' = 'Ações'
    'notifica��es' = 'notificações'
    'Notifica��es' = 'Notificações'
    'notifica��o' = 'notificação'
    'descri��o' = 'descrição'
    'Descri��o' = 'Descrição'
    'solicita��o' = 'solicitação'
    'aprova��o' = 'aprovação'
    'permiss�es' = 'permissões'
    'Permiss�es' = 'Permissões'
    'permiss�o' = 'permissão'
    'sess�o' = 'sessão'
    'Sess�o' = 'Sessão'
    'vers�o' = 'versão'
    'Vers�o' = 'Versão'
    'solu��o' = 'solução'
    'Solu��o' = 'Solução'
    'resolu��o' = 'resolução'
    'dimens�o' = 'dimensão'
    'extens�o' = 'extensão'
    'impress�o' = 'impressão'
    'Impress�o' = 'Impressão'
    'emiss�o' = 'emissão'
    'Emiss�o' = 'Emissão'
    'transmiss�o' = 'transmissão'
    'fatura��o' = 'faturação'
    'negocia��o' = 'negociação'
    'observa��o' = 'observação'
    'Observa��o' = 'Observação'
    'observa��es' = 'observações'
    'condi��es' = 'condições'
    'Condi��es' = 'Condições'
    'condi��o' = 'condição'
    'preven��o' = 'prevenção'
    'manuten��o' = 'manutenção'
    'Manuten��o' = 'Manutenção'
    'instala��o' = 'instalação'
    'Instala��o' = 'Instalação'
    'finaliza��o' = 'finalização'
    'inicializa��o' = 'inicialização'
    'autentica��o' = 'autenticação'
    'autoriza��o' = 'autorização'
    'exclus�o' = 'exclusão'
    'inclus�o' = 'inclusão'
    'conclus�o' = 'conclusão'
    'divis�o' = 'divisão'
    'revis�o' = 'revisão'
    'vis�o' = 'visão'
    'decis�o' = 'decisão'
    'provis�o' = 'provisão'
    'comiss�o' = 'comissão'
    'Comiss�o' = 'Comissão'
    'comiss�es' = 'comissões'
    'dimens�es' = 'dimensões'
    'posi��es' = 'posições'
    'altera��es' = 'alterações'
    'atualiza��es' = 'atualizações'
    'solicita��es' = 'solicitações'
    'opera��o' = 'operação'
    'Opera��o' = 'Operação'
    'opera��es' = 'operações'
    'Opera��es' = 'Operações'
    'transa��o' = 'transação'
    'transa��es' = 'transações'
    'integra��o' = 'integração'
    'Integra��o' = 'Integração'
    'importa��o' = 'importação'
    'Importa��o' = 'Importação'
    'exporta��o' = 'exportação'
    'Exporta��o' = 'Exportação'
    'migra��o' = 'migração'
    'classifica��o' = 'classificação'
    'Classifica��o' = 'Classificação'
    'organiza��o' = 'organização'
    'Organiza��o' = 'Organização'
    'visualiza��o' = 'visualização'
    'Visualiza��o' = 'Visualização'
    'localiza��o' = 'localização'
    'Localiza��o' = 'Localização'
    'personaliza��o' = 'personalização'
    'otimiza��o' = 'otimização'
    'sincroniza��o' = 'sincronização'
    'padroniza��o' = 'padronização'
    '�ltimo' = 'último'
    '�ltima' = 'última'
    '�ltimos' = 'últimos'
    'pr�ximo' = 'próximo'
    'Pr�ximo' = 'Próximo'
    'pr�xima' = 'próxima'
    'necess�rio' = 'necessário'
    'necess�ria' = 'necessária'
    'obrigat�rio' = 'obrigatório'
    'obrigat�ria' = 'obrigatória'
    'tempor�rio' = 'temporário'
    'prim�rio' = 'primário'
    'secund�rio' = 'secundário'
    'hor�rio' = 'horário'
    'Hor�rio' = 'Horário'
    'sal�rio' = 'salário'
    'Sal�rio' = 'Salário'
    'sum�rio' = 'sumário'
    'relat�rio' = 'relatório'
    'Relat�rio' = 'Relatório'
    'relat�rios' = 'relatórios'
    'Relat�rios' = 'Relatórios'
    'coment�rio' = 'comentário'
    'coment�rios' = 'comentários'
    'formul�rio' = 'formulário'
    'Formul�rio' = 'Formulário'
    'formul�rios' = 'formulários'
    'calend�rio' = 'calendário'
    'Calend�rio' = 'Calendário'
    'invent�rio' = 'inventário'
    'Invent�rio' = 'Inventário'
    'funcion�rio' = 'funcionário'
    'Funcion�rio' = 'Funcionário'
    'funcion�rios' = 'funcionários'
    'Funcion�rios' = 'Funcionários'
    'usu�rio' = 'usuário'
    'Usu�rio' = 'Usuário'
    'usu�rios' = 'usuários'
    'Usu�rios' = 'Usuários'
    'neg�cio' = 'negócio'
    'neg�cios' = 'negócios'
    'servi�o' = 'serviço'
    'Servi�o' = 'Serviço'
    'servi�os' = 'serviços'
    'Servi�os' = 'Serviços'
    'pre�os' = 'preços'
    'c�digos' = 'códigos'
    'n�meros' = 'números'
    'per�odo' = 'período'
    'Per�odo' = 'Período'
    'per�odos' = 'períodos'
    'hist�rico' = 'histórico'
    'Hist�rico' = 'Histórico'
    'espec�fico' = 'específico'
    'gen�rico' = 'genérico'
    't�cnico' = 'técnico'
    'T�cnico' = 'Técnico'
    'mec�nico' = 'mecânico'
    'el�trico' = 'elétrico'
    'eletr�nico' = 'eletrônico'
    'autom�tico' = 'automático'
    'Autom�tico' = 'Automático'
    'sint�tico' = 'sintético'
    'anal�tico' = 'analítico'
    'log�stico' = 'logístico'
    'estat�stico' = 'estatístico'
    'diagn�stico' = 'diagnóstico'
    'dom�stico' = 'doméstico'
    'r�pido' = 'rápido'
    'v�lido' = 'válido'
    'inv�lido' = 'inválido'
    's�lido' = 'sólido'
    'l�quido' = 'líquido'
    '�nico' = 'único'
    '�nica' = 'única'
    'p�blico' = 'público'
    'P�blico' = 'Público'
    'econ�mico' = 'econômico'
    'din�mico' = 'dinâmico'
    'acad�mico' = 'acadêmico'
    'm�ximo' = 'máximo'
    'M�ximo' = 'Máximo'
    'm�nimo' = 'mínimo'
    'M�nimo' = 'Mínimo'
    '�timo' = 'ótimo'
    '�ndice' = 'índice'
    '�ndices' = 'índices'
    'Prov�ncia' = 'Província'
    'refer�ncia' = 'referência'
    'Refer�ncia' = 'Referência'
    'refer�ncias' = 'referências'
    'sequ�ncia' = 'sequência'
    'frequ�ncia' = 'frequência'
    'urg�ncia' = 'urgência'
    'emerg�ncia' = 'emergência'
    'tend�ncia' = 'tendência'
    'pot�ncia' = 'potência'
    'dist�ncia' = 'distância'
    'subst�ncia' = 'substância'
    'import�ncia' = 'importância'
    'toler�ncia' = 'tolerância'
    'perman�ncia' = 'permanência'
    'pend�ncia' = 'pendência'
    'pend�ncias' = 'pendências'
    'depend�ncia' = 'dependência'
    'resid�ncia' = 'residência'
    'exist�ncia' = 'existência'
    'consist�ncia' = 'consistência'
    'assist�ncia' = 'assistência'
    'Assist�ncia' = 'Assistência'
    'ger�ncia' = 'gerência'
    'Ger�ncia' = 'Gerência'
    'apar�ncia' = 'aparência'
    'experi�ncia' = 'experiência'
    'influ�ncia' = 'influência'
    'ocorr�ncia' = 'ocorrência'
    'ocorr�ncias' = 'ocorrências'
    'transfer�ncia' = 'transferência'
    'Transfer�ncia' = 'Transferência'
    'transfer�ncias' = 'transferências'
    'confid�ncia' = 'confidência'
    'coincid�ncia' = 'coincidência'
    'correspond�ncia' = 'correspondência'
    'preval�ncia' = 'prevalência'
    'vig�ncia' = 'vigência'
    'ci�ncia' = 'ciência'
    'efici�ncia' = 'eficiência'
    'defici�ncia' = 'deficiência'
    'sufici�ncia' = 'suficiência'
    'insufici�ncia' = 'insuficiência'
    'conveni�ncia' = 'conveniência'
    'evid�ncia' = 'evidência'
    'audi�ncia' = 'audiência'
    'obedi�ncia' = 'obediência'
    'proced�ncia' = 'procedência'
    'concorr�ncia' = 'concorrência'
    'presen�a' = 'presença'
    'Presen�a' = 'Presença'
    'ausen�a' = 'ausência'
    'Ausen�a' = 'Ausência'
    'senten�a' = 'sentença'
    'licen�a' = 'licença'
    'Licen�a' = 'Licença'
    'diferen�a' = 'diferença'
    'Diferen�a' = 'Diferença'
    'prefer�ncia' = 'preferência'
    'confian�a' = 'confiança'
    'seguran�a' = 'segurança'
    'Seguran�a' = 'Segurança'
    'avan�o' = 'avanço'
    'avan�ar' = 'avançar'
    'al�m' = 'além'
    'tamb�m' = 'também'
    'n�o' = 'não'
    'est�' = 'está'
    'Est�' = 'Está'
    's�o' = 'são'
    'S�o' = 'São'
    'ter�' = 'terá'
    'ser�' = 'será'
    'far�' = 'fará'
    'poder�' = 'poderá'
    'dever�' = 'deverá'
    'haver�' = 'haverá'
    'ficar�' = 'ficará'
    'estar�' = 'estará'
    'ter�o' = 'terão'
    'ser�o' = 'serão'
    'far�o' = 'farão'
    'poder�o' = 'poderão'
    'dever�o' = 'deverão'
    'haver�o' = 'haverão'
    'ficar�o' = 'ficarão'
    'estar�o' = 'estarão'
    'ir�' = 'irá'
    'ir�o' = 'irão'
    'v�' = 'vá'
    'vir�' = 'virá'
    'vir�o' = 'virão'
    'j�' = 'já'
    's�' = 'só'
    'a�' = 'aí'
    'sa�da' = 'saída'
    'Sa�da' = 'Saída'
    'ca�xa' = 'caixa'
    'Ca�xa' = 'Caixa'
    'fa�xa' = 'faixa'
    'conte�do' = 'conteúdo'
    'Conte�do' = 'Conteúdo'
    'm�quina' = 'máquina'
    'M�quina' = 'Máquina'
    'm�quinas' = 'máquinas'
    'f�brica' = 'fábrica'
    'F�brica' = 'Fábrica'
    'log�ca' = 'lógica'
    'Log�ca' = 'Lógica'
    'pr�tica' = 'prática'
    'Pr�tica' = 'Prática'
    'pol�tica' = 'política'
    'Pol�tica' = 'Política'
    'est�tica' = 'estática'
    'din�mica' = 'dinâmica'
    'econ�mica' = 'econômica'
    'autom�tica' = 'automática'
    't�cnica' = 'técnica'
    'T�cnica' = 'Técnica'
    'gr�fica' = 'gráfica'
    'Gr�fica' = 'Gráfica'
    'gr�ficos' = 'gráficos'
    'Gr�ficos' = 'Gráficos'
    'gr�fico' = 'gráfico'
    'Gr�fico' = 'Gráfico'
    '�rea' = 'área'
    '�reas' = 'áreas'
    'm�dia' = 'média'
    'M�dia' = 'Média'
    'fam�lia' = 'família'
    'Fam�lia' = 'Família'
    'fam�lias' = 'famílias'
    'mem�ria' = 'memória'
    'categor�a' = 'categoria'
    'Categor�a' = 'Categoria'
    'categor�as' = 'categorias'
    'hist�ria' = 'história'
    'Hist�ria' = 'História'
    'mat�ria' = 'matéria'
    'mat�rias' = 'matérias'
    'Mat�ria' = 'Matéria'
    'mat�ria-prima' = 'matéria-prima'
    'Mat�ria-Prima' = 'Matéria-Prima'
    'mat�rias-primas' = 'matérias-primas'
    'necess�rios' = 'necessários'
    'necess�rias' = 'necessárias'
    'p�gina' = 'página'
    'P�gina' = 'Página'
    'p�ginas' = 'páginas'
    'm�scaras' = 'máscaras'
    'or�amento' = 'orçamento'
    'Or�amento' = 'Orçamento'
    'lan�amento' = 'lançamento'
    'Lan�amento' = 'Lançamento'
    'lan�amentos' = 'lançamentos'
    'itens' = 'itens'
    '�tem' = 'Ítem'
    'item' = 'item'
    'Item' = 'Item'
}

# Encontrar todos os arquivos HTML e JS
$files = Get-ChildItem -Path $basePath -Include *.html, *.js -Recurse -File | Where-Object { 
    $_.FullName -notmatch "node_modules" -and 
    $_.FullName -notmatch "\.git"
}

$filesFixed = 0
$totalReplacements = 0

foreach ($file in $files) {
    try {
        # Ler conteúdo do arquivo como bytes
        $bytes = [System.IO.File]::ReadAllBytes($file.FullName)
        $content = [System.Text.Encoding]::GetEncoding("ISO-8859-1").GetString($bytes)
        
        $originalContent = $content
        $fileReplacements = 0
        
        # Aplicar todas as substituições
        foreach ($key in $replacements.Keys) {
            if ($content.Contains($key)) {
                $content = $content.Replace($key, $replacements[$key])
                $fileReplacements++
            }
        }
        
        # Se houve alterações, salvar o arquivo
        if ($content -ne $originalContent) {
            # Salvar com encoding UTF-8 sem BOM
            [System.IO.File]::WriteAllText($file.FullName, $content, [System.Text.UTF8Encoding]::new($false))
            $filesFixed++
            $totalReplacements += $fileReplacements
            Write-Host "[OK] Corrigido: $($file.Name) ($fileReplacements substituicoes)" -ForegroundColor Green
        }
    } catch {
        Write-Host "[ERRO] Erro em $($file.Name): $($_.Exception.Message)" -ForegroundColor Red
    }
}

Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "Correcao de encoding concluida!" -ForegroundColor Cyan
Write-Host "$filesFixed arquivos corrigidos" -ForegroundColor Yellow
Write-Host "$totalReplacements substituicoes no total" -ForegroundColor Yellow
Write-Host "========================================" -ForegroundColor Cyan
