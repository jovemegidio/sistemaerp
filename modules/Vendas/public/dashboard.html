<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALUFORCE - Meu Dashboard de Vendas</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --sidebar-width: 56px;
            --header-height: 48px;
            --tab-height: 40px;
            --primary-orange: #225cfa;
            --primary-dark: #1a1a2e;
            --bg-dark: #0f0f1a;
            --text-light: #e2e8f0;
            --text-muted: #94a3b8;
            --border-color: rgba(255,255,255,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f6f8;
            min-height: 100vh;
            overflow: hidden;
        }

        /* ==================== APP CONTAINER ==================== */
        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* ==================== SIDEBAR ==================== */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--primary-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 0;
            flex-shrink: 0;
            z-index: 100;
        }

        .sidebar-logo {
            width: 36px;
            height: 36px;
            background: var(--primary-orange);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
            text-decoration: none;
            transition: transform 0.2s;
        }

        .sidebar-logo:hover {
            transform: scale(1.05);
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .sidebar-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s;
            position: relative;
        }

        .sidebar-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .sidebar-btn.active {
            background: var(--primary-orange);
            color: white;
        }

        .sidebar-btn::after {
            content: attr(title);
            position: absolute;
            left: 100%;
            margin-left: 10px;
            padding: 6px 10px;
            background: #1e293b;
            color: white;
            font-size: 12px;
            border-radius: 4px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }

        .sidebar-btn:hover::after {
            opacity: 1;
        }

        .sidebar-bottom {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* ==================== MAIN AREA ==================== */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #f5f6f8;
        }

        /* ==================== HEADER ==================== */
        .header {
            height: var(--header-height);
            background: var(--primary-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .header-brand img {
            height: 24px;
        }

        .header-brand span {
            font-size: 14px;
            font-weight: 600;
            color: #8b8b9a;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            color: #8b8b9a;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 8px;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .user-avatar img.visible {
            display: block;
        }

        .header .user-greeting {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: 16px;
            color: #8b8b9a;
            font-size: 13px;
        }

        .header .user-greeting strong {
            color: white;
        }

        /* ==================== TABS BAR ==================== */
        .tabs-bar {
            height: var(--tab-height);
            background: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 8px;
            flex-shrink: 0;
        }

        .tab-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tab-btn:hover {
            background: #f1f5f9;
            color: #334155;
        }

        .tab-btn.active {
            background: var(--primary-orange);
            color: white;
        }

        .tabs-spacer {
            flex: 1;
        }

        /* ==================== PAGE CONTENT ==================== */
        .page-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* ==================== PAGE HEADER ==================== */
        .page-header {
            background: white;
            border-radius: 12px;
            padding: 20px 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header-left h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .page-header-left p {
            font-size: 14px;
            color: #7f8c8d;
        }

        .user-greeting {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-avatar-large {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-orange), #ea580c);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 700;
        }

        /* ==================== STATS GRID ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 1200px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        .stat-card.meta-card {
            border-left: 4px solid var(--primary-orange);
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-icon.orange { background: #fff7ed; color: #f97316; }
        .stat-icon.green { background: #f0fdf4; color: #22c55e; }
        .stat-icon.blue { background: #eff6ff; color: #3b82f6; }
        .stat-icon.purple { background: #faf5ff; color: #a855f7; }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
        }

        .stat-label {
            font-size: 13px;
            color: #7f8c8d;
            margin-top: 4px;
        }

        /* ==================== META PROGRESS ==================== */
        .meta-progress {
            margin-top: 16px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
            color: #6b7280;
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-orange), #fb923c);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-fill.success {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }

        /* ==================== CONTENT GRID ==================== */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1200px) {
            .content-grid { grid-template-columns: 1fr; }
        }

        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .section-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-header h3 i {
            color: var(--primary-orange);
        }

        .section-content {
            padding: 20px;
        }

        /* ==================== VENDAS RECENTES ==================== */
        .vendas-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .venda-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            background: #f9fafb;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }

        .venda-item:hover {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .venda-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .venda-cliente {
            font-weight: 600;
            color: #1a1a1a;
        }

        .venda-data {
            font-size: 12px;
            color: #6b7280;
        }

        .venda-valor {
            font-size: 18px;
            font-weight: 700;
            color: #059669;
        }

        /* ==================== ATIVIDADES ==================== */
        .atividades-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .atividade-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 3px solid var(--primary-orange);
        }

        .atividade-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #fff7ed;
            color: var(--primary-orange);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .atividade-content {
            flex: 1;
        }

        .atividade-titulo {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 14px;
        }

        .atividade-desc {
            font-size: 12px;
            color: #6b7280;
            margin-top: 2px;
        }

        .atividade-horario {
            font-size: 12px;
            color: var(--primary-orange);
            font-weight: 600;
        }

        /* ==================== RANKING ==================== */
        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .ranking-item.destaque {
            background: linear-gradient(135deg, #fff7ed, #ffedd5);
            border: 1px solid var(--primary-orange);
        }

        .ranking-posicao {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
            color: #6b7280;
        }

        .ranking-item:nth-child(1) .ranking-posicao {
            background: #fef3c7;
            color: #d97706;
        }

        .ranking-item:nth-child(2) .ranking-posicao {
            background: #e5e7eb;
            color: #4b5563;
        }

        .ranking-item:nth-child(3) .ranking-posicao {
            background: #fed7aa;
            color: #c2410c;
        }

        .ranking-nome {
            flex: 1;
            font-weight: 500;
            color: #1a1a1a;
        }

        .ranking-valor {
            font-weight: 700;
            color: #059669;
        }

        /* ==================== EMPTY STATE ==================== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 14px;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ==================== GRÁFICOS ==================== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .chart-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-card h3 i {
            color: #f97316;
        }

        .chart-container {
            position: relative;
            height: 250px;
        }

        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="js/anti-copy-protection.js"></script>
    <link rel="stylesheet" href="css/popup-confirmacao.css">`n<link rel="stylesheet" href="../../public/css/responsive.css?v=2026010401"></head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <a href="dashboard" class="sidebar-logo" title="Voltar ao Painel">
                <i class="fas fa-home"></i>
            </a>
            <nav class="sidebar-nav">
                <button class="sidebar-btn" title="Kanban" onclick="window.location.href='index.html'">
                    <i class="fas fa-columns"></i>
                </button>
                <button class="sidebar-btn" title="Pedidos" onclick="window.location.href='pedidos.html'">
                    <i class="fas fa-clipboard-list"></i>
                </button>
                <button class="sidebar-btn" title="Clientes" onclick="window.location.href='clientes.html'">
                    <i class="fas fa-users"></i>
                </button>
                <button class="sidebar-btn" title="Estoque" onclick="window.location.href='estoque.html'">
                    <i class="fas fa-boxes-stacked"></i>
                </button>
                <button class="sidebar-btn active" title="Meu Dashboard" onclick="window.location.href='dashboard.html'">
                    <i class="fas fa-chart-pie"></i>
                </button>
                <button class="sidebar-btn" title="Gestão de Vendas" onclick="window.location.href='dashboard-admin.html'">
                    <i class="fas fa-chart-line"></i>
                </button>
                <button class="sidebar-btn" title="Relatórios" onclick="window.location.href='relatorios.html'">
                    <i class="fas fa-chart-bar"></i>
                </button>
            </nav>
            <div class="sidebar-bottom">
                <button class="sidebar-btn" title="Configurações">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </aside>

        <!-- Main Area -->
        <main class="main-area">
            <!-- Header -->
            <header class="header">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
                <div class="header-left">
                    <div class="header-brand">
                        <img src="images/Logo Monocromatico - Branco - Aluforce.png" alt="ALUFORCE">
                        <span>|</span>
                        <span>ALUFORCE</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" title="Notificações">
                        <i class="fas fa-bell"></i>
                    </button>
                    <div class="user-greeting">
                        <span><span id="greeting-text">Bom dia</span>, <strong id="user-name">Usuário</strong></span>
                        <div class="user-avatar" id="user-avatar">
                            <img src="" alt="Foto do usuário" id="user-photo">
                            <span id="user-initial">U</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Tabs Bar -->
            <div class="tabs-bar">
                <button class="tab-btn" onclick="window.location.href='index.html'">
                    <i class="fas fa-columns"></i> Kanban
                </button>
                <button class="tab-btn" onclick="window.location.href='pedidos.html'">
                    <i class="fas fa-clipboard-list"></i> Pedidos
                </button>
                <button class="tab-btn" onclick="window.location.href='clientes.html'">
                    <i class="fas fa-users"></i> Clientes
                </button>
                <button class="tab-btn active">
                    <i class="fas fa-chart-pie"></i> Meu Dashboard
                </button>
                <button class="tab-btn" onclick="window.location.href='dashboard-admin.html'">
                    <i class="fas fa-chart-line"></i> Gestão
                </button>
                <div class="tabs-spacer"></div>
            </div>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-header-left">
                        <h1>
                            <i class="fas fa-chart-pie" style="color: var(--primary-orange);"></i>
                            Meu Dashboard
                        </h1>
                        <p>Acompanhe suas metas e desempenho de vendas</p>
                    </div>
                    <div class="user-greeting">
                        <div>
                            <p style="font-size: 14px; color: #6b7280;">Bem-vindo(a),</p>
                            <p style="font-size: 18px; font-weight: 600; color: #1a1a1a;" id="userFirstName">Vendedor</p>
                        </div>
                        <div class="user-avatar-large" id="userAvatarLarge">
                            <span id="userInitialsLarge">V</span>
                        </div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card meta-card">
                        <div class="stat-card-header">
                            <div class="stat-icon orange">
                                <i class="fas fa-bullseye"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="metaAtual">R$ 32.500</div>
                        <div class="stat-label">Meta do Mês</div>
                        <div class="meta-progress">
                            <div class="progress-header">
                                <span>Progresso</span>
                                <span id="metaPercentual">65%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="metaProgressBar" style="width: 65%;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-icon green">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="vendasMes">R$ 21.125</div>
                        <div class="stat-label">Vendas no Mês</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-icon blue">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="pedidosMes">12</div>
                        <div class="stat-label">Pedidos no Mês</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-icon purple">
                                <i class="fas fa-trophy"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="posicaoRanking">3º</div>
                        <div class="stat-label">Posição no Ranking</div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3><i class="fas fa-chart-line"></i> Evolução de Vendas (Últimos 6 Meses)</h3>
                        <div class="chart-container">
                            <canvas id="chartVendasMensal"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3><i class="fas fa-chart-pie"></i> Vendas por Status</h3>
                        <div class="chart-container">
                            <canvas id="chartVendasStatus"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Content Grid -->
                <div class="content-grid">
                    <!-- Vendas Recentes -->
                    <div class="section-card">
                        <div class="section-header">
                            <h3><i class="fas fa-history"></i> Minhas Vendas Recentes</h3>
                        </div>
                        <div class="section-content">
                            <div class="vendas-list" id="vendasRecentes">
                                <div class="venda-item">
                                    <div class="venda-info">
                                        <span class="venda-cliente">Cliente Exemplo LTDA</span>
                                        <span class="venda-data">12/12/2025 - Pedido #1234</span>
                                    </div>
                                    <div class="venda-valor">R$ 8.500,00</div>
                                </div>
                                <div class="venda-item">
                                    <div class="venda-info">
                                        <span class="venda-cliente">Empresa ABC</span>
                                        <span class="venda-data">11/12/2025 - Pedido #1233</span>
                                    </div>
                                    <div class="venda-valor">R$ 4.200,00</div>
                                </div>
                                <div class="venda-item">
                                    <div class="venda-info">
                                        <span class="venda-cliente">Indústria XYZ</span>
                                        <span class="venda-data">10/12/2025 - Pedido #1232</span>
                                    </div>
                                    <div class="venda-valor">R$ 12.800,00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="right-column">
                        <!-- Próximas Atividades -->
                        <div class="section-card">
                            <div class="section-header">
                                <h3><i class="fas fa-calendar-check"></i> Próximas Atividades</h3>
                            </div>
                            <div class="section-content">
                                <div class="atividades-list" id="proximasAtividades">
                                    <div class="atividade-item">
                                        <div class="atividade-icon">
                                            <i class="fas fa-phone"></i>
                                        </div>
                                        <div class="atividade-content">
                                            <div class="atividade-titulo">Follow-up Cliente ABC</div>
                                            <div class="atividade-desc">Retornar sobre proposta enviada</div>
                                        </div>
                                        <div class="atividade-horario">14:00</div>
                                    </div>
                                    <div class="atividade-item">
                                        <div class="atividade-icon">
                                            <i class="fas fa-handshake"></i>
                                        </div>
                                        <div class="atividade-content">
                                            <div class="atividade-titulo">Reunião com Empresa XYZ</div>
                                            <div class="atividade-desc">Apresentação de novos produtos</div>
                                        </div>
                                        <div class="atividade-horario">16:30</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ranking da Equipe -->
                        <div class="section-card">
                            <div class="section-header">
                                <h3><i class="fas fa-medal"></i> Ranking da Equipe</h3>
                            </div>
                            <div class="section-content">
                                <div class="ranking-list" id="rankingEquipe">
                                    <div class="ranking-item loading-placeholder">
                                        <div class="ranking-posicao">1</div>
                                        <div class="ranking-nome">Carregando...</div>
                                        <div class="ranking-valor">R$ 0,00</div>
                                    </div>
                                    <div class="ranking-item loading-placeholder">
                                        <div class="ranking-posicao">2</div>
                                        <div class="ranking-nome">Carregando...</div>
                                        <div class="ranking-valor">R$ 0,00</div>
                                    </div>
                                    <div class="ranking-item loading-placeholder">
                                        <div class="ranking-posicao">3</div>
                                        <div class="ranking-nome">Carregando...</div>
                                        <div class="ranking-valor">R$ 0,00</div>
                                    </div>
                                    <div class="ranking-item loading-placeholder">
                                        <div class="ranking-posicao">4</div>
                                        <div class="ranking-nome">Carregando...</div>
                                        <div class="ranking-valor">R$ 0,00</div>
                                    </div>
                                    <div class="ranking-item loading-placeholder">
                                        <div class="ranking-posicao">5</div>
                                        <div class="ranking-nome">Carregando...</div>
                                        <div class="ranking-valor">R$ 0,00</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Mapeamento de avatares por nome de usuário
        const avatarNameMap = {
            'clemerson': '/avatars/Clemerson.webp',
            'isabela': '/avatars/Isabela.webp',
            'thaina': '/avatars/Thaina.webp',
            'thiago': '/avatars/Thiago.webp',
            'nicolas': '/avatars/NicolasDaniel.webp',
            'nicolasdaniel': '/avatars/NicolasDaniel.webp',
            'rh': '/avatars/Rh.webp',
            'admin': '/avatars/admin.webp',
            'ti': '/avatars/TI.webp',
            'tialuforce': '/avatars/TI.webp',
            'antonio': '/avatars/Antonio.webp',
            'andreia': '/avatars/Andreia.webp',
            'guilherme': '/avatars/Guilherme.webp'
        };

        function getAvatarFromEmail(email, nome) {
            if (!email) return null;
            const username = email.split('@')[0].split('.')[0].toLowerCase();
            if (avatarNameMap[username]) return avatarNameMap[username];
            if (nome) {
                const firstName = nome.split(' ')[0].toLowerCase();
                if (avatarNameMap[firstName]) return avatarNameMap[firstName];
            }
            return null;
        }

        // Carregar dados do usuário logado via API
        async function carregarUsuario() {
            try {
                const response = await fetch('/api/me', { credentials: 'include' });
                if (response.ok) {
                    const user = await response.json();
                    // Usar apelido se disponível, senão primeiro nome
                    const userName = user.apelido || user.nome || 'Usuário';
                    const primeiroNome = user.apelido || (user.nome ? user.nome.split(' ')[0] : 'Usuário');
                    let userAvatar = user.avatar && user.avatar !== '/avatars/default.webp' ? user.avatar : null;
                    if (!userAvatar) {
                        userAvatar = getAvatarFromEmail(user.email, userName);
                    }
                    
                    // Atualizar saudação dinâmica baseada na hora
                    const greetingTextEl = document.getElementById('greeting-text');
                    if (greetingTextEl) {
                        const hour = new Date().getHours();
                        let greeting = 'Bom dia';
                        if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
                        else if (hour >= 18 || hour < 5) greeting = 'Boa noite';
                        greetingTextEl.textContent = greeting;
                    }
                    
                    // Atualizar nome na saudação do header
                    const userNameEl = document.getElementById('user-name');
                    if (userNameEl) {
                        userNameEl.textContent = primeiroNome;
                    }
                    
                    // Atualizar avatar/foto
                    const userPhotoEl = document.getElementById('user-photo');
                    const userInitialEl = document.getElementById('user-initial');
                    
                    if (userAvatar && userPhotoEl) {
                        userPhotoEl.src = userAvatar;
                        userPhotoEl.classList.add('visible');
                        userPhotoEl.style.display = 'block';
                        if (userInitialEl) userInitialEl.style.display = 'none';
                    } else if (userInitialEl) {
                        userInitialEl.textContent = userName.charAt(0).toUpperCase();
                        userInitialEl.style.display = 'flex';
                        if (userPhotoEl) userPhotoEl.style.display = 'none';
                    }

                    // Também atualizar elementos antigos se existirem
                    const userFirstNameEl = document.getElementById('userFirstName');
                    const userInitialsEl = document.getElementById('userInitials');
                    const userInitialsLargeEl = document.getElementById('userInitialsLarge');
                    const userAvatarLargeEl = document.getElementById('userAvatarLarge');
                    
                    // Mostrar apenas o primeiro nome
                    const firstName = userName.split(' ')[0];
                    if (userFirstNameEl) userFirstNameEl.textContent = firstName;
                    if (userInitialsEl) userInitialsEl.textContent = firstName.charAt(0).toUpperCase();
                    if (userInitialsLargeEl) userInitialsLargeEl.textContent = firstName.charAt(0).toUpperCase();
                    
                    // Atualizar avatar grande na saudação do dashboard
                    if (userAvatarLargeEl && userAvatar) {
                        userAvatarLargeEl.innerHTML = `<img src="${userAvatar}" alt="${firstName}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar usuário:', error);
            }
        }

        // Carregar dados do dashboard
        async function carregarDashboard() {
            try {
                // Carregar dados completos do dashboard do vendedor
                const response = await fetch('/api/vendas/dashboard/vendedor?período=30', { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    
                    // Atualizar métricas principais
                    const metricas = data.metricas || {};
                    const meta = data.meta || {};
                    
                    // Meta do mês
                    document.getElementById('metaAtual').textContent = formatarMoeda(meta.valor || 32500);
                    
                    // Vendas no mês
                    document.getElementById('vendasMes').textContent = formatarMoeda(meta.atingido || 0);
                    
                    // Pedidos no mês
                    document.getElementById('pedidosMes').textContent = metricas.total_pedidos || 0;
                    
                    // Progresso da meta
                    const percentual = Math.min(100, Math.round(meta.percentual || 0));
                    document.getElementById('metaPercentual').textContent = `${percentual}%`;
                    const progressBar = document.getElementById('metaProgressBar');
                    if (progressBar) {
                        progressBar.style.width = `${percentual}%`;
                        if (percentual >= 100) progressBar.classList.add('success');
                    }
                    
                    // Atualizar gráfico de vendas mensais com histórico real
                    if (data.históricoMensal && data.históricoMensal.length > 0) {
                        const meses = data.históricoMensal.map(h => {
                            const [ano, mes] = h.mes.split('-');
                            const nomesMeses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                            return nomesMeses[parseInt(mes) - 1];
                        });
                        const valores = data.históricoMensal.map(h => h.valor_faturado || 0);
                        atualizarGraficoVendas(meses, valores);
                    }
                    
                    // Atualizar gráfico de status com pipeline real
                    if (data.pipeline && data.pipeline.length > 0) {
                        const statusMap = {
                            'faturado': { label: 'Faturados', color: '#10b981' },
                            'analise': { label: 'Em Negociação', color: '#f59e0b' },
                            'aprovado': { label: 'Aprovados', color: '#3b82f6' },
                            'orçamento': { label: 'Pedidos', color: '#8b5cf6' },
                            'cancelado': { label: 'Cancelados', color: '#ef4444' }
                        };
                        const labels = [];
                        const valores = [];
                        const cores = [];
                        data.pipeline.forEach(p => {
                            const info = statusMap[p.status] || { label: p.status, color: '#6b7280' };
                            labels.push(info.label);
                            valores.push(p.quantidade || 0);
                            cores.push(info.color);
                        });
                        atualizarGraficoStatus(labels, valores, cores);
                    }
                    
                    // Atualizar vendas recentes com clientes reais
                    if (data.meusClientes && data.meusClientes.length > 0) {
                        renderizarVendasRecentes(data.meusClientes);
                    }
                }
                
                // Carregar ranking da equipe
                await carregarRankingEquipe();
                
                // Carregar atividades/notificações
                await carregarAtividades();
                
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }
        
        // Carregar ranking de vendedores
        async function carregarRankingEquipe() {
            try {
                const response = await fetch('/api/vendas/dashboard/top-vendedores?limit=5', { credentials: 'include' });
                if (response.ok) {
                    const vendedores = await response.json();
                    const container = document.getElementById('rankingEquipe');
                    if (container && vendedores.length > 0) {
                        // Identificar usuário atual pelo nome
                        const userNameEl = document.getElementById('user-name');
                        const currentUserName = userNameEl ? userNameEl.textContent.toLowerCase() : '';
                        
                        container.innerHTML = vendedores.map((v, i) => {
                            const isCurrentUser = v.nome && v.nome.toLowerCase().includes(currentUserName);
                            return `
                                <div class="ranking-item ${isCurrentUser ? 'destaque' : ''}">
                                    <div class="ranking-posicao">${i + 1}</div>
                                    <div class="ranking-nome">${isCurrentUser ? 'Você' : (v.nome || 'Vendedor')}</div>
                                    <div class="ranking-valor">${formatarMoeda(v.valor || 0)}</div>
                                </div>
                            `;
                        }).join('');
                        
                        // Atualizar posição no ranking nos cards
                        const posicaoEl = document.getElementById('posicaoRanking');
                        if (posicaoEl) {
                            const userIndex = vendedores.findIndex(v => v.nome && v.nome.toLowerCase().includes(currentUserName));
                            posicaoEl.textContent = userIndex >= 0 ? `${userIndex + 1}º` : '-';
                        }
                    }
                }
            } catch (error) {
                console.log('Ranking não disponível');
            }
        }
        
        // Carregar atividades do vendedor
        async function carregarAtividades() {
            try {
                const response = await fetch('/api/vendas/notificacoes', { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    const container = document.getElementById('proximasAtividades');
                    if (container && data.notificacoes && data.notificacoes.length > 0) {
                        container.innerHTML = data.notificacoes.slice(0, 4).map(n => {
                            const icon = n.tipo === 'follow_up' ? 'fa-phone' : 'fa-exclamation-circle';
                            return `
                                <div class="atividade-item">
                                    <div class="atividade-icon">
                                        <i class="fas ${icon}"></i>
                                    </div>
                                    <div class="atividade-content">
                                        <div class="atividade-titulo">${n.titulo || 'Atividade'}</div>
                                        <div class="atividade-desc">${n.mensagem || ''}</div>
                                    </div>
                                    <div class="atividade-horario">${n.prioridade === 'alta' ? '⚠️' : ''}</div>
                                </div>
                            `;
                        }).join('');
                    } else if (container) {
                        container.innerHTML = `
                            <div class="empty-state" style="padding: 20px; text-align: center; color: #6b7280;">
                                <i class="fas fa-check-circle" style="font-size: 24px; margin-bottom: 8px;"></i>
                                <p>Nenhuma atividade pendente</p>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.log('Atividades não disponíveis');
            }
        }
        function renderizarVendasRecentes(clientes) {
            const container = document.getElementById('vendasRecentes');
            if (!clientes || clientes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Nenhuma venda recente</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = clientes.slice(0, 5).map(cliente => {
                // Formatar data do último pedido
                let dataFormatada = '';
                if (cliente.último_pedido || cliente.data_pedido || cliente.data) {
                    const data = cliente.último_pedido || cliente.data_pedido || cliente.data;
                    dataFormatada = formatarData(data);
                }
                
                // Determinar número do pedido
                const numeroPedido = cliente.pedido_id || cliente.numero_pedido || cliente.id || '';
                const infoPedido = numeroPedido ? `Pedido #${numeroPedido}` : `${cliente.total_pedidos || 0} pedido(s)`;
                
                return `
                    <div class="venda-item">
                        <div class="venda-info">
                            <span class="venda-cliente">${cliente.nome_fantasia || cliente.cliente_nome || cliente.empresa || 'Cliente'}</span>
                            <span class="venda-data">${dataFormatada}${dataFormatada && infoPedido ? ' - ' : ''}${infoPedido}</span>
                        </div>
                        <div class="venda-valor">${formatarMoeda(cliente.valor_faturado || cliente.valor || 0)}</div>
                    </div>
                `;
            }).join('');
        }
        
        // Função para carregar vendas recentes do vendedor logado (pedidos faturados)
        async function carregarMinhasVendasRecentes() {
            try {
                // Buscar pedidos faturados do vendedor atual
                const response = await fetch('/api/vendas/pedidos?status=faturado&limit=5', { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    const pedidos = Array.isArray(data) ? data : (data.pedidos || []);
                    
                    if (pedidos.length > 0) {
                        const container = document.getElementById('vendasRecentes');
                        container.innerHTML = pedidos.slice(0, 5).map(pedido => {
                            const dataFormatada = pedido.data_faturamento || pedido.created_at 
                                ? formatarData(pedido.data_faturamento || pedido.created_at) 
                                : '';
                            const numeroPedido = pedido.numero_pedido || pedido.id;
                            
                            return `
                                <div class="venda-item">
                                    <div class="venda-info">
                                        <span class="venda-cliente">${pedido.cliente_nome || pedido.empresa_nome || 'Cliente'}</span>
                                        <span class="venda-data">${dataFormatada}${dataFormatada ? ' - ' : ''}Pedido #${numeroPedido}</span>
                                    </div>
                                    <div class="venda-valor">${formatarMoeda(pedido.valor || pedido.valor_total || 0)}</div>
                                </div>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                console.log('Erro ao carregar vendas recentes:', error);
            }
        }

        function atualizarGraficoVendas(labels, valores) {
            if (chartVendasMensal) {
                chartVendasMensal.data.labels = labels;
                chartVendasMensal.data.datasets[0].data = valores;
                chartVendasMensal.update();
            }
        }

        function atualizarGraficoStatus(labels, valores, cores) {
            if (chartVendasStatus) {
                chartVendasStatus.data.labels = labels;
                chartVendasStatus.data.datasets[0].data = valores;
                chartVendasStatus.data.datasets[0].backgroundColor = cores;
                chartVendasStatus.update();
            }
        }

        function atualizarMetas(meta) {
            if (!meta) return;

            const percentual = Math.min(100, Math.round((meta.realizado / meta.objetivo) * 100));
            
            document.getElementById('metaAtual').textContent = formatarMoeda(meta.objetivo);
            document.getElementById('vendasMes').textContent = formatarMoeda(meta.realizado);
            document.getElementById('metaPercentual').textContent = `${percentual}%`;
            
            const progressBar = document.getElementById('metaProgressBar');
            progressBar.style.width = `${percentual}%`;
            
            if (percentual >= 100) {
                progressBar.classList.add('success');
            }
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function formatarData(data) {
            return new Date(data).toLocaleDateString('pt-BR');
        }

        // ========================================
        // GRÁFICOS CHART.JS
        // ========================================
        let chartVendasMensal = null;
        let chartVendasStatus = null;

        function inicializarGraficos() {
            // Dados de exemplo - serão substituídos por dados da API
            const meses = ['Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const vendasPorMes = [18500, 24200, 19800, 32100, 28400, 21125];
            
            // Gráfico de Evolução de Vendas (Linha)
            const ctxVendas = document.getElementById('chartVendasMensal').getContext('2d');
            chartVendasMensal = new Chart(ctxVendas, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Vendas (R$)',
                        data: vendasPorMes,
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#f97316',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'R$ ' + context.parsed.y.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + (value / 1000) + 'k';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Gráfico de Status de Vendas (Pizza/Doughnut)
            const ctxStatus = document.getElementById('chartVendasStatus').getContext('2d');
            chartVendasStatus = new Chart(ctxStatus, {
                type: 'doughnut',
                data: {
                    labels: ['Faturados', 'Em Negociação', 'Aprovados', 'Perdidos'],
                    datasets: [{
                        data: [45, 25, 20, 10],
                        backgroundColor: [
                            '#22c55e', // Verde - Faturados
                            '#f97316', // Laranja - Negociação
                            '#3b82f6', // Azul - Aprovados
                            '#ef4444'  // Vermelho - Perdidos
                        ],
                        borderColor: '#ffffff',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // Atualizar gráficos com dados da API
        async function atualizarGraficos() {
            try {
                const response = await fetch('/api/vendas/dashboard/graficos', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const dados = await response.json();
                    
                    // Atualizar gráfico de vendas mensais
                    if (dados.vendasMensais && chartVendasMensal) {
                        chartVendasMensal.data.labels = dados.vendasMensais.labels;
                        chartVendasMensal.data.datasets[0].data = dados.vendasMensais.valores;
                        chartVendasMensal.update();
                    }
                    
                    // Atualizar gráfico de status
                    if (dados.vendasStatus && chartVendasStatus) {
                        chartVendasStatus.data.labels = dados.vendasStatus.labels;
                        chartVendasStatus.data.datasets[0].data = dados.vendasStatus.valores;
                        chartVendasStatus.update();
                    }
                }
            } catch (error) {
                console.log('Usando dados de exemplo para gráficos');
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            carregarUsuario();
            carregarDashboard();
            inicializarGraficos();
            atualizarGraficos();
            carregarMinhasVendasRecentes(); // Carregar vendas recentes do vendedor
        });
    </script>
    
    <!-- Sistema de Chat e Suporte (widgets condicionais por usuário) -->
    <script src="js/chat-suporte-widgets.js?v=20260103"></script>
    <script src="js/popup-confirmacao.js"></script>`n</body>
</html>

