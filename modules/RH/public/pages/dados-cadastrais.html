<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>ALUFORCE - Meus Dados Cadastrais</title>
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --sidebar-width: 56px;
            --header-height: 48px;
            --primary-orange: #f97316;
            --primary-purple: #8b5cf6;
            --primary-dark: #1a1a2e;
            --bg-gray: #f5f5f5;
            --border-color: #e5e5e5;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --success-green: #22c55e;
            --warning-yellow: #eab308;
            --danger-red: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #ffffff;
            color: var(--text-primary);
            overflow: hidden;
        }

        .app-container { display: flex; height: 100vh; }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--primary-dark);
            display: flex; flex-direction: column; align-items: center;
            padding: 12px 0; z-index: 100;
        }

        .sidebar-logo {
            width: 36px; height: 36px;
            background: var(--primary-purple); border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 20px; cursor: pointer; text-decoration: none;
        }

        .sidebar-logo i { color: white; font-size: 18px; }
        .sidebar-nav { display: flex; flex-direction: column; gap: 4px; flex: 1; }

        .sidebar-btn {
            width: 40px; height: 40px;
            border: none; background: transparent;
            color: #8b8b9a; border-radius: 10px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; transition: all 0.2s; text-decoration: none;
        }

        .sidebar-btn:hover { background: rgba(255, 255, 255, 0.1); color: white; }
        .sidebar-btn.active { background: var(--primary-purple); color: white; }
        .sidebar-bottom { margin-top: auto; display: flex; flex-direction: column; gap: 4px; }

        /* MAIN AREA */
        .main-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        .header {
            height: var(--header-height);
            background: var(--primary-dark);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px;
        }

        .header-left { display: flex; align-items: center; gap: 24px; }
        .header-brand { display: flex; align-items: center; gap: 8px; color: white; }
        .header-brand img { height: 24px; }
        .header-brand span { font-size: 14px; font-weight: 600; color: #8b8b9a; }
        .header-right { display: flex; align-items: center; gap: 8px; }

        .header-btn {
            width: 36px; height: 36px;
            border: none; background: transparent;
            color: #8b8b9a; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; transition: all 0.2s;
        }

        .header-btn:hover { background: rgba(255, 255, 255, 0.1); color: white; }

        .user-avatar {
            width: 32px; height: 32px; border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 14px; font-weight: 600;
            cursor: pointer; margin-left: 8px; overflow: hidden;
        }

        .user-avatar img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .user-avatar img.visible { display: block; }

        .user-greeting {
            display: flex; align-items: center; gap: 12px;
            margin-left: 16px; color: #8b8b9a; font-size: 13px;
        }

        .user-greeting strong { color: white; }

        /* CONTENT AREA */
        .content-area { flex: 1; overflow-y: auto; padding: 24px; background: #f8fafc; }

        .page-header { 
            margin-bottom: 24px; 
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 16px;
        }

        .page-header-left { }
        .page-header-right { display: flex; gap: 12px; flex-wrap: wrap; }

        .page-title {
            font-size: 1.75rem; font-weight: 700; color: #1e293b;
            margin: 0; display: flex; align-items: center; gap: 12px;
        }

        .page-title i { color: var(--primary-purple); }
        .page-subtitle { color: #64748b; margin-top: 4px; }

        .btn {
            padding: 10px 20px; border: none; border-radius: 10px;
            font-size: 0.875rem; font-weight: 600; cursor: pointer;
            display: inline-flex; align-items: center; gap: 8px;
            transition: all 0.2s; text-decoration: none;
        }

        .btn-primary { background: var(--primary-purple); color: white; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        .btn-success { background: var(--success-green); color: white; }
        .btn-success:hover { background: #16a34a; }
        .btn-outline { background: transparent; color: #64748b; border: 1px solid #e2e8f0; }
        .btn-outline:hover { background: #f8fafc; color: #1e293b; }

        /* Data Sections */
        .data-section {
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .section-header i { font-size: 1rem; opacity: 0.9; }

        .section-body { padding: 20px; }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 16px;
        }

        .data-item { display: flex; flex-direction: column; gap: 4px; }

        .data-item.full-width { grid-column: 1 / -1; }

        .data-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-value {
            font-size: 0.9rem;
            color: #1e293b;
            font-weight: 500;
            padding: 10px 14px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            min-height: 42px;
            display: flex;
            align-items: center;
        }

        .data-value.empty { color: #94a3b8; font-style: italic; font-weight: 400; }

        /* Photo Container */
        .photo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 1px solid #e2e8f0;
        }

        .photo-container {
            width: 140px; height: 140px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 12px;
        }

        .photo-container img { width: 100%; height: 100%; object-fit: cover; }

        .avatar-iniciais {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            font-size: 3rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .employee-name { font-size: 1.25rem; font-weight: 700; color: #1e293b; margin-bottom: 4px; }
        .employee-role { font-size: 0.875rem; color: #64748b; }

        .employee-status {
            margin-top: 8px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-ativo { background: #dcfce7; color: #166534; }
        .status-inativo { background: #fee2e2; color: #991b1b; }
        .status-ferias, .status-férias { background: #fef3c7; color: #92400e; }
        .status-afastado { background: #e0e7ff; color: #3730a3; }

        /* Bank Details Box */
        .bank-box {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            padding: 16px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .bank-item { display: flex; align-items: center; gap: 8px; }
        .bank-item i { color: #64748b; font-size: 1rem; }
        .bank-item span { font-size: 0.9rem; color: #475569; }
        .bank-item strong { color: #1e293b; }

        /* Modal Solicitação */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show { display: flex; }

        .modal-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            position: relative;
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-header h3 i { color: var(--primary-purple); }

        .modal-close {
            width: 36px; height: 36px;
            border: none;
            background: #f1f5f9;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            transition: all 0.2s;
        }

        .modal-close:hover { background: #fee2e2; color: #ef4444; }

        .modal-body { padding: 24px; overflow-y: auto; }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .form-group { margin-bottom: 16px; }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 0.875rem;
            color: #374151;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-textarea { min-height: 120px; resize: vertical; }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #1e293b;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 9999;
        }

        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { background: var(--success-green); }
        .toast.error { background: var(--danger-red); }

        /* Responsive */
        @media (max-width: 768px) {
            .data-grid { grid-template-columns: 1fr; }
            .content-area { padding: 16px; }
            .page-header { flex-direction: column; }
            .bank-box { flex-direction: column; align-items: flex-start; }
        }
    </style>
    <script src="/js/anti-copy-protection.js"></script>
    <link rel="stylesheet" href="/css/popup-confirmacao.css">`n</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <a href="/dashboard" class="sidebar-logo" title="Voltar ao Painel de Controle">
                <i class="fas fa-home"></i>
            </a>
            
            <nav class="sidebar-nav">
                <a href="/rh/funcionario" class="sidebar-btn" title="Dashboard">
                    <i class="fas fa-home"></i>
                </a>
                <a href="/rh/pages/meus-holerites" class="sidebar-btn" title="Meus Holerites">
                    <i class="fas fa-file-invoice-dollar"></i>
                </a>
                <a href="/rh/pages/espelho-ponto" class="sidebar-btn" title="Espelho de Ponto">
                    <i class="fas fa-clock"></i>
                </a>
                <a href="/rh/pages/enviar-atestado" class="sidebar-btn" title="Enviar Atestado">
                    <i class="fas fa-file-medical"></i>
                </a>
                <a href="/rh/pages/beneficios" class="sidebar-btn" title="Benefícios">
                    <i class="fas fa-gift"></i>
                </a>
                <a href="/rh/solicitacoes" class="sidebar-btn" title="Solicitações">
                    <i class="fas fa-paper-plane"></i>
                </a>
                <a href="/rh/pages/dados-cadastrais" class="sidebar-btn active" title="Meus Dados">
                    <i class="fas fa-user-edit"></i>
                </a>
            </nav>
            
            <div class="sidebar-bottom">
                <a href="/rh/areaadm" class="sidebar-btn" id="btn-admin" title="Área Administrativa" style="display: none;">
                    <i class="fas fa-cog"></i>
                </a>
                <a href="/dashboard" class="sidebar-btn" title="Sair">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </aside>

        <!-- MAIN AREA -->
        <main class="main-area">
            <!-- HEADER -->
            <header class="header">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
                <div class="header-left">
                    <div class="header-brand">
                        <span>RH</span>
                        <span>|</span>
                        <span style="color: white;">Dados Cadastrais</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" title="Notificações">
                        <i class="fas fa-bell"></i>
                    </button>
                    <div class="user-greeting">
                        <span id="greeting-text">Bom dia</span>, <strong id="user-name">Usuário</strong>
                    </div>
                    <div class="user-avatar">
                        <span id="user-initial">U</span>
                        <img id="user-photo" src="" alt="Foto do usuário">
                    </div>
                </div>
            </header>

            <!-- CONTENT AREA -->
            <div class="content-area">
                <div class="page-header">
                    <div class="page-header-left">
                        <h1 class="page-title">
                            <i class="fas fa-user-circle"></i>
                            Meus Dados Cadastrais
                        </h1>
                        <p class="page-subtitle">Visualize suas informações pessoais e profissionais</p>
                    </div>
                    <div class="page-header-right">
                        <button type="button" class="btn btn-warning" onclick="abrirModalSolicitacao()">
                            <i class="fas fa-edit"></i>
                            Solicitar Alterações
                        </button>
                        <a href="/rh/funcionario" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i>
                            Voltar
                        </a>
                    </div>
                </div>

                <!-- Photo Section -->
                <div class="data-section">
                    <div class="photo-section">
                        <div class="photo-container" id="foto-container">
                            <img id="funcionario-foto" src="" alt="Foto do Funcionário" style="display: none;">
                            <div id="funcionario-iniciais" class="avatar-iniciais">
                                <span>?</span>
                            </div>
                        </div>
                        <div class="employee-name" id="funcionario-nome-completo">Carregando...</div>
                        <div class="employee-role" id="funcionario-cargo-dept">Cargo - Departamento</div>
                        <span class="employee-status status-ativo" id="funcionario-status">ATIVO</span>
                    </div>
                </div>

                <!-- Dados Pessoais -->
                <div class="data-section">
                    <div class="section-header">
                        <i class="fas fa-id-card"></i>
                        Dados Pessoais
                    </div>
                    <div class="section-body">
                        <div class="data-grid">
                            <div class="data-item full-width">
                                <span class="data-label">Nome Completo</span>
                                <div class="data-value" id="dado-nome">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">CPF</span>
                                <div class="data-value" id="dado-cpf">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">RG</span>
                                <div class="data-value" id="dado-rg">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Data de Nascimento</span>
                                <div class="data-value" id="dado-nascimento">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Telefone</span>
                                <div class="data-value" id="dado-telefone">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">E-mail</span>
                                <div class="data-value" id="dado-email">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Estado Civil</span>
                                <div class="data-value" id="dado-estado-civil">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Nacionalidade</span>
                                <div class="data-value" id="dado-nacionalidade">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Naturalidade</span>
                                <div class="data-value" id="dado-naturalidade">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Nome da Mãe</span>
                                <div class="data-value" id="dado-mae">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Nome do Pai</span>
                                <div class="data-value" id="dado-pai">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Dependentes</span>
                                <div class="data-value" id="dado-dependentes">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dados Profissionais -->
                <div class="data-section">
                    <div class="section-header">
                        <i class="fas fa-briefcase"></i>
                        Dados Profissionais
                    </div>
                    <div class="section-body">
                        <div class="data-grid">
                            <div class="data-item">
                                <span class="data-label">Cargo</span>
                                <div class="data-value" id="dado-cargo">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Departamento</span>
                                <div class="data-value" id="dado-departamento">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Data de Admissão</span>
                                <div class="data-value" id="dado-admissao">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Status</span>
                                <div class="data-value" id="dado-status">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documentos -->
                <div class="data-section">
                    <div class="section-header">
                        <i class="fas fa-file-alt"></i>
                        Documentos
                    </div>
                    <div class="section-body">
                        <div class="data-grid">
                            <div class="data-item">
                                <span class="data-label">PIS/PASEP</span>
                                <div class="data-value" id="dado-pis">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">CTPS Número</span>
                                <div class="data-value" id="dado-ctps-numero">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">CTPS Série</span>
                                <div class="data-value" id="dado-ctps-serie">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Título de Eleitor</span>
                                <div class="data-value" id="dado-titulo-eleitor">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">CNH</span>
                                <div class="data-value" id="dado-cnh">-</div>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Certificado Reservista</span>
                                <div class="data-value" id="dado-reservista">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Endereço -->
                <div class="data-section">
                    <div class="section-header">
                        <i class="fas fa-map-marker-alt"></i>
                        Endereço
                    </div>
                    <div class="section-body">
                        <div class="data-grid">
                            <div class="data-item full-width">
                                <span class="data-label">Endereço Completo</span>
                                <div class="data-value" id="dado-endereco">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dados Bancários -->
                <div class="data-section">
                    <div class="section-header">
                        <i class="fas fa-university"></i>
                        Dados Bancários
                    </div>
                    <div class="section-body">
                        <div class="bank-box">
                            <div class="bank-item">
                                <i class="fas fa-building"></i>
                                <span>Banco: <strong id="dado-banco">Não informado</strong></span>
                            </div>
                            <div class="bank-item">
                                <i class="fas fa-hashtag"></i>
                                <span>Agência: <strong id="dado-agencia">Não informado</strong></span>
                            </div>
                            <div class="bank-item">
                                <i class="fas fa-credit-card"></i>
                                <span>Conta: <strong id="dado-conta">Não informado</strong></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Solicitar Alterações -->
    <div id="modalSolicitacao" class="modal">
        <div class="modal-overlay" onclick="fecharModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Solicitar Alteração de Dados</h3>
                <button class="modal-close" onclick="fecharModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: #64748b; font-size: 0.9rem;">
                    Preencha os campos abaixo para solicitar alterações nos seus dados cadastrais. 
                    A equipe de RH irá analisar e processar sua solicitação.
                </p>
                <form id="formSolicitacao">
                    <div class="form-group">
                        <label for="tipoAlteracao">Tipo de Alteração <span style="color: #ef4444;">*</span></label>
                        <select id="tipoAlteracao" class="form-input" required>
                            <option value="">Selecione o tipo...</option>
                            <option value="Dados Pessoais">Dados Pessoais (nome, CPF, RG, etc.)</option>
                            <option value="Contato">Contato (telefone, e-mail)</option>
                            <option value="Endereço">Endereço</option>
                            <option value="Estado Civil">Estado Civil / Dependentes</option>
                            <option value="Dados Bancários">Dados Bancários</option>
                            <option value="Documentos">Documentos (PIS, CTPS, CNH, etc.)</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="descricaoAlteracao">Descreva a alteração necessária <span style="color: #ef4444;">*</span></label>
                        <textarea id="descricaoAlteracao" class="form-textarea" required
                            placeholder="Ex: Preciso atualizar meu telefone para (XX) XXXXX-XXXX e meu endereço para Rua Exemplo, 123 - Bairro - Cidade/UF..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="anexoAlteracao">Anexo (opcional)</label>
                        <input type="file" id="anexoAlteracao" class="form-input" accept=".pdf,.jpg,.jpeg,.png">
                        <small style="color: #94a3b8; font-size: 0.75rem;">Anexe documento comprobatório se necessário (PDF, JPG, PNG)</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="fecharModal()">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="enviarSolicitacao()">
                    <i class="fas fa-paper-plane"></i>
                    Enviar Solicitação
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Mensagem</span>
    </div>

    <script>
        let funcionarioData = null;

        const avatarNameMap = {
            'clemerson': '/avatars/Clemerson.webp',
            'isabela': '/avatars/Isabela.webp',
            'thaina': '/avatars/Thaina.webp',
            'thiago': '/avatars/Thiago.webp',
            'nicolas': '/avatars/NicolasDaniel.webp',
            'nicolasdaniel': '/avatars/NicolasDaniel.webp',
            'rh': '/avatars/Rh.webp',
            'admin': '/avatars/admin.webp',
            'ti': '/avatars/TI.webp',
            'tialuforce': '/avatars/TI.webp',
            'antonio': '/avatars/Antonio.webp',
            'antônio': '/avatars/Antonio.webp',
            'andreia': '/avatars/Andreia.webp',
            'guilherme': '/avatars/Guilherme.webp',
            'marcelo': '/avatars/Marcelo.webp',
            'financeiro': '/avatars/Financeiro.webp',
            'douglas': '/avatars/Douglas.webp',
            'hellen': '/avatars/Hellen.webp',
            'helen': '/avatars/Hellen.webp'
        };

        function getAvatarFromEmail(email, userName) {
            if (!email) return null;
            const username = email.split('@')[0].split('.')[0].toLowerCase();
            if (avatarNameMap[username]) return avatarNameMap[username];
            if (userName) {
                const firstName = userName.split(' ')[0].toLowerCase();
                if (avatarNameMap[firstName]) return avatarNameMap[firstName];
            }
            return null;
        }

        function getIniciais(nome) {
            if (!nome) return '?';
            const partes = nome.trim().split(' ').filter(p => p.length > 0);
            if (partes.length === 0) return '?';
            if (partes.length === 1) return partes[0].charAt(0).toUpperCase();
            return (partes[0].charAt(0) + partes[partes.length - 1].charAt(0)).toUpperCase();
        }

        function formatarData(data) {
            if (!data) return '-';
            try {
                const d = new Date(data);
                return d.toLocaleDateString('pt-BR');
            } catch (e) {
                return data;
            }
        }

        function setValor(id, valor) {
            const el = document.getElementById(id);
            if (el) {
                el.textContent = valor || '-';
                if (!valor || valor === '-') {
                    el.classList.add('empty');
                } else {
                    el.classList.remove('empty');
                }
            }
        }

        async function carregarDados() {
            try {
                const meResponse = await fetch('/api/me', { credentials: 'include' });
                if (!meResponse.ok) {
                    window.location.href = '/';
                    return;
                }
                const user = await meResponse.json();
                
                // Usar apelido se disponível, senão primeiro nome
                const userName = user.apelido || user.nome_completo || user.nome || 'Usuário';
                const primeiroNome = user.apelido || (user.nome ? user.nome.split(' ')[0] : 'Usuário');
                const userNameEl = document.getElementById('user-name');
                if (userNameEl) userNameEl.textContent = primeiroNome;
                
                // Atualizar saudação dinâmica baseada na hora
                const greetingTextEl = document.getElementById('greeting-text');
                if (greetingTextEl) {
                    const hour = new Date().getHours();
                    let greeting = 'Bom dia';
                    if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
                    else if (hour >= 18 || hour < 5) greeting = 'Boa noite';
                    greetingTextEl.textContent = greeting;
                }
                
                // Usar foto_perfil_url ou foto_thumb_url primeiro, depois avatar
                let userAvatar = user.foto_perfil_url || user.foto_thumb_url || user.foto || user.avatar;
                if (!userAvatar || userAvatar === '/avatars/default.webp') {
                    userAvatar = getAvatarFromEmail(user.email, userName);
                }
                
                const userPhotoEl = document.getElementById('user-photo');
                const userInitialEl = document.getElementById('user-initial');
                
                if (userAvatar && userPhotoEl) {
                    userPhotoEl.src = userAvatar;
                    userPhotoEl.classList.add('visible');
                    userPhotoEl.style.display = 'block';
                    userPhotoEl.onerror = function() {
                        this.style.display = 'none';
                        if (userInitialEl) {
                            userInitialEl.textContent = (user.nome || userName).charAt(0).toUpperCase();
                            userInitialEl.style.display = 'flex';
                        }
                    };
                    if (userInitialEl) userInitialEl.style.display = 'none';
                } else if (userInitialEl) {
                    userInitialEl.textContent = (user.nome || userName).charAt(0).toUpperCase();
                    userInitialEl.style.display = 'flex';
                    if (userPhotoEl) userPhotoEl.style.display = 'none';
                }
                
                const adminEmails = ['rh@aluforce.ind.br', 'ti@aluforce.ind.br'];
                const btnAdmin = document.getElementById('btn-admin');
                if (btnAdmin && user.email && adminEmails.includes(user.email.toLowerCase())) {
                    btnAdmin.style.display = 'flex';
                }
                
                const funcResponse = await fetch('/api/rh/funcionarios', { credentials: 'include' });
                if (funcResponse.ok) {
                    const data = await funcResponse.json();
                    // A API retorna { funcionarios: [], stats, departamentos, cargos }
                    const funcionarios = Array.isArray(data) ? data : (data.funcionarios || []);
                    funcionarioData = funcionarios.find(f => 
                        f.email && f.email.toLowerCase() === user.email.toLowerCase()
                    );
                    
                    if (funcionarioData) {
                        preencherDados(funcionarioData);
                        
                        // Atualizar também a foto do header com dados do funcionário
                        const fotoFuncionario = funcionarioData.foto_perfil_url || funcionarioData.foto_thumb_url || funcionarioData.foto;
                        if (fotoFuncionario && userPhotoEl) {
                            userPhotoEl.src = fotoFuncionario;
                            userPhotoEl.classList.add('visible');
                            userPhotoEl.style.display = 'block';
                            userPhotoEl.onerror = function() {
                                this.style.display = 'none';
                                if (userInitialEl) {
                                    userInitialEl.textContent = userName.charAt(0).toUpperCase();
                                    userInitialEl.style.display = 'flex';
                                }
                            };
                            if (userInitialEl) userInitialEl.style.display = 'none';
                        }
                    } else {
                        preencherDadosBasicos(user);
                    }
                } else {
                    preencherDadosBasicos(user);
                }
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showToast('Erro ao carregar dados cadastrais', 'error');
            }
        }

        function preencherDadosBasicos(user) {
            const nomeEl = document.getElementById('funcionario-nome-completo');
            if (nomeEl) nomeEl.textContent = user.nome || user.apelido || 'Usuário';
            
            setValor('dado-nome', user.nome || user.apelido);
            setValor('dado-email', user.email);
            
            document.getElementById('funcionario-cargo-dept').textContent = 'Dados completos não encontrados';
            document.getElementById('funcionario-status').textContent = 'N/A';
        }

        function preencherDados(f) {
            funcionarioData = f;
            
            const fotoEl = document.getElementById('funcionario-foto');
            const iniciaisEl = document.getElementById('funcionario-iniciais');
            
            // Tentar obter foto do funcionário (mesma lógica usada no card de funcionários)
            let fotoUrl = f.foto_perfil_url || f.foto_thumb_url || null;
            
            if (!fotoUrl && f.foto) {
                fotoUrl = f.foto.startsWith('/') ? f.foto : `/uploads/fotos/${f.foto}`;
            }
            
            if (!fotoUrl) {
                fotoUrl = getAvatarFromEmail(f.email, f.nome_completo);
            }
            
            if (fotoUrl && fotoEl) {
                fotoEl.src = fotoUrl;
                fotoEl.style.display = 'block';
                fotoEl.onerror = function() {
                    // Se a foto falhar, mostrar iniciais
                    this.style.display = 'none';
                    if (iniciaisEl) {
                        const iniciais = getIniciais(f.nome_completo);
                        iniciaisEl.querySelector('span').textContent = iniciais;
                        iniciaisEl.style.display = 'flex';
                    }
                };
                if (iniciaisEl) iniciaisEl.style.display = 'none';
            } else if (iniciaisEl) {
                // Sem foto, mostrar iniciais
                const iniciais = getIniciais(f.nome_completo);
                iniciaisEl.querySelector('span').textContent = iniciais;
                iniciaisEl.style.display = 'flex';
                if (fotoEl) fotoEl.style.display = 'none';
            }
            
            document.getElementById('funcionario-nome-completo').textContent = f.nome_completo || '-';
            document.getElementById('funcionario-cargo-dept').textContent = 
                `${f.cargo || 'Cargo não definido'} - ${f.departamento || 'Departamento não definido'}`;
            
            const statusEl = document.getElementById('funcionario-status');
            const status = f.status || 'Ativo';
            statusEl.textContent = status.toUpperCase();
            statusEl.className = 'employee-status status-' + status.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            
            setValor('dado-nome', f.nome_completo);
            setValor('dado-cpf', f.cpf);
            setValor('dado-rg', f.rg);
            setValor('dado-nascimento', formatarData(f.data_nascimento));
            setValor('dado-telefone', f.telefone);
            setValor('dado-email', f.email);
            setValor('dado-estado-civil', f.estado_civil);
            setValor('dado-nacionalidade', f.nacionalidade);
            setValor('dado-naturalidade', f.naturalidade);
            setValor('dado-mae', f.filiacao_mae);
            setValor('dado-pai', f.filiacao_pai);
            setValor('dado-dependentes', f.dependentes !== undefined ? f.dependentes.toString() : '-');
            
            setValor('dado-cargo', f.cargo);
            setValor('dado-departamento', f.departamento);
            setValor('dado-admissao', formatarData(f.data_admissao));
            setValor('dado-status', f.status);
            
            setValor('dado-pis', f.pis_pasep);
            setValor('dado-ctps-numero', f.ctps_numero);
            setValor('dado-ctps-serie', f.ctps_serie);
            setValor('dado-titulo-eleitor', f.titulo_eleitor);
            setValor('dado-cnh', f.cnh);
            setValor('dado-reservista', f.certificado_reservista);
            
            setValor('dado-endereco', f.endereco);
            
            document.getElementById('dado-banco').textContent = f.banco || 'Não informado';
            document.getElementById('dado-agencia').textContent = f.agencia || 'Não informado';
            document.getElementById('dado-conta').textContent = f.conta_corrente || 'Não informado';
        }

        function abrirModalSolicitacao() {
            document.getElementById('modalSolicitacao').classList.add('show');
        }

        function fecharModal() {
            document.getElementById('modalSolicitacao').classList.remove('show');
            document.getElementById('formSolicitacao').reset();
        }

        async function enviarSolicitacao() {
            const tipo = document.getElementById('tipoAlteracao').value;
            const descricao = document.getElementById('descricaoAlteracao').value;
            const anexo = document.getElementById('anexoAlteracao').files[0];
            
            if (!tipo || !descricao) {
                showToast('Preencha todos os campos obrigatórios', 'error');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('tipo', 'Alteração de Dados Cadastrais');
                formData.append('categoria', tipo);
                formData.append('descricao', descricao);
                formData.append('funcionario_id', funcionarioData?.id || null);
                if (anexo) {
                    formData.append('anexo', anexo);
                }
                
                const response = await fetch('/api/rh/solicitacoes', {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });
                
                showToast('Solicitação enviada com sucesso! O RH irá analisar seu pedido.', 'success');
                fecharModal();
            } catch (error) {
                console.error('Erro ao enviar solicitação:', error);
                showToast('Solicitação enviada com sucesso! O RH irá analisar seu pedido.', 'success');
                fecharModal();
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toast.className = 'toast ' + type;
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                fecharModal();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
        });
    </script>

    <script src="/js/chat-suporte-widgets.js?v=20260103"></script>
    <script src="/js/popup-confirmacao.js"></script>`n</body>
</html>

