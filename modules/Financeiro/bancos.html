<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="icon" type="image/x-icon" href="/favicon-aluforce.webp">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALUFORCE - Gestão de Bancos</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --sidebar-width: 56px;
            --header-height: 48px;
            --primary-blue: #84cc16;
            --primary-dark: #1a1a2e;
            --bg-gray: #f8fafc;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-gray); color: var(--text-primary); }
        .app-container { display: flex; height: 100vh; }

        /* SIDEBAR */
        .sidebar { width: var(--sidebar-width); background: var(--primary-dark); display: flex; flex-direction: column; align-items: center; padding: 12px 0; z-index: 100; position: fixed; height: 100vh; }
        .sidebar-logo { width: 36px; height: 36px; background: var(--primary-blue); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; text-decoration: none; }
        .sidebar-logo i { color: white; font-size: 18px; }
        .sidebar-nav { display: flex; flex-direction: column; gap: 4px; flex: 1; }
        .sidebar-btn { width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.2s; }
        .sidebar-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .sidebar-btn.active { background: var(--primary-blue); color: white; }
        .sidebar-bottom { margin-top: auto; display: flex; flex-direction: column; gap: 4px; }

        /* MAIN */
        .main-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; margin-left: var(--sidebar-width); }

        /* HEADER */
        .header { height: var(--header-height); background: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .header-brand { display: flex; align-items: center; gap: 8px; }
        .header-brand img { height: 24px; }
        .header-brand span { font-size: 14px; font-weight: 600; color: #8b8b9a; }
        .header-right { display: flex; align-items: center; gap: 8px; }
        .header-btn { width: 36px; height: 36px; border: none; background: transparent; color: #8b8b9a; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: all 0.2s; position: relative; }
        .header-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .header-btn .notification-badge { position: absolute; top: 4px; right: 4px; min-width: 16px; height: 16px; background: #ef4444; border-radius: 10px; color: white; font-size: 10px; font-weight: 600; display: flex; align-items: center; justify-content: center; padding: 0 4px; }
        .notification-container { position: relative; }
        .notification-panel { position: absolute; top: calc(100% + 12px); right: 0; width: 380px; max-height: 500px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 10000; display: none; overflow: hidden; }
        .notification-panel.active { display: block; }
        .notification-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: linear-gradient(135deg, #84cc16, #65a30d); color: white; }
        .notification-header h3 { margin: 0; font-size: 16px; font-weight: 600; }
        .notification-list { max-height: 340px; overflow-y: auto; }
        .notification-item { display: flex; gap: 12px; padding: 14px 20px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: all 0.2s; }
        .notification-item:hover { background: #f8f8f8; }
        .notification-item.unread { background: #f0fdf4; border-left: 3px solid #84cc16; }
        .notification-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .notification-icon.success { background: #dcfce7; color: #22c55e; }
        .notification-icon.warning { background: #fef3c7; color: #f59e0b; }
        .notification-icon.error { background: #fee2e2; color: #ef4444; }
        .notification-icon.info { background: #dbeafe; color: #3b82f6; }
        .notification-content { flex: 1; }
        .notification-title { font-size: 13px; font-weight: 600; color: #333; margin-bottom: 4px; }
        .notification-message { font-size: 12px; color: #666; }
        .notification-time { font-size: 11px; color: #999; margin-top: 6px; }
        .notification-footer { padding: 12px 20px; background: #f8f8f8; text-align: center; border-top: 1px solid #e5e5e5; }
        .notification-footer a { color: #84cc16; text-decoration: none; font-size: 13px; font-weight: 500; }
        .user-greeting { display: flex; align-items: center; gap: 12px; margin-left: 16px; color: #8b8b9a; font-size: 13px; }
        .user-greeting strong { color: white; }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #84cc16, #65a30d); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: 600; overflow: hidden; }
        .user-avatar img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .user-avatar img.visible { display: block; }
        .user-avatar .user-initial { display: block; }
        .user-avatar img.visible + .user-initial { display: none; }

        /* PAGE */
        .page-content { flex: 1; overflow-y: auto; padding: 24px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .page-title-section h1 { font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }
        .page-title-section h1 i { color: var(--primary-blue); }
        .page-title-section p { font-size: 14px; color: var(--text-secondary); }
        .page-actions { display: flex; gap: 12px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--primary-blue); color: white; }
        .btn-primary:hover { background: #65a30d; }
        .btn-secondary { background: white; color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }

        /* KPI CARDS */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        .kpi-card { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .kpi-card.highlight { background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%); color: white; }
        .kpi-card.highlight .kpi-content h3 { color: rgba(255,255,255,0.8); }
        .kpi-card.highlight .kpi-icon { background: rgba(255,255,255,0.2); color: white; }
        .kpi-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .kpi-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .kpi-icon.blue { background: rgba(59,130,246,0.1); color: var(--info); }
        .kpi-icon.green { background: rgba(34,197,94,0.1); color: var(--success); }
        .kpi-icon.orange { background: rgba(245,158,11,0.1); color: var(--warning); }
        .kpi-icon.purple { background: rgba(139,92,246,0.1); color: #8b5cf6; }
        .kpi-content h3 { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
        .kpi-value { font-size: 28px; font-weight: 700; }

        /* BANCOS GRID */
        .bancos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .banco-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.3s; }
        .banco-card:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.12); }
        .banco-header { padding: 20px; display: flex; align-items: center; gap: 16px; border-bottom: 1px solid var(--border-color); }
        .banco-logo { width: 56px; height: 56px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; color: white; }
        .banco-logo.bb { background: linear-gradient(135deg, #fece00, #003882); }
        .banco-logo.itau { background: linear-gradient(135deg, #ff6600, #002d72); }
        .banco-logo.bradesco { background: linear-gradient(135deg, #cc092f, #9e1030); }
        .banco-logo.santander { background: linear-gradient(135deg, #ec0000, #b50000); }
        .banco-logo.caixa { background: linear-gradient(135deg, #005ca9, #003d6b); }
        .banco-logo.nubank { background: linear-gradient(135deg, #820ad1, #5c078f); }
        .banco-logo.inter { background: linear-gradient(135deg, #ff7a00, #d46500); }
        .banco-logo.sicoob { background: linear-gradient(135deg, #003641, #005566); }
        .banco-info { flex: 1; }
        .banco-info h3 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .banco-info span { font-size: 13px; color: var(--text-secondary); }
        .banco-status { padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .banco-status.ativo { background: rgba(34,197,94,0.1); color: var(--success); }
        .banco-status.inativo { background: rgba(239,68,68,0.1); color: var(--danger); }
        .banco-body { padding: 20px; }
        .banco-saldo { margin-bottom: 20px; }
        .banco-saldo-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; }
        .banco-saldo-valor { font-size: 28px; font-weight: 700; }
        .banco-saldo-valor.positivo { color: var(--text-primary); }
        .banco-saldo-valor.negativo { color: var(--danger); }
        .banco-details { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
        .banco-detail { background: var(--bg-gray); padding: 12px; border-radius: 10px; }
        .banco-detail label { font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px; }
        .banco-detail span { font-size: 13px; font-weight: 600; }
        .banco-detail span.entrada { color: var(--success); }
        .banco-detail span.saida { color: var(--danger); }
        .banco-actions { display: flex; gap: 8px; }
        .banco-actions .btn { flex: 1; justify-content: center; }

        /* CARD */
        .card { background: white; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); overflow: hidden; }
        .card-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .card-header h3 i { color: var(--primary-blue); }
        .card-body { padding: 24px; }

        /* TABLE */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: var(--bg-gray); padding: 14px 20px; text-align: left; font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
        .data-table td { padding: 16px 20px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .data-table tr:hover { background: var(--bg-gray); }
        .tipo-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .tipo-badge.entrada { background: rgba(34,197,94,0.1); color: var(--success); }
        .tipo-badge.saida { background: rgba(239,68,68,0.1); color: var(--danger); }
        .tipo-badge.transferencia { background: rgba(59,130,246,0.1); color: var(--info); }
        .valor-cell { font-weight: 600; }
        .valor-cell.positivo { color: var(--success); }
        .valor-cell.negativo { color: var(--danger); }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: white; border-radius: 20px; width: 100%; max-width: 600px; max-height: 90vh; overflow: hidden; }
        .modal-header { padding: 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .modal-header h2 i { color: var(--primary-blue); }
        .modal-close { width: 36px; height: 36px; border: none; background: var(--bg-gray); border-radius: 10px; cursor: pointer; font-size: 18px; color: var(--text-secondary); }
        .modal-body { padding: 24px; overflow-y: auto; max-height: calc(90vh - 160px); }
        .modal-footer { padding: 20px 24px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px; }

        /* FORM */
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-group.full { grid-column: span 2; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; border: 1px solid var(--border-color); border-radius: 10px; font-size: 14px; font-family: inherit; transition: all 0.2s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(132,204,22,0.1); }

        /* RESPONSIVE */
        @media (max-width: 1400px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 900px) { .bancos-grid { grid-template-columns: 1fr; } .form-row { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .kpi-grid { grid-template-columns: 1fr; } }
    </style></head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <a href="" class="sidebar-logo" title="Início"><i class="fas fa-home"></i></a>
            <nav class="sidebar-nav">
                <button class="sidebar-btn" title="Dashboard" onclick="location.href='index.html'"><i class="fas fa-chart-line"></i></button>
                <button class="sidebar-btn" title="Contas a Pagar" onclick="location.href='contas-pagar.html'"><i class="fas fa-file-invoice-dollar"></i></button>
                <button class="sidebar-btn" title="Contas a Receber" onclick="location.href='contas-receber.html'"><i class="fas fa-hand-holding-usd"></i></button>
                <button class="sidebar-btn active" title="Bancos" onclick="location.href='bancos.html'"><i class="fas fa-university"></i></button>
                <button class="sidebar-btn" title="Fluxo de Caixa" onclick="location.href='fluxo-caixa.html'"><i class="fas fa-chart-area"></i></button>
                <button class="sidebar-btn" title="Conciliação" onclick="location.href='conciliacao.html'"><i class="fas fa-balance-scale"></i></button>
            </nav>
            <div class="sidebar-bottom">
                <button class="sidebar-btn" title="Relatórios" onclick="location.href='relatorios.html'"><i class="fas fa-chart-bar"></i></button>
                <button class="sidebar-btn" title="Configurações"><i class="fas fa-cog"></i></button>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main-area">
            <header class="header">
    <link rel="icon" type="image/x-icon" href="/favicon-aluforce.webp">
                <div class="header-left">
                    <div class="header-brand">
                        <span>Financeiro</span>
                        <span>|</span>
                        <span style="color: white;">Bancos</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="notification-container">
                        <button class="header-btn" title="Notificações" onclick="toggleNotificacoes()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notification-count">2</span>
                        </button>
                        <div class="notification-panel" id="notification-panel">
                            <div class="notification-header">
                                <h3><i class="fas fa-bell"></i> Notificações</h3>
                            </div>
                            <div class="notification-list" id="notification-list"></div>
                            <div class="notification-footer">
                                <a href="#">Ver todas as notificações</a>
                            </div>
                        </div>
                    </div>
                    <div class="user-greeting">
                        <span><span id="greeting-text">Bom dia</span>, <strong id="user-name">Usuário</strong></span>
                        <div class="user-avatar" id="user-avatar">
                            <img src="" alt="Foto do usuário" id="user-photo">
                            <span class="user-initial" id="user-initial">U</span>
                        </div>
                    </div>
                </div>
            </header>

            <div class="page-content">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-title-section">
                        <h1><i class="fas fa-university"></i> Gestão de Bancos</h1>
                        <p>Gerencie suas contas bancárias e acompanhe os saldos</p>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-secondary" onclick="abrirModalTransferencia()"><i class="fas fa-exchange-alt"></i> Transferência</button>
                        <button class="btn btn-primary" onclick="abrirModalBanco()"><i class="fas fa-plus"></i> Novo Banco</button>
                    </div>
                </div>

                <!-- KPIs -->
                <div class="kpi-grid">
                    <div class="kpi-card highlight">
                        <div class="kpi-header">
                            <div class="kpi-icon"><i class="fas fa-wallet"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Saldo Total</h3>
                            <div class="kpi-value" id="saldoTotal">R$ 0,00</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon blue"><i class="fas fa-building-columns"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Contas Ativas</h3>
                            <div class="kpi-value" id="contasAtivas">0</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon green"><i class="fas fa-arrow-down"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Entradas do Mês</h3>
                            <div class="kpi-value" id="entradasMes" style="color: var(--success);">R$ 0,00</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon orange"><i class="fas fa-arrow-up"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Saídas do Mês</h3>
                            <div class="kpi-value" id="saidasMes" style="color: var(--danger);">R$ 0,00</div>
                        </div>
                    </div>
                </div>

                <!-- Bancos Grid -->
                <div class="bancos-grid" id="bancosGrid"></div>

                <!-- Últimas Movimentações -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Últimas Movimentações</h3>
                        <button class="btn btn-secondary btn-sm" onclick="abrirModalMovimento()"><i class="fas fa-plus"></i> Nova Movimentação</button>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Banco</th>
                                <th>Descrição</th>
                                <th>Tipo</th>
                                <th>Valor</th>
                                <th>Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="movimentacoesBody"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Novo Banco -->
    <div class="modal-overlay" id="modalBanco">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-university"></i> <span id="modalBancoTitulo">Nova Conta Bancária</span></h2>
                <button class="modal-close" onclick="fecharModal('modalBanco')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="formBanco">
                    <input type="hidden" id="bancoId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Banco *</label>
                            <select id="bancoCodigo" required>
                                <option value="">Selecione...</option>
                                <option value="001">001 - Banco do Brasil</option>
                                <option value="237">237 - Bradesco</option>
                                <option value="341">341 - Itaú</option>
                                <option value="033">033 - Santander</option>
                                <option value="104">104 - Caixa Econômica</option>
                                <option value="260">260 - Nubank</option>
                                <option value="077">077 - Banco Inter</option>
                                <option value="756">756 - Sicoob</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tipo de Conta *</label>
                            <select id="tipoConta" required>
                                <option value="corrente">Conta Corrente</option>
                                <option value="poupanca">Poupança</option>
                                <option value="investimento">Investimento</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Agência *</label>
                            <input type="text" id="agencia" placeholder="0000" required>
                        </div>
                        <div class="form-group">
                            <label>Conta *</label>
                            <input type="text" id="conta" placeholder="00000-0" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Apelido/Nome</label>
                            <input type="text" id="apelido" placeholder="Ex: Conta Principal">
                        </div>
                        <div class="form-group">
                            <label>Saldo Inicial</label>
                            <input type="text" id="saldoInicial" placeholder="R$ 0,00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Observações</label>
                        <textarea id="observacoes" rows="3" placeholder="Observações sobre a conta..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModal('modalBanco')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarBanco()"><i class="fas fa-save"></i> Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal Transferência -->
    <div class="modal-overlay" id="modalTransferencia">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-exchange-alt"></i> Transferência entre Contas</h2>
                <button class="modal-close" onclick="fecharModal('modalTransferencia')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="formTransferencia">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Conta de Origem *</label>
                            <select id="contaOrigem" required></select>
                        </div>
                        <div class="form-group">
                            <label>Conta de Destino *</label>
                            <select id="contaDestino" required></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Valor *</label>
                            <input type="text" id="valorTransferencia" placeholder="R$ 0,00" required>
                        </div>
                        <div class="form-group">
                            <label>Data *</label>
                            <input type="date" id="dataTransferencia" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descrição</label>
                        <input type="text" id="descricaoTransferencia" placeholder="Motivo da transferência">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModal('modalTransferencia')">Cancelar</button>
                <button class="btn btn-primary" onclick="realizarTransferencia()"><i class="fas fa-check"></i> Transferir</button>
            </div>
        </div>
    </div>

    <!-- Modal Nova Movimentação -->
    <div class="modal-overlay" id="modalMovimento">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Nova Movimentação</h2>
                <button class="modal-close" onclick="fecharModal('modalMovimento')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="formMovimento">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Conta Bancária *</label>
                            <select id="contaMovimento" required></select>
                        </div>
                        <div class="form-group">
                            <label>Tipo *</label>
                            <select id="tipoMovimento" required>
                                <option value="entrada">Entrada</option>
                                <option value="saida">Saída</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Valor *</label>
                            <input type="text" id="valorMovimento" placeholder="R$ 0,00" required>
                        </div>
                        <div class="form-group">
                            <label>Data *</label>
                            <input type="date" id="dataMovimento" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descrição *</label>
                        <input type="text" id="descricaoMovimento" placeholder="Descrição da movimentação" required>
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="categoriaMovimento">
                            <option value="">Selecione...</option>
                            <option value="vendas">Vendas</option>
                            <option value="fornecedores">Fornecedores</option>
                            <option value="pessoal">Pessoal</option>
                            <option value="impostos">Impostos</option>
                            <option value="utilidades">Utilidades</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModal('modalMovimento')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarMovimento()"><i class="fas fa-save"></i> Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // Dados
        let bancos = [
            { id: 1, codigo: '001', nome: 'Banco do Brasil', agencia: '1234', conta: '12345-6', tipo: 'corrente', apelido: 'Conta Principal', saldo: 85420.50, status: 'ativo', entradas: 45000, saidas: 28000 },
            { id: 2, codigo: '341', nome: 'Itaú', agencia: '4567', conta: '78901-2', tipo: 'corrente', apelido: 'Fornecedores', saldo: 42890.75, status: 'ativo', entradas: 22000, saidas: 15000 },
            { id: 3, codigo: '237', nome: 'Bradesco', agencia: '7890', conta: '34567-8', tipo: 'corrente', apelido: 'Recebimentos', saldo: 28340.20, status: 'ativo', entradas: 68000, saidas: 52000 },
            { id: 4, codigo: '260', nome: 'Nubank', agencia: '0001', conta: '9876543-2', tipo: 'corrente', apelido: 'Reserva', saldo: 15000.00, status: 'ativo', entradas: 5000, saidas: 2000 },
        ];

        let movimentacoes = [
            { id: 1, data: '2024-12-22', bancoId: 1, descricao: 'Recebimento Cliente ABC', tipo: 'entrada', valor: 15000, saldo: 85420.50 },
            { id: 2, data: '2024-12-21', bancoId: 2, descricao: 'Pagamento Fornecedor', tipo: 'saida', valor: 8500, saldo: 42890.75 },
            { id: 3, data: '2024-12-21', bancoId: 1, descricao: 'Transferência para Itaú', tipo: 'transferencia', valor: 10000, saldo: 70420.50 },
            { id: 4, data: '2024-12-20', bancoId: 3, descricao: 'Venda Projeto', tipo: 'entrada', valor: 22000, saldo: 28340.20 },
            { id: 5, data: '2024-12-20', bancoId: 1, descricao: 'Conta de Luz', tipo: 'saida', valor: 1850, saldo: 80420.50 },
            { id: 6, data: '2024-12-19', bancoId: 2, descricao: 'Material de Escritório', tipo: 'saida', valor: 450, saldo: 51390.75 },
            { id: 7, data: '2024-12-19', bancoId: 4, descricao: 'Depósito', tipo: 'entrada', valor: 5000, saldo: 15000 },
        ];

        const bancosConfig = {
            '001': { nome: 'Banco do Brasil', classe: 'bb', sigla: 'BB' },
            '237': { nome: 'Bradesco', classe: 'bradesco', sigla: 'BR' },
            '341': { nome: 'Itaú', classe: 'itau', sigla: 'IT' },
            '033': { nome: 'Santander', classe: 'santander', sigla: 'SA' },
            '104': { nome: 'Caixa', classe: 'caixa', sigla: 'CX' },
            '260': { nome: 'Nubank', classe: 'nubank', sigla: 'NU' },
            '077': { nome: 'Banco Inter', classe: 'inter', sigla: 'IN' },
            '756': { nome: 'Sicoob', classe: 'sicoob', sigla: 'SC' }
        };

        // Init
        document.addEventListener('DOMContentLoaded', function() {
            carregarUsuario();
            atualizarKPIs();
            renderizarBancos();
            renderizarMovimentacoes();
            document.getElementById('dataTransferencia').valueAsDate = new Date();
            document.getElementById('dataMovimento').valueAsDate = new Date();
        });

        async function carregarUsuario() {
            try {
                const response = await fetch('/api/me', { credentials: 'include' });
                if (response.ok) {
                    const user = await response.json();
                    // Usar apelido se disponível, senão primeiro nome
                    const userName = user.apelido || user.nome || 'Usuário';
                    const primeiroNome = user.apelido || (user.nome ? user.nome.split(' ')[0] : 'Usuário');

                    // Atualizar saudação dinâmica baseada na hora
                    const greetingTextEl = document.getElementById('greeting-text');
                    if (greetingTextEl) {
                        const hour = new Date().getHours();
                        let greeting = 'Bom dia';
                        if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
                        else if (hour >= 18 || hour < 5) greeting = 'Boa noite';
                        greetingTextEl.textContent = greeting;
                    }
                    document.getElementById('user-name').textContent = primeiroNome;
                    document.getElementById('user-initial').textContent = primeiroNome.charAt(0).toUpperCase();
                    
                    if (user.avatar && user.avatar !== '/avatars/default.webp') {
                        const foto = document.getElementById('user-photo');
                        foto.src = user.avatar;
                        foto.onload = () => foto.classList.add('visible');
                    }
                }
            } catch (e) { console.log('Erro ao carregar usuário'); }
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        }

        function formatarData(data) {
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function atualizarKPIs() {
            const saldoTotal = bancos.filter(b => b.status === 'ativo').reduce((sum, b) => sum + b.saldo, 0);
            const contasAtivas = bancos.filter(b => b.status === 'ativo').length;
            const entradas = bancos.reduce((sum, b) => sum + b.entradas, 0);
            const saidas = bancos.reduce((sum, b) => sum + b.saidas, 0);

            document.getElementById('saldoTotal').textContent = formatarMoeda(saldoTotal);
            document.getElementById('contasAtivas').textContent = contasAtivas;
            document.getElementById('entradasMes').textContent = formatarMoeda(entradas);
            document.getElementById('saidasMes').textContent = formatarMoeda(saidas);
        }

        function renderizarBancos() {
            const grid = document.getElementById('bancosGrid');
            grid.innerHTML = bancos.map(banco => {
                const config = bancosConfig[banco.codigo] || { nome: banco.nome, classe: 'bb', sigla: '??' };
                return `
                    <div class="banco-card">
                        <div class="banco-header">
                            <div class="banco-logo ${config.classe}">${config.sigla}</div>
                            <div class="banco-info">
                                <h3>${banco.apelido || config.nome}</h3>
                                <span>Ag: ${banco.agencia} | Cc: ${banco.conta}</span>
                            </div>
                            <span class="banco-status ${banco.status}">${banco.status === 'ativo' ? 'Ativo' : 'Inativo'}</span>
                        </div>
                        <div class="banco-body">
                            <div class="banco-saldo">
                                <div class="banco-saldo-label">Saldo Atual</div>
                                <div class="banco-saldo-valor ${banco.saldo >= 0 ? 'positivo' : 'negativo'}">${formatarMoeda(banco.saldo)}</div>
                            </div>
                            <div class="banco-details">
                                <div class="banco-detail">
                                    <label>Entradas (Mês)</label>
                                    <span class="entrada">+${formatarMoeda(banco.entradas)}</span>
                                </div>
                                <div class="banco-detail">
                                    <label>Saídas (Mês)</label>
                                    <span class="saida">-${formatarMoeda(banco.saidas)}</span>
                                </div>
                            </div>
                            <div class="banco-actions">
                                <button class="btn btn-secondary btn-sm" onclick="verExtrato(${banco.id})"><i class="fas fa-list"></i> Extrato</button>
                                <button class="btn btn-secondary btn-sm" onclick="editarBanco(${banco.id})"><i class="fas fa-edit"></i> Editar</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderizarMovimentacoes() {
            const tbody = document.getElementById('movimentacoesBody');
            tbody.innerHTML = movimentacoes.slice(0, 10).map(mov => {
                const banco = bancos.find(b => b.id === mov.bancoId);
                const config = banco ? bancosConfig[banco.codigo] : null;
                return `
                    <tr>
                        <td>${formatarData(mov.data)}</td>
                        <td><strong>${banco ? (banco.apelido || config?.nome) : '-'}</strong></td>
                        <td>${mov.descricao}</td>
                        <td>
                            <span class="tipo-badge ${mov.tipo}">
                                <i class="fas fa-arrow-${mov.tipo === 'entrada' ? 'down' : mov.tipo === 'saida' ? 'up' : 'right-left'}"></i>
                                ${mov.tipo === 'entrada' ? 'Entrada' : mov.tipo === 'saida' ? 'Saída' : 'Transferência'}
                            </span>
                        </td>
                        <td class="valor-cell ${mov.tipo === 'entrada' ? 'positivo' : 'negativo'}">
                            ${mov.tipo === 'entrada' ? '+' : '-'}${formatarMoeda(mov.valor)}
                        </td>
                        <td><strong>${formatarMoeda(mov.saldo)}</strong></td>
                    </tr>
                `;
            }).join('');
        }

        function abrirModalBanco(id = null) {
            document.getElementById('formBanco').reset();
            document.getElementById('bancoId').value = '';
            document.getElementById('modalBancoTitulo').textContent = 'Nova Conta Bancária';
            
            if (id) {
                const banco = bancos.find(b => b.id === id);
                if (banco) {
                    document.getElementById('bancoId').value = banco.id;
                    document.getElementById('bancoCodigo').value = banco.codigo;
                    document.getElementById('tipoConta').value = banco.tipo;
                    document.getElementById('agencia').value = banco.agencia;
                    document.getElementById('conta').value = banco.conta;
                    document.getElementById('apelido').value = banco.apelido;
                    document.getElementById('modalBancoTitulo').textContent = 'Editar Conta Bancária';
                }
            }
            
            document.getElementById('modalBanco').classList.add('active');
        }

        function abrirModalTransferencia() {
            document.getElementById('formTransferencia').reset();
            
            const options = bancos.filter(b => b.status === 'ativo').map(b => 
                `<option value="${b.id}">${b.apelido || bancosConfig[b.codigo]?.nome} - ${formatarMoeda(b.saldo)}</option>`
            ).join('');
            
            document.getElementById('contaOrigem').innerHTML = '<option value="">Selecione...</option>' + options;
            document.getElementById('contaDestino').innerHTML = '<option value="">Selecione...</option>' + options;
            document.getElementById('dataTransferencia').valueAsDate = new Date();
            
            document.getElementById('modalTransferencia').classList.add('active');
        }

        function abrirModalMovimento() {
            document.getElementById('formMovimento').reset();
            
            const options = bancos.filter(b => b.status === 'ativo').map(b => 
                `<option value="${b.id}">${b.apelido || bancosConfig[b.codigo]?.nome}</option>`
            ).join('');
            
            document.getElementById('contaMovimento').innerHTML = '<option value="">Selecione...</option>' + options;
            document.getElementById('dataMovimento').valueAsDate = new Date();
            
            document.getElementById('modalMovimento').classList.add('active');
        }

        function fecharModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function salvarBanco() {
            const id = document.getElementById('bancoId').value;
            const dados = {
                codigo: document.getElementById('bancoCodigo').value,
                nome: bancosConfig[document.getElementById('bancoCodigo').value]?.nome || '',
                tipo: document.getElementById('tipoConta').value,
                agencia: document.getElementById('agencia').value,
                conta: document.getElementById('conta').value,
                apelido: document.getElementById('apelido').value,
                saldo: parseFloat(document.getElementById('saldoInicial').value.replace(/[^\d,-]/g, '').replace(',', '.')) || 0,
                status: 'ativo',
                entradas: 0,
                saidas: 0
            };

            if (id) {
                const index = bancos.findIndex(b => b.id === parseInt(id));
                if (index !== -1) {
                    bancos[index] = { ...bancos[index], ...dados };
                }
            } else {
                dados.id = Math.max(...bancos.map(b => b.id), 0) + 1;
                bancos.push(dados);
            }

            fecharModal('modalBanco');
            atualizarKPIs();
            renderizarBancos();
            alert(id ? 'Banco atualizado com sucesso!' : 'Banco cadastrado com sucesso!');
        }

        function editarBanco(id) {
            abrirModalBanco(id);
        }

        function verExtrato(id) {
            const banco = bancos.find(b => b.id === id);
            if (banco) {
                alert(`Extrato da conta: ${banco.apelido || bancosConfig[banco.codigo]?.nome}\nSaldo: ${formatarMoeda(banco.saldo)}`);
            }
        }

        function realizarTransferencia() {
            const origem = parseInt(document.getElementById('contaOrigem').value);
            const destino = parseInt(document.getElementById('contaDestino').value);
            const valor = parseFloat(document.getElementById('valorTransferencia').value.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
            
            if (!origem || !destino || origem === destino) {
                alert('Selecione contas diferentes para origem e destino');
                return;
            }
            
            if (valor <= 0) {
                alert('Informe um valor válido');
                return;
            }

            const bancoOrigem = bancos.find(b => b.id === origem);
            const bancoDestino = bancos.find(b => b.id === destino);

            if (bancoOrigem.saldo < valor) {
                alert('Saldo insuficiente na conta de origem');
                return;
            }

            bancoOrigem.saldo -= valor;
            bancoOrigem.saidas += valor;
            bancoDestino.saldo += valor;
            bancoDestino.entradas += valor;

            fecharModal('modalTransferencia');
            atualizarKPIs();
            renderizarBancos();
            alert('Transferência realizada com sucesso!');
        }

        function salvarMovimento() {
            const bancoId = parseInt(document.getElementById('contaMovimento').value);
            const tipo = document.getElementById('tipoMovimento').value;
            const valor = parseFloat(document.getElementById('valorMovimento').value.replace(/[^\d,-]/g, '').replace(',', '.')) || 0;
            
            if (!bancoId || valor <= 0) {
                alert('Preencha todos os campos obrigatórios');
                return;
            }

            const banco = bancos.find(b => b.id === bancoId);
            if (tipo === 'entrada') {
                banco.saldo += valor;
                banco.entradas += valor;
            } else {
                banco.saldo -= valor;
                banco.saidas += valor;
            }

            const mov = {
                id: Math.max(...movimentacoes.map(m => m.id), 0) + 1,
                data: document.getElementById('dataMovimento').value,
                bancoId: bancoId,
                descricao: document.getElementById('descricaoMovimento').value,
                tipo: tipo,
                valor: valor,
                saldo: banco.saldo
            };
            movimentacoes.unshift(mov);

            fecharModal('modalMovimento');
            atualizarKPIs();
            renderizarBancos();
            renderizarMovimentacoes();
            alert('Movimentação registrada com sucesso!');
        }

        // Sistema de Notificações
        function toggleNotificacoes() {
            const panel = document.getElementById('notification-panel');
            panel.classList.toggle('active');
        }

        document.addEventListener('click', function(e) {
            const container = document.querySelector('.notification-container');
            const panel = document.getElementById('notification-panel');
            if (container && !container.contains(e.target)) {
                panel.classList.remove('active');
            }
        });

        function carregarNotificacoesFinanceiro() {
            const lista = document.getElementById('notification-list');
            if (!lista) return;
            lista.innerHTML = `
                <div class="notification-item unread">
                    <div class="notification-icon info"><i class="fas fa-university"></i></div>
                    <div class="notification-content">
                        <div class="notification-title">Saldo atualizado</div>
                        <div class="notification-message">Os saldos bancários foram atualizados</div>
                        <div class="notification-time"><i class="fas fa-clock"></i> Agora</div>
                    </div>
                </div>
                <div class="notification-item">
                    <div class="notification-icon warning"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="notification-content">
                        <div class="notification-title">Saldo baixo</div>
                        <div class="notification-message">Atenção ao saldo de uma conta</div>
                        <div class="notification-time"><i class="fas fa-clock"></i> 1 hora atrás</div>
                    </div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', function() {
            carregarNotificacoesFinanceiro();
        });
    </script>

    <script src="financeiro.js"></script>
    <script src="public/js/financeiro-user-loader.js?v=20251222"></script>
    
    <!-- Sistema de Notificações Global -->
    <script src="js/notifications-manager.js?v=20251223"></script>
    <script src="js/notification-button.js?v=20251223"></script>
    
    <!-- Sistema de Chat e Suporte -->
    <!-- Sistema de Monitoramento de Conexão -->
    <script src="../_shared/connection-monitor.js?v=20251223"></script></body>
</html>

