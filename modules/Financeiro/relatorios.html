<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- ConfiguraÃ§Ã£o Global - DEVE ser carregado PRIMEIRO -->
    <script src="../../public/js/config.js"></script>
    
    <link rel="icon" type="image/x-icon" href="../../public/favicon-aluforce.webp">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALUFORCE - Relatórios Financeiros</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --sidebar-width: 56px;
            --header-height: 48px;
            --primary-blue: #84cc16;
            --primary-dark: #1a1a2e;
            --bg-gray: #f8fafc;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-gray); color: var(--text-primary); }
        .app-container { display: flex; height: 100vh; }

        /* SIDEBAR */
        .sidebar { width: var(--sidebar-width); background: var(--primary-dark); display: flex; flex-direction: column; align-items: center; padding: 12px 0; z-index: 100; position: fixed; height: 100vh; }
        .sidebar-logo { width: 36px; height: 36px; background: var(--primary-blue); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; text-decoration: none; }
        .sidebar-logo i { color: white; font-size: 18px; }
        .sidebar-nav { display: flex; flex-direction: column; gap: 4px; flex: 1; }
        .sidebar-btn { width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.2s; }
        .sidebar-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .sidebar-btn.active { background: var(--primary-blue); color: white; }
        .sidebar-bottom { margin-top: auto; display: flex; flex-direction: column; gap: 4px; }

        /* MAIN */
        .main-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; margin-left: var(--sidebar-width); }

        /* HEADER */
        .header { height: var(--header-height); background: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .header-brand { display: flex; align-items: center; gap: 8px; }
        .header-brand img { height: 24px; }
        .header-brand span { font-size: 14px; font-weight: 600; color: #8b8b9a; }
        .header-right { display: flex; align-items: center; gap: 8px; }
        .header-btn { width: 36px; height: 36px; border: none; background: transparent; color: #8b8b9a; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: all 0.2s; position: relative; }
        .header-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .header-btn .notification-badge { position: absolute; top: 4px; right: 4px; min-width: 16px; height: 16px; background: #ef4444; border-radius: 10px; color: white; font-size: 10px; font-weight: 600; display: flex; align-items: center; justify-content: center; padding: 0 4px; }
        .notification-container { position: relative; }
        .notification-panel { position: absolute; top: calc(100% + 12px); right: 0; width: 380px; max-height: 500px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 10000; display: none; overflow: hidden; }
        .notification-panel.active { display: block; }
        .notification-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: linear-gradient(135deg, #84cc16, #65a30d); color: white; }
        .notification-header h3 { margin: 0; font-size: 16px; font-weight: 600; }
        .notification-list { max-height: 340px; overflow-y: auto; }
        .notification-item { display: flex; gap: 12px; padding: 14px 20px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: all 0.2s; }
        .notification-item:hover { background: #f8f8f8; }
        .notification-item.unread { background: #f0fdf4; border-left: 3px solid #84cc16; }
        .notification-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .notification-icon.success { background: #dcfce7; color: #22c55e; }
        .notification-icon.warning { background: #fef3c7; color: #f59e0b; }
        .notification-icon.error { background: #fee2e2; color: #ef4444; }
        .notification-icon.info { background: #dbeafe; color: #3b82f6; }
        .notification-content { flex: 1; }
        .notification-title { font-size: 13px; font-weight: 600; color: #333; margin-bottom: 4px; }
        .notification-message { font-size: 12px; color: #666; }
        .notification-time { font-size: 11px; color: #999; margin-top: 6px; }
        .notification-footer { padding: 12px 20px; background: #f8f8f8; text-align: center; border-top: 1px solid #e5e5e5; }
        .notification-footer a { color: #84cc16; text-decoration: none; font-size: 13px; font-weight: 500; }
        .user-greeting { display: flex; align-items: center; gap: 12px; margin-left: 16px; color: #8b8b9a; font-size: 13px; }
        .user-greeting strong { color: white; }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #84cc16, #65a30d); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: 600; overflow: hidden; }
        .user-avatar img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .user-avatar img.visible { display: block; }
        .user-avatar .user-initial { display: block; }
        .user-avatar img.visible + .user-initial { display: none; }

        /* PAGE */
        .page-content { flex: 1; overflow-y: auto; padding: 24px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .page-title-section h1 { font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }
        .page-title-section h1 i { color: var(--primary-blue); }
        .page-title-section p { font-size: 14px; color: var(--text-secondary); }
        .page-actions { display: flex; gap: 12px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--primary-blue); color: white; }
        .btn-primary:hover { background: #65a30d; }
        .btn-secondary { background: white; color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-success { background: var(--success); color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }

        /* FILTERS */
        .filters-bar { display: flex; gap: 16px; margin-bottom: 24px; background: white; padding: 16px 20px; border-radius: 12px; flex-wrap: wrap; align-items: center; }
        .filter-group { display: flex; align-items: center; gap: 8px; }
        .filter-group label { font-size: 13px; font-weight: 500; color: var(--text-secondary); }
        .filter-group select, .filter-group input { padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 13px; min-width: 150px; }

        /* RELATORIOS GRID */
        .relatorios-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .relatorio-card { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.3s; cursor: pointer; }
        .relatorio-card:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.12); }
        .relatorio-icon { width: 56px; height: 56px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 16px; }
        .relatorio-icon.blue { background: rgba(59,130,246,0.1); color: var(--info); }
        .relatorio-icon.green { background: rgba(34,197,94,0.1); color: var(--success); }
        .relatorio-icon.orange { background: rgba(245,158,11,0.1); color: var(--warning); }
        .relatorio-icon.purple { background: rgba(139,92,246,0.1); color: #8b5cf6; }
        .relatorio-icon.red { background: rgba(239,68,68,0.1); color: var(--danger); }
        .relatorio-icon.teal { background: rgba(20,184,166,0.1); color: #14b8a6; }
        .relatorio-card h3 { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .relatorio-card p { font-size: 13px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5; }
        .relatorio-actions { display: flex; gap: 8px; }

        /* CARD */
        .card { background: white; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); overflow: hidden; margin-bottom: 24px; }
        .card-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .card-header h3 i { color: var(--primary-blue); }
        .card-body { padding: 24px; }

        /* CHARTS GRID */
        .charts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 24px; }
        .chart-container { height: 300px; position: relative; }

        /* TABLE */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: var(--bg-gray); padding: 14px 20px; text-align: left; font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
        .data-table td { padding: 16px 20px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .data-table tr:hover { background: var(--bg-gray); }
        .data-table tfoot td { background: var(--bg-gray); font-weight: 700; }
        .valor-cell { font-weight: 600; }
        .valor-cell.positivo { color: var(--success); }
        .valor-cell.negativo { color: var(--danger); }

        /* SUMMARY BOX */
        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .summary-box { background: var(--bg-gray); border-radius: 12px; padding: 20px; text-align: center; }
        .summary-box h4 { font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; }
        .summary-box .value { font-size: 24px; font-weight: 700; }
        .summary-box .value.blue { color: var(--primary-blue); }
        .summary-box .value.green { color: var(--success); }
        .summary-box .value.red { color: var(--danger); }
        .summary-box .value.orange { color: var(--warning); }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: white; border-radius: 20px; width: 100%; max-width: 900px; max-height: 90vh; overflow: hidden; }
        .modal-header { padding: 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .modal-header h2 i { color: var(--primary-blue); }
        .modal-close { width: 36px; height: 36px; border: none; background: var(--bg-gray); border-radius: 10px; cursor: pointer; font-size: 18px; color: var(--text-secondary); }
        .modal-body { padding: 24px; overflow-y: auto; max-height: calc(90vh - 160px); }
        .modal-footer { padding: 20px 24px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px; }

        /* PRINT STYLES */
        @media print {
            .sidebar, .header, .page-actions, .filters-bar, .modal-overlay { display: none !important; }
            .main-area { margin-left: 0 !important; }
            .page-content { padding: 0 !important; }
            .card { box-shadow: none !important; border: 1px solid #ddd; }
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) { .charts-grid { grid-template-columns: 1fr; } .summary-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .relatorios-grid { grid-template-columns: 1fr; } .summary-grid { grid-template-columns: 1fr; } }
    </style></head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <a href="" class="sidebar-logo" title="Início"><i class="fas fa-home"></i></a>
            <nav class="sidebar-nav">
                <button class="sidebar-btn" title="Dashboard" onclick="location.href='index.html'"><i class="fas fa-chart-line"></i></button>
                <button class="sidebar-btn" title="Contas a Pagar" onclick="location.href='contas-pagar.html'"><i class="fas fa-file-invoice-dollar"></i></button>
                <button class="sidebar-btn" title="Contas a Receber" onclick="location.href='contas-receber.html'"><i class="fas fa-hand-holding-usd"></i></button>
                <button class="sidebar-btn" title="Bancos" onclick="location.href='bancos.html'"><i class="fas fa-university"></i></button>
                <button class="sidebar-btn" title="Fluxo de Caixa" onclick="location.href='fluxo-caixa.html'"><i class="fas fa-chart-area"></i></button>
                <button class="sidebar-btn" title="Conciliação" onclick="location.href='conciliacao.html'"><i class="fas fa-balance-scale"></i></button>
            </nav>
            <div class="sidebar-bottom">
                <button class="sidebar-btn active" title="Relatórios" onclick="location.href='relatorios.html'"><i class="fas fa-chart-bar"></i></button>
                <button class="sidebar-btn" title="Configurações"><i class="fas fa-cog"></i></button>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main-area">
            <header class="header">
    <link rel="icon" type="image/x-icon" href="../../public/favicon-aluforce.webp">
                <div class="header-left">
                    <div class="header-brand">
                        <span>Financeiro</span>
                        <span>|</span>
                        <span style="color: white;">Relatórios</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="notification-container">
                        <button class="header-btn notification-btn" title="Notificações">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                        </button>
                    </div>
                    <div class="user-greeting">
                        <span><span id="greeting-text">Bom dia</span>, <strong id="user-name">Usuário</strong></span>
                        <div class="user-avatar" id="user-avatar">
                            <img src="" alt="Foto do usuário" id="user-photo">
                            <span class="user-initial" id="user-initial">U</span>
                        </div>
                    </div>
                </div>
            </header>

            <div class="page-content">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-title-section">
                        <h1><i class="fas fa-chart-bar"></i> Relatórios Financeiros</h1>
                        <p>Analise os dados financeiros da empresa com relatórios detalhaçãos</p>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-secondary" onclick="agendarRelatorio()"><i class="fas fa-clock"></i> Agendar</button>
                        <button class="btn btn-primary" onclick="window.print()"><i class="fas fa-print"></i> Imprimir</button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <div class="filter-group">
                        <label>Período:</label>
                        <select id="filtroPeriodo" onchange="atualizarRelatorios()">
                            <option value="mes">Este Mês</option>
                            <option value="trimestre">Este Trimestre</option>
                            <option value="semestre">Este Semestre</option>
                            <option value="ano">Este Ano</option>
                            <option value="custom">Personalização</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>De:</label>
                        <input type="date" id="dataInicio" value="2024-12-01">
                    </div>
                    <div class="filter-group">
                        <label>Até:</label>
                        <input type="date" id="dataFim" value="2024-12-31">
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="atualizarRelatorios()"><i class="fas fa-sync"></i> Atualizar</button>
                </div>

                <!-- Relatórios Disponíveis -->
                <h2 style="font-size: 18px; margin-bottom: 16px;"><i class="fas fa-folder-open" style="color: var(--primary-blue);"></i> Relatórios Disponíveis</h2>
                <div class="relatorios-grid">
                    <div class="relatorio-card" onclick="abrirRelatorio('dre')">
                        <div class="relatorio-icon blue"><i class="fas fa-file-invoice-dollar"></i></div>
                        <h3>DRE - Demonstrativo de Resultados</h3>
                        <p>Receitas, custos, despesas e resultado líquido do período selecionação.</p>
                        <div class="relatorio-actions">
                            <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i> Visualizar</button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('dre', 'pdf')"><i class="fas fa-file-pdf"></i></button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('dre', 'excel')"><i class="fas fa-file-excel"></i></button>
                        </div>
                    </div>

                    <div class="relatorio-card" onclick="abrirRelatorio('fluxo')">
                        <div class="relatorio-icon green"><i class="fas fa-chart-line"></i></div>
                        <h3>Fluxo de Caixa Realização</h3>
                        <p>Movimentações de entrada e saída realizadas no período.</p>
                        <div class="relatorio-actions">
                            <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i> Visualizar</button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('fluxo', 'pdf')"><i class="fas fa-file-pdf"></i></button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('fluxo', 'excel')"><i class="fas fa-file-excel"></i></button>
                        </div>
                    </div>

                    <div class="relatorio-card" onclick="abrirRelatorio('contas-pagar')">
                        <div class="relatorio-icon red"><i class="fas fa-file-invoice"></i></div>
                        <h3>Contas a Pagar</h3>
                        <p>Listagem completa de contas a pagar por status e vencimento.</p>
                        <div class="relatorio-actions">
                            <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i> Visualizar</button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('contas-pagar', 'pdf')"><i class="fas fa-file-pdf"></i></button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('contas-pagar', 'excel')"><i class="fas fa-file-excel"></i></button>
                        </div>
                    </div>

                    <div class="relatorio-card" onclick="abrirRelatorio('contas-receber')">
                        <div class="relatorio-icon orange"><i class="fas fa-hand-holding-usd"></i></div>
                        <h3>Contas a Receber</h3>
                        <p>Listagem completa de contas a receber por cliente e status.</p>
                        <div class="relatorio-actions">
                            <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i> Visualizar</button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('contas-receber', 'pdf')"><i class="fas fa-file-pdf"></i></button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('contas-receber', 'excel')"><i class="fas fa-file-excel"></i></button>
                        </div>
                    </div>

                    <div class="relatorio-card" onclick="abrirRelatorio('despesas')">
                        <div class="relatorio-icon purple"><i class="fas fa-tags"></i></div>
                        <h3>Despesas por Categoria</h3>
                        <p>Análise detalhada das despesas agrupadas por categoria.</p>
                        <div class="relatorio-actions">
                            <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i> Visualizar</button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('despesas', 'pdf')"><i class="fas fa-file-pdf"></i></button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('despesas', 'excel')"><i class="fas fa-file-excel"></i></button>
                        </div>
                    </div>

                    <div class="relatorio-card" onclick="abrirRelatorio('bancos')">
                        <div class="relatorio-icon teal"><i class="fas fa-university"></i></div>
                        <h3>Posição Bancária</h3>
                        <p>Saldos e movimentações de todas as contas bancárias.</p>
                        <div class="relatorio-actions">
                            <button class="btn btn-secondary btn-sm"><i class="fas fa-eye"></i> Visualizar</button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('bancos', 'pdf')"><i class="fas fa-file-pdf"></i></button>
                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); exportarRelatorio('bancos', 'excel')"><i class="fas fa-file-excel"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Resumo do Período -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-calculator"></i> Resumo do Período</h3>
                        <span style="font-size: 13px; color: var(--text-secondary);">Dezembro 2024</span>
                    </div>
                    <div class="card-body">
                        <div class="summary-grid">
                            <div class="summary-box">
                                <h4>Receita Bruta</h4>
                                <div class="value blue" id="receitaBruta">R$ 245.800,00</div>
                            </div>
                            <div class="summary-box">
                                <h4>Despesas Totais</h4>
                                <div class="value red" id="despesasTotais">R$ 168.450,00</div>
                            </div>
                            <div class="summary-box">
                                <h4>Resultado Líquido</h4>
                                <div class="value green" id="resultadoLiquido">R$ 77.350,00</div>
                            </div>
                            <div class="summary-box">
                                <h4>Margem Líquida</h4>
                                <div class="value orange" id="margemLiquida">31,5%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="charts-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-bar"></i> Receitas vs Despesas</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="receitasDespesasChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-pie"></i> Despesas por Categoria</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="despesasCategoriaChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabela DRE Simplificação -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-alt"></i> DRE Simplificação - Dezembro 2024</h3>
                        <button class="btn btn-secondary btn-sm" onclick="exportarRelatorio('dre', 'excel')"><i class="fas fa-download"></i> Exportar</button>
                    </div>
                    <table class="data-table" id="tabelaDRE">
                        <thead>
                            <tr>
                                <th>Descrição</th>
                                <th style="text-align: right;">Valor</th>
                                <th style="text-align: right;">%</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>RECEITA BRUTA</strong></td>
                                <td style="text-align: right;" class="valor-cell positivo">R$ 245.800,00</td>
                                <td style="text-align: right;">100%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Vendas de Produtos</td>
                                <td style="text-align: right;">R$ 185.200,00</td>
                                <td style="text-align: right;">75,3%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Serviços</td>
                                <td style="text-align: right;">R$ 60.600,00</td>
                                <td style="text-align: right;">24,7%</td>
                            </tr>
                            <tr style="background: #f1f5f9;">
                                <td><strong>(-) DEDUÇÕES</strong></td>
                                <td style="text-align: right;" class="valor-cell negativo">R$ 24.580,00</td>
                                <td style="text-align: right;">10%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Impostos sobre vendas</td>
                                <td style="text-align: right;">R$ 24.580,00</td>
                                <td style="text-align: right;">10%</td>
                            </tr>
                            <tr style="background: #e0f2fe;">
                                <td><strong>RECEITA LÍQUIDA</strong></td>
                                <td style="text-align: right;"><strong>R$ 221.220,00</strong></td>
                                <td style="text-align: right;"><strong>90%</strong></td>
                            </tr>
                            <tr style="background: #f1f5f9;">
                                <td><strong>(-) CUSTOS</strong></td>
                                <td style="text-align: right;" class="valor-cell negativo">R$ 98.320,00</td>
                                <td style="text-align: right;">40%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Matéria-prima</td>
                                <td style="text-align: right;">R$ 68.420,00</td>
                                <td style="text-align: right;">27,8%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Mão de obra direta</td>
                                <td style="text-align: right;">R$ 29.900,00</td>
                                <td style="text-align: right;">12,2%</td>
                            </tr>
                            <tr style="background: #e0f2fe;">
                                <td><strong>LUCRO BRUTO</strong></td>
                                <td style="text-align: right;"><strong>R$ 122.900,00</strong></td>
                                <td style="text-align: right;"><strong>50%</strong></td>
                            </tr>
                            <tr style="background: #f1f5f9;">
                                <td><strong>(-) DESPESAS OPERACIONAIS</strong></td>
                                <td style="text-align: right;" class="valor-cell negativo">R$ 45.550,00</td>
                                <td style="text-align: right;">18,5%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Despesas administrativas</td>
                                <td style="text-align: right;">R$ 18.200,00</td>
                                <td style="text-align: right;">7,4%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Despesas comerciais</td>
                                <td style="text-align: right;">R$ 12.350,00</td>
                                <td style="text-align: right;">5%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Despesas financeiras</td>
                                <td style="text-align: right;">R$ 8.500,00</td>
                                <td style="text-align: right;">3,5%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 30px;">Outras despesas</td>
                                <td style="text-align: right;">R$ 6.500,00</td>
                                <td style="text-align: right;">2,6%</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr style="background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%); color: white;">
                                <td><strong>RESULTADO LÍQUIDO</strong></td>
                                <td style="text-align: right;"><strong>R$ 77.350,00</strong></td>
                                <td style="text-align: right;"><strong>31,5%</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Relatório -->
    <div class="modal-overlay" id="modalRelatorio">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-file-alt"></i> <span id="modalRelatorioTitulo">Relatório</span></h2>
                <button class="modal-close" onclick="fecharModal('modalRelatorio')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="modalRelatorioBody">
                <!-- Conteúdo dinâmico -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModal('modalRelatorio')">Fechar</button>
                <button class="btn btn-secondary" onclick="exportarRelatorioAtual('pdf')"><i class="fas fa-file-pdf"></i> PDF</button>
                <button class="btn btn-success" onclick="exportarRelatorioAtual('excel')"><i class="fas fa-file-excel"></i> Excel</button>
            </div>
        </div>
    </div>

    <script>
        let relatorioAtual = '';

        // Init
        document.addEventListener('DOMContentLoaded', function() {
            carregarUsuario();
            inicializarGraficos();
        });

        async function carregarUsuario() {
            try {
                const response = await fetch('/api/me', { credentials: 'include' });
                if (response.ok) {
                    const user = await response.json();
                    // Usar apelido se disponível, senão primeiro nome
                    const userName = user.apelido || user.nome || 'Usuário';
                    const primeiroNome = user.apelido || (user.nome  user.nome.split(' ')[0] : 'Usuário');

                    // Atualizar saudação dinâmica baseada na hora
                    const greetingTextEl = document.getElementById('greeting-text');
                    if (greetingTextEl) {
                        const hour = new Date().getHours();
                        let greeting = 'Bom dia';
                        if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
                        else if (hour >= 18 || hour < 5) greeting = 'Boa noite';
                        greetingTextEl.textContent = greeting;
                    }
                    document.getElementById('user-name').textContent = primeiroNome;
                    document.getElementById('user-initial').textContent = primeiroNome.charAt(0).toUpperCase();
                    
                    if (user.avatar && user.avatar !== '/avatars/default.webp') {
                        const foto = document.getElementById('user-photo');
                        foto.src = user.avatar;
                        foto.onload = () => foto.classList.add('visible');
                    }
                }
            } catch (e) { console.log('Erro ao carregar usuário'); }
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        }

        function inicializarGraficos() {
            // Gráfico Receitas vs Despesas
            const ctx1 = document.getElementById('receitasDespesasChart').getContext('2d');
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [
                        {
                            label: 'Receitas',
                            data: [198000, 215000, 225000, 238000, 242000, 245800],
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderRadius: 6
                        },
                        {
                            label: 'Despesas',
                            data: [145000, 158000, 162000, 172000, 165000, 168450],
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatarMoeda(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + (value / 1000) + 'k';
                                }
                            }
                        }
                    }
                }
            });

            // Gráfico Despesas por Categoria
            const ctx2 = document.getElementById('despesasCategoriaChart').getContext('2d');
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Pessoal', 'Fornecedores', 'Impostos', 'Operacional', 'Financeiro', 'Outros'],
                    datasets: [{
                        data: [45000, 52000, 24580, 18200, 8500, 20170],
                        backgroundColor: [
                            '#84cc16',
                            '#65a30d',
                            '#ef4444',
                            '#f59e0b',
                            '#8b5cf6',
                            '#64748b'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.raw / total) * 100).toFixed(1);
                                    return context.label + ': ' + formatarMoeda(context.raw) + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        function atualizarRelatorios() {
            const periodo = document.getElementById('filtroPeriodo').value;
            console.log('Atualizando relatórios para período:', periodo);
            // Aqui atualizaria os dados baseado no período
            alert('Relatórios atualizaçãos para o período selecionação');
        }

        function abrirRelatorio(tipo) {
            relatorioAtual = tipo;
            const titulos = {
                'dre': 'DRE - Demonstrativo de Resultados',
                'fluxo': 'Fluxo de Caixa Realização',
                'contas-pagar': 'Relatório de Contas a Pagar',
                'contas-receber': 'Relatório de Contas a Receber',
                'despesas': 'Despesas por Categoria',
                'bancos': 'Posição Bancária'
            };

            document.getElementById('modalRelatorioTitulo').textContent = titulos[tipo] || 'Relatório';
            document.getElementById('modalRelatorioBody').innerHTML = gerarConteudoRelatorio(tipo);
            document.getElementById('modalRelatorio').classList.add('active');
        }

        function gerarConteudoRelatorio(tipo) {
            switch(tipo) {
                case 'contas-pagar':
                    return `
                        <div class="summary-grid" style="margin-bottom: 20px;">
                            <div class="summary-box"><h4>Total a Pagar</h4><div class="value red">R$ 45.850,00</div></div>
                            <div class="summary-box"><h4>Vencidas</h4><div class="value orange">R$ 8.500,00</div></div>
                            <div class="summary-box"><h4>A Vencer</h4><div class="value blue">R$ 37.350,00</div></div>
                            <div class="summary-box"><h4>Pago no Mês</h4><div class="value green">R$ 168.450,00</div></div>
                        </div>
                        <table class="data-table">
                            <thead><tr><th>Fornecedor</th><th>Vencimento</th><th>Valor</th><th>Status</th></tr></thead>
                            <tbody>
                                <tr><td>Alumínios Brasil</td><td>20/12/2024</td><td>R$ 15.800,00</td><td><span style="color:var(--danger)">Vencida</span></td></tr>
                                <tr><td>Vidros São Paulo</td><td>25/12/2024</td><td>R$ 8.500,00</td><td><span style="color:var(--warning)">Próxima</span></td></tr>
                                <tr><td>Ferragens Central</td><td>28/12/2024</td><td>R$ 4.250,00</td><td><span style="color:var(--success)">Em dia</span></td></tr>
                                <tr><td>Transporte Express</td><td>30/12/2024</td><td>R$ 2.800,00</td><td><span style="color:var(--success)">Em dia</span></td></tr>
                            </tbody>
                        </table>
                    `;
                case 'contas-receber':
                    return `
                        <div class="summary-grid" style="margin-bottom: 20px;">
                            <div class="summary-box"><h4>Total a Receber</h4><div class="value blue">R$ 125.400,00</div></div>
                            <div class="summary-box"><h4>Vencidas</h4><div class="value red">R$ 18.200,00</div></div>
                            <div class="summary-box"><h4>A Vencer</h4><div class="value green">R$ 107.200,00</div></div>
                            <div class="summary-box"><h4>Recebido no Mês</h4><div class="value green">R$ 245.800,00</div></div>
                        </div>
                        <table class="data-table">
                            <thead><tr><th>Cliente</th><th>Vencimento</th><th>Valor</th><th>Status</th></tr></thead>
                            <tbody>
                                <tr><td>Construtora ABC</td><td>22/12/2024</td><td>R$ 45.800,00</td><td><span style="color:var(--success)">Em dia</span></td></tr>
                                <tr><td>Imobiliária XYZ</td><td>18/12/2024</td><td>R$ 18.200,00</td><td><span style="color:var(--danger)">Vencida</span></td></tr>
                                <tr><td>Arquitetura Design</td><td>28/12/2024</td><td>R$ 32.400,00</td><td><span style="color:var(--success)">Em dia</span></td></tr>
                                <tr><td>Engenharia Total</td><td>30/12/2024</td><td>R$ 29.000,00</td><td><span style="color:var(--success)">Em dia</span></td></tr>
                            </tbody>
                        </table>
                    `;
                case 'bancos':
                    return `
                        <div class="summary-grid" style="margin-bottom: 20px;">
                            <div class="summary-box"><h4>Saldo Total</h4><div class="value blue">R$ 171.651,45</div></div>
                            <div class="summary-box"><h4>Contas Ativas</h4><div class="value green">4</div></div>
                            <div class="summary-box"><h4>Entradas Mês</h4><div class="value green">R$ 140.000,00</div></div>
                            <div class="summary-box"><h4>Saídas Mês</h4><div class="value red">R$ 97.000,00</div></div>
                        </div>
                        <table class="data-table">
                            <thead><tr><th>Banco</th><th>Agência</th><th>Conta</th><th style="text-align:right">Saldo</th></tr></thead>
                            <tbody>
                                <tr><td><strong>Banco do Brasil</strong></td><td>1234</td><td>12345-6</td><td style="text-align:right" class="valor-cell positivo">R$ 85.420,50</td></tr>
                                <tr><td><strong>Itaú</strong></td><td>4567</td><td>78901-2</td><td style="text-align:right" class="valor-cell positivo">R$ 42.890,75</td></tr>
                                <tr><td><strong>Bradesco</strong></td><td>7890</td><td>34567-8</td><td style="text-align:right" class="valor-cell positivo">R$ 28.340,20</td></tr>
                                <tr><td><strong>Nubank</strong></td><td>0001</td><td>9876543-2</td><td style="text-align:right" class="valor-cell positivo">R$ 15.000,00</td></tr>
                            </tbody>
                            <tfoot>
                                <tr><td colspan="3"><strong>TOTAL</strong></td><td style="text-align:right"><strong>R$ 171.651,45</strong></td></tr>
                            </tfoot>
                        </table>
                    `;
                default:
                    return '<p>Carregando relatório...</p>';
            }
        }

        function fecharModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function exportarRelatorio(tipo, formato) {
            alert(`Exportando relatório "${tipo}" em formato ${formato.toUpperCase()}...`);
        }

        function exportarRelatorioAtual(formato) {
            exportarRelatorio(relatorioAtual, formato);
        }

        function agendarRelatorio() {
            alert('Funcionalidade de agendamento de relatórios:\n\n• Diário\n• Semanal\n• Mensal\n\nEnvio por e-mail automático.');
        }

        // Sistema de Notificações gerenciação pelo NotificationsManager global
    </script>

    <script src="financeiro.js"></script>
    <script src="public/js/financeiro-user-loader.jsv=20251227"></script>
    
    <!-- Sistema de Notificações Global -->
    <script src="public/js/notifications-manager.jsv=20251227"></script>
    <script src="public/js/notification-button.jsv=20251227"></script>
    
    <!-- Sistema de Chat e Suporte -->
    <script src="public/js/chat-suporte-widgets.jsv=20260103"></script>
    
    <!-- Sistema de Monitoramento de Conexão -->
    <script src="../_shared/connection-monitor.jsv=20251227"></script></body>
</html>

