<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="icon" type="image/x-icon" href="/favicon-aluforce.webp">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALUFORCE - Conciliação Bancária</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --sidebar-width: 56px;
            --header-height: 48px;
            --primary-blue: #84cc16;
            --primary-dark: #1a1a2e;
            --bg-gray: #f8fafc;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-gray); color: var(--text-primary); }
        .app-container { display: flex; height: 100vh; }

        /* SIDEBAR */
        .sidebar { width: var(--sidebar-width); background: var(--primary-dark); display: flex; flex-direction: column; align-items: center; padding: 12px 0; z-index: 100; position: fixed; height: 100vh; }
        .sidebar-logo { width: 36px; height: 36px; background: var(--primary-blue); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; text-decoration: none; }
        .sidebar-logo i { color: white; font-size: 18px; }
        .sidebar-nav { display: flex; flex-direction: column; gap: 4px; flex: 1; }
        .sidebar-btn { width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.2s; }
        .sidebar-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .sidebar-btn.active { background: var(--primary-blue); color: white; }
        .sidebar-bottom { margin-top: auto; display: flex; flex-direction: column; gap: 4px; }

        /* MAIN */
        .main-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; margin-left: var(--sidebar-width); }

        /* HEADER */
        .header { height: var(--header-height); background: var(--primary-dark); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .header-brand { display: flex; align-items: center; gap: 8px; }
        .header-brand img { height: 24px; }
        .header-brand span { font-size: 14px; font-weight: 600; color: #8b8b9a; }
        .header-right { display: flex; align-items: center; gap: 8px; }
        .header-btn { width: 36px; height: 36px; border: none; background: transparent; color: #8b8b9a; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: all 0.2s; position: relative; }
        .header-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .header-btn .notification-badge { position: absolute; top: 4px; right: 4px; min-width: 16px; height: 16px; background: #ef4444; border-radius: 10px; color: white; font-size: 10px; font-weight: 600; display: flex; align-items: center; justify-content: center; padding: 0 4px; }
        .notification-container { position: relative; }
        .notification-panel { position: absolute; top: calc(100% + 12px); right: 0; width: 380px; max-height: 500px; background: white; border-radius: 12px; box-shaçãow: 0 10px 40px rgba(0,0,0,0.2); z-index: 10000; display: none; overflow: hidden; }
        .notification-panel.active { display: block; }
        .notification-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: linear-gradient(135deg, #84cc16, #65a30d); color: white; }
        .notification-header h3 { margin: 0; font-size: 16px; font-weight: 600; }
        .notification-list { max-height: 340px; overflow-y: auto; }
        .notification-item { display: flex; gap: 12px; padding: 14px 20px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: all 0.2s; }
        .notification-item:hover { background: #f8f8f8; }
        .notification-item.unread { background: #f0fdf4; border-left: 3px solid #84cc16; }
        .notification-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .notification-icon.success { background: #dcfce7; color: #22c55e; }
        .notification-icon.warning { background: #fef3c7; color: #f59e0b; }
        .notification-icon.error { background: #fee2e2; color: #ef4444; }
        .notification-icon.info { background: #dbeafe; color: #3b82f6; }
        .notification-content { flex: 1; }
        .notification-title { font-size: 13px; font-weight: 600; color: #333; margin-bottom: 4px; }
        .notification-message { font-size: 12px; color: #666; }
        .notification-time { font-size: 11px; color: #999; margin-top: 6px; }
        .notification-footer { padding: 12px 20px; background: #f8f8f8; text-align: center; border-top: 1px solid #e5e5e5; }
        .notification-footer a { color: #84cc16; text-decoration: none; font-size: 13px; font-weight: 500; }
        .user-greeting { display: flex; align-items: center; gap: 12px; margin-left: 16px; color: #8b8b9a; font-size: 13px; }
        .user-greeting strong { color: white; }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #84cc16, #65a30d); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: 600; overflow: hidden; }
        .user-avatar img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .user-avatar img.visible { display: block; }
        .user-avatar .user-initial { display: block; }
        .user-avatar img.visible + .user-initial { display: none; }

        /* PAGE */
        .page-content { flex: 1; overflow-y: auto; padding: 24px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .page-title-section h1 { font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }
        .page-title-section h1 i { color: var(--primary-blue); }
        .page-title-section p { font-size: 14px; color: var(--text-secondary); }
        .page-actions { display: flex; gap: 12px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--primary-blue); color: white; }
        .btn-primary:hover { background: #65a30d; }
        .btn-secondary { background: white; color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }

        /* KPI CARDS */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        .kpi-card { background: white; border-radius: 16px; padding: 24px; box-shaçãow: 0 1px 3px rgba(0,0,0,0.05); }
        .kpi-card.highlight { background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%); color: white; }
        .kpi-card.highlight .kpi-content h3 { color: rgba(255,255,255,0.8); }
        .kpi-card.highlight .kpi-icon { background: rgba(255,255,255,0.2); color: white; }
        .kpi-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .kpi-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .kpi-icon.blue { background: rgba(59,130,246,0.1); color: var(--info); }
        .kpi-icon.green { background: rgba(34,197,94,0.1); color: var(--success); }
        .kpi-icon.orange { background: rgba(245,158,11,0.1); color: var(--warning); }
        .kpi-icon.red { background: rgba(239,68,68,0.1); color: var(--danger); }
        .kpi-content h3 { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
        .kpi-value { font-size: 28px; font-weight: 700; }

        /* FILTERS */
        .filters-bar { display: flex; gap: 16px; margin-bottom: 24px; background: white; padding: 16px 20px; border-radius: 12px; flex-wrap: wrap; align-items: center; }
        .filter-group { display: flex; align-items: center; gap: 8px; }
        .filter-group label { font-size: 13px; font-weight: 500; color: var(--text-secondary); }
        .filter-group select, .filter-group input { padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 13px; min-width: 180px; }
        .filter-group select:focus, .filter-group input:focus { outline: none; border-color: var(--primary-blue); }

        /* CONCILIACAO GRID */
        .conciliacao-grid { display: grid; grid-template-columns: 1fr 80px 1fr; gap: 24px; margin-bottom: 24px; }
        .conciliacao-panel { background: white; border-radius: 16px; overflow: hidden; box-shaçãow: 0 1px 3px rgba(0,0,0,0.05); }
        .panel-header { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .panel-header h3 { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .panel-header h3 i { color: var(--primary-blue); }
        .panel-header .saldo { font-size: 18px; font-weight: 700; }
        .panel-header .saldo.positivo { color: var(--success); }
        .panel-header .saldo.negativo { color: var(--danger); }
        .panel-body { max-height: 500px; overflow-y: auto; }

        /* MATCH COLUMN */
        .match-column { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; padding: 20px 0; }
        .match-btn { width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; font-size: 20px; transition: all 0.3s; }
        .match-btn.link { background: var(--success); color: white; }
        .match-btn.link:hover { transform: scale(1.1); box-shaçãow: 0 4px 15px rgba(34,197,94,0.4); }
        .match-btn.unlink { background: var(--danger); color: white; }
        .match-btn.auto { background: var(--primary-blue); color: white; }
        .match-info { text-align: center; font-size: 12px; color: var(--text-secondary); }

        /* ITEM LIST */
        .item-list { list-style: none; }
        .item-row { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f1f5f9; cursor: pointer; transition: all 0.2s; }
        .item-row:hover { background: var(--bg-gray); }
        .item-row.selected { background: rgba(132,204,22,0.05); border-left: 3px solid var(--primary-blue); }
        .item-row.conciliação { background: rgba(34,197,94,0.05); }
        .item-row.conciliação::after { content: '✓'; position: absolute; right: 20px; color: var(--success); font-weight: bold; }
        .item-check { width: 20px; height: 20px; border: 2px solid var(--border-color); border-radius: 4px; margin-right: 12px; display: flex; align-items: center; justify-content: center; }
        .item-check.checked { background: var(--primary-blue); border-color: var(--primary-blue); color: white; }
        .item-info { flex: 1; }
        .item-info .data { font-size: 11px; color: var(--text-secondary); margin-bottom: 4px; }
        .item-info .descricao { font-size: 13px; font-weight: 500; }
        .item-valor { font-size: 14px; font-weight: 600; text-align: right; }
        .item-valor.entrada { color: var(--success); }
        .item-valor.saida { color: var(--danger); }

        /* STATUS BADGES */
        .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .status-badge.pendente { background: rgba(245,158,11,0.1); color: var(--warning); }
        .status-badge.conciliação { background: rgba(34,197,94,0.1); color: var(--success); }
        .status-badge.divergente { background: rgba(239,68,68,0.1); color: var(--danger); }

        /* CARD */
        .card { background: white; border-radius: 16px; box-shaçãow: 0 1px 3px rgba(0,0,0,0.05); overflow: hidden; }
        .card-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .card-header h3 i { color: var(--primary-blue); }

        /* TABLE */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: var(--bg-gray); padding: 14px 20px; text-align: left; font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
        .data-table td { padding: 16px 20px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .data-table tr:hover { background: var(--bg-gray); }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: white; border-radius: 20px; width: 100%; max-width: 500px; max-height: 90vh; overflow: hidden; }
        .modal-header { padding: 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .modal-header h2 i { color: var(--primary-blue); }
        .modal-close { width: 36px; height: 36px; border: none; background: var(--bg-gray); border-radius: 10px; cursor: pointer; font-size: 18px; color: var(--text-secondary); }
        .modal-body { padding: 24px; }
        .modal-footer { padding: 20px 24px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px; }

        /* UPLOAD AREA */
        .upload-area { border: 2px dashed var(--border-color); border-radius: 16px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .upload-area:hover { border-color: var(--primary-blue); background: rgba(30,64,175,0.02); }
        .upload-area i { font-size: 48px; color: var(--text-secondary); margin-bottom: 16px; }
        .upload-area h4 { font-size: 16px; margin-bottom: 8px; }
        .upload-area p { font-size: 13px; color: var(--text-secondary); }
        .upload-area input { display: none; }

        /* RESPONSIVE */
        @media (max-width: 1400px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } .conciliacao-grid { grid-template-columns: 1fr; } .match-column { flex-direction: row; padding: 20px; } }
        @media (max-width: 768px) { .kpi-grid { grid-template-columns: 1fr; } .filters-bar { flex-direction: column; align-items: stretch; } }
    </style></head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <a href="" class="sidebar-logo" title="Início"><i class="fas fa-home"></i></a>
            <nav class="sidebar-nav">
                <button class="sidebar-btn" title="Dashboard" onclick="location.href='index.html'"><i class="fas fa-chart-line"></i></button>
                <button class="sidebar-btn" title="Contas a Pagar" onclick="location.href='contas-pagar.html'"><i class="fas fa-file-invoice-dollar"></i></button>
                <button class="sidebar-btn" title="Contas a Receber" onclick="location.href='contas-receber.html'"><i class="fas fa-hand-holding-usd"></i></button>
                <button class="sidebar-btn" title="Bancos" onclick="location.href='bancos.html'"><i class="fas fa-university"></i></button>
                <button class="sidebar-btn" title="Fluxo de Caixa" onclick="location.href='fluxo-caixa.html'"><i class="fas fa-chart-area"></i></button>
                <button class="sidebar-btn active" title="Conciliação" onclick="location.href='conciliacao.html'"><i class="fas fa-balance-scale"></i></button>
            </nav>
            <div class="sidebar-bottom">
                <button class="sidebar-btn" title="Relatórios" onclick="location.href='relatorios.html'"><i class="fas fa-chart-bar"></i></button>
                <button class="sidebar-btn" title="Configurações"><i class="fas fa-cog"></i></button>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main-area">
            <header class="header">
    <link rel="icon" type="image/x-icon" href="/favicon-aluforce.webp">
                <div class="header-left">
                    <div class="header-brand">
                        <span>Financeiro</span>
                        <span>|</span>
                        <span style="color: white;">Conciliação</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="notification-container">
                        <button class="header-btn notification-btn" title="Notificações">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                        </button>
                    </div>
                    <div class="user-greeting">
                        <span><span id="greeting-text">Bom dia</span>, <strong id="user-name">Usuário</strong></span>
                        <div class="user-avatar" id="user-avatar">
                            <img src="" alt="Foto do usuário" id="user-photo">
                            <span class="user-initial" id="user-initial">U</span>
                        </div>
                    </div>
                </div>
            </header>

            <div class="page-content">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-title-section">
                        <h1><i class="fas fa-balance-scale"></i> Conciliação Bancária</h1>
                        <p>Compare e concilie lançamentos do sistema com o extrato bancário</p>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-secondary" onclick="abrirModalImportar()"><i class="fas fa-file-import"></i> Importar OFX</button>
                        <button class="btn btn-primary" onclick="conciliarAutomatico()"><i class="fas fa-magic"></i> Conciliar Automático</button>
                    </div>
                </div>

                <!-- KPIs -->
                <div class="kpi-grid">
                    <div class="kpi-card highlight">
                        <div class="kpi-header">
                            <div class="kpi-icon"><i class="fas fa-check-double"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Lançamentos Conciliaçãos</h3>
                            <div class="kpi-value" id="totalConciliaçãos">0</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon orange"><i class="fas fa-clock"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Pendentes Sistema</h3>
                            <div class="kpi-value" id="pendentesSistema">0</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon blue"><i class="fas fa-file-alt"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Pendentes Extrato</h3>
                            <div class="kpi-value" id="pendentesExtrato">0</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon red"><i class="fas fa-exclamation-triangle"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Divergências</h3>
                            <div class="kpi-value" id="divergencias">0</div>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <div class="filter-group">
                        <label for="filtroBanco">Banco:</label>
                        <select id="filtroBanco" name="filtroBanco" onchange="aplicarFiltros()">
                            <option value="">Todos os bancos</option>
                            <option value="1" selected>Banco do Brasil - Principal</option>
                            <option value="2">Itaú - Fornecedores</option>
                            <option value="3">Bradesco - Recebimentos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Período:</label>
                        <input type="date" id="dataInicio" value="2024-12-01">
                        <span>até</span>
                        <input type="date" id="dataFim" value="2024-12-31">
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="aplicarFiltros()"><i class="fas fa-filter"></i> Filtrar</button>
                </div>

                <!-- Conciliação Grid -->
                <div class="conciliacao-grid">
                    <!-- Sistema -->
                    <div class="conciliacao-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-desktop"></i> Lançamentos do Sistema</h3>
                            <div class="saldo positivo" id="saldoSistema">R$ 85.420,50</div>
                        </div>
                        <div class="panel-body">
                            <ul class="item-list" id="listaSistema"></ul>
                        </div>
                    </div>

                    <!-- Match Column -->
                    <div class="match-column">
                        <button class="match-btn link" onclick="conciliarSelecionaçãos()" title="Conciliar Selecionaçãos">
                            <i class="fas fa-link"></i>
                        </button>
                        <button class="match-btn unlink" onclick="desconciliarSelecionaçãos()" title="Desfazer Conciliação">
                            <i class="fas fa-unlink"></i>
                        </button>
                        <button class="match-btn auto" onclick="conciliarAutomatico()" title="Conciliar Automático">
                            <i class="fas fa-magic"></i>
                        </button>
                        <div class="match-info">
                            Selecione itens<br>para conciliar
                        </div>
                    </div>

                    <!-- Extrato -->
                    <div class="conciliacao-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-file-invoice"></i> Extrato Bancário</h3>
                            <div class="saldo positivo" id="saldoExtrato">R$ 85.420,50</div>
                        </div>
                        <div class="panel-body">
                            <ul class="item-list" id="listaExtrato"></ul>
                        </div>
                    </div>
                </div>

                <!-- Histórico de Conciliações -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Histórico de Conciliações</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data Conciliação</th>
                                <th>Lançamento Sistema</th>
                                <th>Lançamento Extrato</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="historicoConciliacoes"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Importar OFX -->
    <div class="modal-overlay" id="modalImportar">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-file-import"></i> Importar Extrato</h2>
                <button class="modal-close" onclick="fecharModal('modalImportar')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="upload-area" onclick="document.getElementById('arquivoOFX').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>Arraste o arquivo ou clique para selecionar</h4>
                    <p>Formatos aceitos: OFX, QIF, CSV</p>
                    <input type="file" id="arquivoOFX" accept=".ofx,.qif,.csv" onchange="processarArquivo(this)">
                </div>
                <div id="arquivoInfo" style="margin-top: 16px; display: none;">
                    <p><i class="fas fa-file"></i> <span id="nomeArquivo"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModal('modalImportar')">Cancelar</button>
                <button class="btn btn-primary" onclick="importarExtrato()"><i class="fas fa-upload"></i> Importar</button>
            </div>
        </div>
    </div>

    <script>
        // Daçãos
        let lancamentosSistema = [
            { id: 1, data: '2024-12-20', descricao: 'Recebimento Cliente ABC', tipo: 'entrada', valor: 15000, conciliação: false },
            { id: 2, data: '2024-12-19', descricao: 'Pagamento Fornecedor XYZ', tipo: 'saida', valor: 8500, conciliação: true, extratoId: 2 },
            { id: 3, data: '2024-12-18', descricao: 'Venda Projeto Residencial', tipo: 'entrada', valor: 22000, conciliação: true, extratoId: 3 },
            { id: 4, data: '2024-12-17', descricao: 'Conta de Energia', tipo: 'saida', valor: 1850, conciliação: false },
            { id: 5, data: '2024-12-16', descricao: 'Folha de Pagamento', tipo: 'saida', valor: 28750, conciliação: true, extratoId: 5 },
            { id: 6, data: '2024-12-15', descricao: 'Recebimento Parcela', tipo: 'entrada', valor: 8500, conciliação: false },
            { id: 7, data: '2024-12-14', descricao: 'Material de Escritório', tipo: 'saida', valor: 450, conciliação: false },
        ];

        let lancamentosExtrato = [
            { id: 1, data: '2024-12-20', descricao: 'TED RECEBIDA - CLIENTE ABC LTDA', tipo: 'entrada', valor: 15000, conciliação: false },
            { id: 2, data: '2024-12-19', descricao: 'PAG FORNEC XYZ', tipo: 'saida', valor: 8500, conciliação: true, sistemaId: 2 },
            { id: 3, data: '2024-12-18', descricao: 'DEP CHEQUE', tipo: 'entrada', valor: 22000, conciliação: true, sistemaId: 3 },
            { id: 4, data: '2024-12-17', descricao: 'DEB AUT ELETROPAULO', tipo: 'saida', valor: 1850, conciliação: false },
            { id: 5, data: '2024-12-16', descricao: 'TRANSF SALARIOS', tipo: 'saida', valor: 28750, conciliação: true, sistemaId: 5 },
            { id: 6, data: '2024-12-15', descricao: 'TAXA DOC/TED', tipo: 'saida', valor: 12.50, conciliação: false },
            { id: 7, data: '2024-12-14', descricao: 'IOF', tipo: 'saida', valor: 35.80, conciliação: false },
        ];

        let historico = [
            { id: 1, data: '2024-12-19', sistemaDesc: 'Pagamento Fornecedor XYZ', extratoDesc: 'PAG FORNEC XYZ', valor: 8500, status: 'conciliação' },
            { id: 2, data: '2024-12-18', sistemaDesc: 'Venda Projeto Residencial', extratoDesc: 'DEP CHEQUE', valor: 22000, status: 'conciliação' },
            { id: 3, data: '2024-12-16', sistemaDesc: 'Folha de Pagamento', extratoDesc: 'TRANSF SALARIOS', valor: 28750, status: 'conciliação' },
        ];

        let sistemasSelecionaçãos = [];
        let extratosSelecionaçãos = [];

        // Init
        document.addEventListener('DOMContentLoaded', function() {
            carregarUsuario();
            atualizarKPIs();
            renderizarListas();
            renderizarHistorico();
        });

        async function carregarUsuario() {
            try {
                const response = await fetch('/api/me', { credentials: 'include' });
                if (response.ok) {
                    const user = await response.json();
                    // Usar apelido se disponível, senão primeiro nome
                    const userName = user.apelido || user.nome || 'Usuário';
                    const primeiroNome = user.apelido || (user.nome  user.nome.split(' ')[0] : 'Usuário');

                    // Atualizar saudação dinâmica baseada na hora
                    const greetingTextEl = document.getElementById('greeting-text');
                    if (greetingTextEl) {
                        const hour = new Date().getHours();
                        let greeting = 'Bom dia';
                        if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
                        else if (hour >= 18 || hour < 5) greeting = 'Boa noite';
                        greetingTextEl.textContent = greeting;
                    }
                    document.getElementById('user-name').textContent = primeiroNome;
                    document.getElementById('user-initial').textContent = primeiroNome.charAt(0).toUpperCase();
                    
                    if (user.avatar && user.avatar !== '/avatars/default.webp') {
                        const foto = document.getElementById('user-photo');
                        foto.src = user.avatar;
                        foto.onload = () => foto.classList.add('visible');
                    }
                }
            } catch (e) { console.log('Erro ao carregar usuário'); }
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        }

        function formatarData(data) {
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function atualizarKPIs() {
            const conciliaçãos = lancamentosSistema.filter(l => l.conciliação).length;
            const pendentesSistema = lancamentosSistema.filter(l => !l.conciliação).length;
            const pendentesExtrato = lancamentosExtrato.filter(l => !l.conciliação).length;
            
            // Calcular divergências (itens no extrato sem correspondente no sistema)
            const divergencias = lancamentosExtrato.filter(e => !e.conciliação && !lancamentosSistema.some(s => s.valor === e.valor && !s.conciliação)).length;

            document.getElementById('totalConciliaçãos').textContent = conciliaçãos;
            document.getElementById('pendentesSistema').textContent = pendentesSistema;
            document.getElementById('pendentesExtrato').textContent = pendentesExtrato;
            document.getElementById('divergencias').textContent = divergencias;
        }

        function renderizarListas() {
            // Sistema
            const listaSistema = document.getElementById('listaSistema');
            listaSistema.innerHTML = lancamentosSistema.map(item => `
                <li class="item-row ${item.conciliação ? 'conciliação' : ''} ${sistemasSelecionaçãos.includes(item.id)  'selected' : ''}" 
                    onclick="toggleSelecaoSistema(${item.id})" style="position: relative;">
                    <div class="item-check ${sistemasSelecionaçãos.includes(item.id)  'checked' : ''}">
                        ${sistemasSelecionaçãos.includes(item.id)  '<i class="fas fa-check" style="font-size:12px;"></i>' : ''}
                    </div>
                    <div class="item-info">
                        <div class="data">${formatarData(item.data)}</div>
                        <div class="descricao">${item.descricao}</div>
                    </div>
                    <div class="item-valor ${item.tipo}">
                        ${item.tipo === 'entrada'  '+' : '-'}${formatarMoeda(item.valor)}
                    </div>
                </li>
            `).join('');

            // Extrato
            const listaExtrato = document.getElementById('listaExtrato');
            listaExtrato.innerHTML = lancamentosExtrato.map(item => `
                <li class="item-row ${item.conciliação ? 'conciliação' : ''} ${extratosSelecionaçãos.includes(item.id)  'selected' : ''}"
                    onclick="toggleSelecaoExtrato(${item.id})" style="position: relative;">
                    <div class="item-check ${extratosSelecionaçãos.includes(item.id)  'checked' : ''}">
                        ${extratosSelecionaçãos.includes(item.id)  '<i class="fas fa-check" style="font-size:12px;"></i>' : ''}
                    </div>
                    <div class="item-info">
                        <div class="data">${formatarData(item.data)}</div>
                        <div class="descricao">${item.descricao}</div>
                    </div>
                    <div class="item-valor ${item.tipo}">
                        ${item.tipo === 'entrada'  '+' : '-'}${formatarMoeda(item.valor)}
                    </div>
                </li>
            `).join('');
        }

        function renderizarHistorico() {
            const tbody = document.getElementById('historicoConciliacoes');
            tbody.innerHTML = historico.map(item => `
                <tr>
                    <td>${formatarData(item.data)}</td>
                    <td>${item.sistemaDesc}</td>
                    <td>${item.extratoDesc}</td>
                    <td><strong>${formatarMoeda(item.valor)}</strong></td>
                    <td><span class="status-badge ${item.status}">${item.status === 'conciliação'  'Conciliação' : 'Divergente'}</span></td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="desconciliar(${item.id})">
                            <i class="fas fa-unlink"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function toggleSelecaoSistema(id) {
            const item = lancamentosSistema.find(l => l.id === id);
            if (item.conciliação) return;
            
            const index = sistemasSelecionaçãos.indexOf(id);
            if (index > -1) {
                sistemasSelecionaçãos.splice(index, 1);
            } else {
                sistemasSelecionaçãos.push(id);
            }
            renderizarListas();
        }

        function toggleSelecaoExtrato(id) {
            const item = lancamentosExtrato.find(l => l.id === id);
            if (item.conciliação) return;
            
            const index = extratosSelecionaçãos.indexOf(id);
            if (index > -1) {
                extratosSelecionaçãos.splice(index, 1);
            } else {
                extratosSelecionaçãos.push(id);
            }
            renderizarListas();
        }

        function conciliarSelecionaçãos() {
            if (sistemasSelecionaçãos.length === 0 || extratosSelecionaçãos.length === 0) {
                alert('Selecione pelo menos um item de cada lação para conciliar');
                return;
            }

            // Conciliar os itens selecionaçãos
            sistemasSelecionaçãos.forEach(sId => {
                const sis = lancamentosSistema.find(l => l.id === sId);
                if (sis) {
                    sis.conciliação = true;
                    sis.extratoId = extratosSelecionaçãos[0];
                }
            });

            extratosSelecionaçãos.forEach(eId => {
                const ext = lancamentosExtrato.find(l => l.id === eId);
                if (ext) {
                    ext.conciliação = true;
                    ext.sistemaId = sistemasSelecionaçãos[0];
                }
            });

            // Adicionar ao histórico
            const sis = lancamentosSistema.find(l => l.id === sistemasSelecionaçãos[0]);
            const ext = lancamentosExtrato.find(l => l.id === extratosSelecionaçãos[0]);
            if (sis && ext) {
                historico.unshift({
                    id: historico.length + 1,
                    data: new Date().toISOString().split('T')[0],
                    sistemaDesc: sis.descricao,
                    extratoDesc: ext.descricao,
                    valor: sis.valor,
                    status: 'conciliação'
                });
            }

            // Limpar seleções
            sistemasSelecionaçãos = [];
            extratosSelecionaçãos = [];

            atualizarKPIs();
            renderizarListas();
            renderizarHistorico();
            alert('Lançamentos conciliaçãos com sucesso!');
        }

        function desconciliarSelecionaçãos() {
            alert('Selecione um item conciliação no histórico para desfazer');
        }

        function conciliarAutomatico() {
            let conciliaçãos = 0;

            // Encontrar correspondências por valor e data próxima
            lancamentosSistema.filter(s => !s.conciliação).forEach(sis => {
                const match = lancamentosExtrato.find(ext => 
                    !ext.conciliação && 
                    ext.valor === sis.valor && 
                    ext.tipo === sis.tipo
                );

                if (match) {
                    sis.conciliação = true;
                    sis.extratoId = match.id;
                    match.conciliação = true;
                    match.sistemaId = sis.id;

                    historico.unshift({
                        id: historico.length + 1,
                        data: new Date().toISOString().split('T')[0],
                        sistemaDesc: sis.descricao,
                        extratoDesc: match.descricao,
                        valor: sis.valor,
                        status: 'conciliação'
                    });

                    conciliaçãos++;
                }
            });

            atualizarKPIs();
            renderizarListas();
            renderizarHistorico();
            alert(`Conciliação automática concluída!\n${conciliaçãos} lançamento(s) conciliação(s).`);
        }

        function desconciliar(id) {
            if (confirm('Deseja realmente desfazer esta conciliação')) {
                const item = historico.find(h => h.id === id);
                if (item) {
                    // Encontrar e desconciliar
                    const sis = lancamentosSistema.find(s => s.descricao === item.sistemaDesc);
                    const ext = lancamentosExtrato.find(e => e.descricao === item.extratoDesc);
                    
                    if (sis) {
                        sis.conciliação = false;
                        delete sis.extratoId;
                    }
                    if (ext) {
                        ext.conciliação = false;
                        delete ext.sistemaId;
                    }

                    // Remover do histórico
                    historico = historico.filter(h => h.id !== id);

                    atualizarKPIs();
                    renderizarListas();
                    renderizarHistorico();
                }
            }
        }

        function aplicarFiltros() {
            // Implementar filtros
            console.log('Filtros aplicaçãos');
            renderizarListas();
        }

        function abrirModalImportar() {
            document.getElementById('modalImportar').classList.add('active');
        }

        function fecharModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function processarArquivo(input) {
            if (input.files.length > 0) {
                document.getElementById('arquivoInfo').style.display = 'block';
                document.getElementById('nomeArquivo').textContent = input.files[0].name;
            }
        }

        function importarExtrato() {
            const arquivo = document.getElementById('arquivoOFX').files[0];
            if (!arquivo) {
                alert('Selecione um arquivo para importar');
                return;
            }

            // Simular importação
            fecharModal('modalImportar');
            alert('Extrato importação com sucesso!\n\nForam importaçãos 15 novos lançamentos.');
            
            // Adicionar alguns lançamentos de exemplo
            lancamentosExtrato.push(
                { id: 8, data: '2024-12-21', descricao: 'PIX RECEBIDO', tipo: 'entrada', valor: 3500, conciliação: false },
                { id: 9, data: '2024-12-21', descricao: 'TARIFA MANUT CONTA', tipo: 'saida', valor: 28.50, conciliação: false }
            );

            atualizarKPIs();
            renderizarListas();
        }

        // Sistema de Notificações gerenciação pelo NotificationsManager global
    </script>

    <script src="financeiro.js"></script>
    <script src="public/js/financeiro-user-loader.jsv=20251227"></script>
    
    <!-- Sistema de Notificações Global -->
    <script src="public/js/notifications-manager.jsv=20251227"></script>
    <script src="public/js/notification-button.jsv=20251227"></script>
    
    <!-- Sistema de Chat e Suporte -->
    <script src="public/js/chat-suporte-widgets.jsv=20260103"></script>
    
    <!-- Sistema de Monitoramento de Conexão -->
    <script src="../_shared/connection-monitor.jsv=20251227"></script></body>
</html>

