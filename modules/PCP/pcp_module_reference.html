<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- ConfiguraÃ§Ã£o Global - DEVE ser carregado PRIMEIRO -->
    <script src="../../public/js/config.js"></script>
    
    <link rel="icon" type="image/x-icon" href="../../public/favicon-aluforce.webp">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ALUFORCE - Planejamento e Controle da Produo</title>
    
    
    <link rel="stylesheet" href="pcp_modern_clean.cssv=18.0">
    <link rel="stylesheet" href="assets/css/relatorios.cssv=3.0">
    <link rel="stylesheet" href="estoque-styles.css">
    <link rel="stylesheet" href="materiais-enhanced.css">
    <link rel="stylesheet" href="materiais-modern.css">
    <link rel="stylesheet" href="producao-faturamento.cssv=6.0">
    <link rel="stylesheet" href="dashboard-modern.css">
    <link rel="stylesheet" href="modal-produto-professional.css">
    <link rel="stylesheet" href="modal-material-professional.css">
    <link rel="stylesheet" href="pcp-inline-fix.css">
    <link rel="stylesheet" href="modal-nova-ordem-premium-2025.cssv=4.2">
    <link rel="stylesheet" href="modal-nova-ordem-premium-2025-additions.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Estilos crticos para garantir layout de 4 colunas no dashboard -->
    <style>
        /* RESET - Esconder elementos do sistema principal que possam aparecer */
        body > nav:not(.sidebar-nav),
        body > aside:not(.sidebar),
        body > .menu-principal,
        body > .sidebar-sistema,
        body > ul:not(#sidebar ul),
        body > .overlay-menu {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }
        
        /* Garantir que o container principal do PCP ocupe tudo */
        body {
            overflow-x: hidden !important;
            background: #f3f4f6 !important;
        }
        
        .container-principal {
            position: relative !important;
            width: 100% !important;
            min-height: 100vh !important;
            isolation: isolate !important;
            z-index: 1 !important;
        }
        
        /* Z-index hierarchy do PCP */
        .topbar {
            z-index: 1000 !important;
        }
        
        .sidebar {
            z-index: 999 !important;
        }
        
        .main-content {
            z-index: 1 !important;
            position: relative !important;
        }
        
        /* Esconder overlay de menu externo */
        .menu-overlay,
        .sidebar-overlay.active,
        [class*="menu-principal"] {
            display: none !important;
        }
        
        /* Garantir que body no tenha menus extras */
        body::before,
        body::after {
            display: none !important;
        }
        
        /* FORAR LAYOUT DE 4 COLUNAS NO DASHBOARD */
        #dashboard-view .dashboard-grid {
            display: grid !important;
            grid-template-columns: repeat(4, 1fr) !important;
            gap: 20px !important;
            padding: 24px !important;
            margin-top: 0 !important;
        }
        
        /* Responsive */
        @media (max-width: 1400px) {
            #dashboard-view .dashboard-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
        
        @media (max-width: 768px) {
            #dashboard-view .dashboard-grid {
                grid-template-columns: 1fr !important;
            }
        }
        
        /* Garantir que os painis no tenham width fixo */
        #dashboard-view .panel {
            width: 100% !important;
            max-width: none !important;
        }
        
        /* ===== QUICK ACTIONS MODERNO ===== */
        .panel-header-modern {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .panel-header-modern .panel-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .panel-header-modern h2 {
            margin: 0 !important;
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            letter-spacing: -0.5px;
        }
        
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .btn-modern {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            text-align: left;
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }
        
        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: rgba(255, 255, 255, 0.4);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .btn-modern:hover::before {
            transform: translateX(0);
        }
        
        .btn-modern .btn-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .btn-modern .btn-content {
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
        }
        
        .btn-modern .btn-label {
            font-size: 15px;
            font-weight: 600;
            line-height: 1.2;
        }
        
        .btn-modern .btn-sublabel {
            font-size: 12px;
            opacity: 0.85;
            font-weight: 400;
        }
        
        /* Variaes de cores */
        .btn-modern-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(59, 130, 246, 0.25);
        }
        
        .btn-modern-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-modern-primary:active {
            transform: translateY(0);
        }
        
        .btn-modern-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.25);
        }
        
        .btn-modern-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-modern-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(107, 114, 128, 0.25);
        }
        
        .btn-modern-secondary:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4);
            transform: translateY(-2px);
        }
        
        .panel-footer-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 13px;
            color: #6b7280;
        }
        
        .panel-footer-info i {
            color: #3b82f6;
            font-size: 14px;
        }
        
        /* Animao de pulse no cone do header */
        @keyframes pulse-icon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .panel-header-modern .panel-icon {
            animation: pulse-icon 2s ease-in-out infinite;
        }
        
        /* Mobile */
        @media (max-width: 768px) {
            .btn-modern {
                padding: 14px;
            }
            
            .btn-modern .btn-icon {
                width: 42px;
                height: 42px;
                font-size: 18px;
            }
            
            .btn-modern .btn-label {
                font-size: 14px;
            }
            
            .btn-modern .btn-sublabel {
                font-size: 11px;
            }
        }
    </style>
    
    <!-- Estilos crticos para garantir visibilidade dos botes SKU/GTIN -->
    <style>
        /* CRTICO: Estilos dos botes de ao */
        .btn-editar-prod {
            background: linear-gradient(135deg, #5596ff, #1d4ed8) !important;
            color: white !important;
            padding: 0.375rem 0.75rem !important;
            font-size: 0.75rem !important;
            border: none !important;
            border-radius: 0.375rem !important;
            cursor: pointer !important;
            margin: 0 0.125rem !important;
            transition: all 0.2s ease !important;
            text-decoration: none !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.25rem !important;
            font-weight: 500 !important;
            min-width: 60px !important;
        }

        .btn-editar-prod:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
        }

        .btn-excluir-prod {
            background: linear-gradient(135deg, #ef4444, #dc2626) !important;
            color: white !important;
            padding: 0.375rem 0.75rem !important;
            font-size: 0.75rem !important;
            border: none !important;
            border-radius: 0.375rem !important;
            cursor: pointer !important;
            margin: 0 0.125rem !important;
            transition: all 0.2s ease !important;
            text-decoration: none !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.25rem !important;
            font-weight: 500 !important;
            min-width: 60px !important;
        }

        .btn-excluir-prod:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3) !important;
        }

        /* CRTICO: Estilos SKU e GTIN */
        .sku-badge {
            display: inline-block !important;
            background: linear-gradient(135deg, #10b981, #059669) !important;
            color: white !important;
            padding: 0.25rem 0.5rem !important;
            border-radius: 0.375rem !important;
            font-size: 0.75rem !important;
            font-weight: 600 !important;
            letter-spacing: 0.025em !important;
            text-transform: uppercase !important;
        }

        .gtin-text {
            font-family: 'Courier New', monospace !important;
            font-size: 0.875rem !important;
            color: #6b7280 !important;
            font-weight: 500 !important;
            background: #f3f4f6 !important;
            padding: 0.25rem 0.5rem !important;
            border-radius: 0.25rem !important;
        }

        /* CRTICO: Fora visibilidade das colunas */
        .estoque-table th:nth-child(3),
        .estoque-table td:nth-child(3) {
            display: table-cell !important;
            visibility: visible !important;
        }

        .estoque-table th:nth-child(4),
        .estoque-table td:nth-child(4) {
            display: table-cell !important;
            visibility: visible !important;
        }
    </style>
    
    <style>
        /* Accessibility helpers */
        .skip-link {
            position: absolute;
            left: -999px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        .skip-link:focus {
            left: 8px;
            top: 8px;
            width: auto;
            height: auto;
            background: #fff;
            padding: 8px 12px;
            z-index: 12150;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .sr-only { position: absolute !important; left: -9999px !important; }
        
        /* CSS para validao e campos obrigatrios */
        .required {
            color: #ef4444;
            font-weight: bold;
            margin-left: 2px;
        }
        
        .form-error {
            border: 2px solid #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 4px;
            display: block;
            font-weight: 500;
        }
        
        .validation-summary {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
            color: #dc2626;
        }
        
        .validation-summary h5 {
            margin: 0 0 8px 0;
            font-weight: 600;
            color: #991b1b;
        }
        
        .validation-summary ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .validation-summary li {
            margin-bottom: 4px;
        }
        
        /* ======================================
            CSS PROFISSIONAL PARA MODAIS
        ====================================== */
        
        /*  Modal Base Styling */
        .modal-overlay.professional {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(15, 23, 42, 0.8);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-container.professional {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            animation: modalSlideIn 0.3s ease-out;
            border: 1px solid #e2e8f0;
        }
        
        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(-20px) scale(0.98); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        /*  Modal Header */
        .modal-header.professional {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) !important;
            color: white !important;
            padding: 24px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .header-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white !important;
            background: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }
        
        .header-icon.material { 
            background: rgba(99, 102, 241, 0.2); 
            color: white !important;
        }
        .header-icon.product { 
            background: rgba(139, 92, 246, 0.2); 
            color: white !important;
        }
        
        .header-text h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            letter-spacing: -0.025em;
            color: white !important;
        }
        
        .header-subtitle {
            margin: 4px 0 0 0;
            font-size: 14px;
            opacity: 0.9;
            font-weight: 400;
            color: white !important;
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        /*  Modal Body */
        .modal-body.professional {
            padding: 0;
            max-height: calc(85vh - 120px);
            overflow-y: auto;
        }
        
        .professional-form {
            padding: 0;
        }
        
        /*  Form Sections */
        .form-section {
            border-bottom: 1px solid #f1f5f9;
            padding: 32px;
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }
        
        .section-icon.basic-info { background: linear-gradient(135deg, #10b981, #059669); }
        .section-icon.technical { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .section-icon.identification { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        
        .section-text h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .section-text p {
            margin: 4px 0 0 0;
            font-size: 14px;
            color: #64748b;
        }
        
        /*  Form Grid */
        .form-grid {
            display: grid;
            gap: 20px;
        }
        
        .form-grid.two-columns {
            grid-template-columns: 1fr 1fr;
        }
        
        .form-grid.three-columns {
            grid-template-columns: 1fr 1fr 1fr;
        }
        
        @media (max-width: 768px) {
            .form-grid.two-columns,
            .form-grid.three-columns {
                grid-template-columns: 1fr;
            }
        }
        
        /*  Form Groups */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
            letter-spacing: -0.025em;
        }
        
        .required {
            color: #ef4444;
            margin-left: 4px;
        }
        
        .form-input {
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            color: #374151;
            background: white;
            transition: all 0.2s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-textarea {
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            color: #374151;
            background: white;
            transition: all 0.2s ease;
            resize: vertical;
            min-height: 80px;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-hint {
            font-size: 12px;
            color: #6b7280;
            font-style: italic;
        }
        
        .form-grid.full-width {
            grid-template-columns: 1fr;
        }
        
        /* Section Icons - Updated Colors */
        .section-icon.basic { background: linear-gradient(135deg, #10b981, #059669); }
        .section-icon.technical { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .section-icon.stock { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .section-icon.pricing { background: linear-gradient(135deg, #10b981, #059669); }
        .section-icon.status { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .section-icon.additional { background: linear-gradient(135deg, #64748b, #475569); }
        
        /* Modal Footer */
        .modal-footer.professional {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            padding: 24px 32px;
        }
        
        .footer-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .btn-modern {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid transparent;
        }
        
        .btn-modern.primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
        }
        
        .btn-modern.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(99, 102, 241, 0.35);
        }
        
        .btn-modern.secondary {
            background: white;
            color: #6b7280;
            border-color: #d1d5db;
        }
        
        .btn-modern.secondary:hover {
            background: #f9fafb;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }
        
        .btn-modern:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-modern .fa-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .form-input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: #ffffff;
            color: #1e293b;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: #ffffff;
        }
        
        .form-input:invalid {
            border-color: #ef4444;
        }
        
        .form-hint {
            font-size: 12px;
            color: #64748b;
            line-height: 1.4;
        }
        
        /*  Modal Footer */
        .modal-footer.professional {
            padding: 24px 32px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .btn.professional {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn.professional.secondary {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .btn.professional.secondary:hover {
            background: #e2e8f0;
            color: #475569;
            transform: translateY(-1px);
        }
        
        .btn.professional.primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.25);
        }
        
        .btn.professional.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(99, 102, 241, 0.35);
        }
        
        /* ======================================
            MODO ESCURO - CORREES
        ====================================== */
        
        body.dark-mode .modal-container.professional {
            background: #1e293b;
            border-color: #334155;
        }
        
        body.dark-mode .form-section {
            border-color: #334155;
        }
        
        body.dark-mode .section-text h3 {
            color: #f1f5f9;
        }
        
        body.dark-mode .section-text p {
            color: #94a3b8;
        }
        
        body.dark-mode .form-group label {
            color: #e2e8f0;
        }
        
        body.dark-mode .form-input {
            background: #334155;
            border-color: #475569;
            color: #f1f5f9;
        }
        
        body.dark-mode .form-input:focus {
            background: #334155;
            border-color: #6366f1;
        }
        
        body.dark-mode .form-hint {
            color: #94a3b8;
        }
        
        /* Modo escuro para modais profissionais */
        body.dark-mode .modal-footer.professional {
            background: #1e293b;
            border-color: #334155;
        }
        
        body.dark-mode .btn-modern.secondary {
            background: #334155;
            color: #e2e8f0;
            border-color: #475569;
        }
        
        body.dark-mode .btn-modern.secondary:hover {
            background: #475569;
            border-color: #64748b;
        }
        
        body.dark-mode .form-textarea {
            background: #334155;
            border-color: #475569;
            color: #f1f5f9;
        }
        
        body.dark-mode .form-textarea:focus {
            background: #334155;
            border-color: #6366f1;
        }
        
        /* Garantir que headers dos modais sempre tenham o visual correto */
        body.dark-mode .modal-header.professional {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) !important;
            color: white !important;
        }
        
        body.dark-mode .header-text h2 {
            color: white !important;
        }
        
        body.dark-mode .header-subtitle {
            color: white !important;
        }
        
        body.dark-mode .header-icon {
            color: white !important;
        }
        
        /* ======================================
            MODO ESCURO - CORREES GESTO DE MATERIAIS
        ====================================== */
        
        /* Correes para tabelas e listas no modo escuro */
        body.dark-mode .table-container {
            background: #1e293b;
            border-color: #334155;
        }
        
        body.dark-mode .table-container table {
            background: #1e293b;
            color: #f1f5f9;
        }
        
        body.dark-mode .table-container th {
            background: #334155;
            color: #f1f5f9;
            border-color: #475569;
        }
        
        body.dark-mode .table-container td {
            background: #1e293b;
            color: #e2e8f0;
            border-color: #334155;
        }
        
        body.dark-mode .table-container tbody tr:hover {
            background: #334155 !important;
        }
        
        /* Grid de produtos no modo escuro */
        body.dark-mode .products-grid .product-card {
            background: #1e293b;
            border-color: #334155;
            color: #f1f5f9;
        }
        
        body.dark-mode .product-card h3 {
            color: #f1f5f9;
        }
        
        body.dark-mode .product-card p {
            color: #94a3b8;
        }
        
        body.dark-mode .product-actions .btn {
            background: #334155;
            color: #f1f5f9;
            border-color: #475569;
        }
        
        body.dark-mode .product-actions .btn:hover {
            background: #475569;
        }
        
        /* Badges e status no modo escuro */
        body.dark-mode .badge {
            background: #334155;
            color: #f1f5f9;
        }
        
        body.dark-mode .status-badge.active {
            background: #065f46;
            color: #d1fae5;
        }
        
        body.dark-mode .status-badge.inactive {
            background: #7f1d1d;
            color: #fecaca;
        }
        
        /* Botes de ao no modo escuro */
        body.dark-mode .btn-editar-prod {
            background: linear-gradient(135deg, #1e40af, #1d4ed8) !important;
        }
        
        body.dark-mode .btn-excluir-prod {
            background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
        }
        
        /* Campos de busca no modo escuro */
        body.dark-mode .search-input {
            background: #334155;
            color: #f1f5f9;
            border-color: #475569;
        }
        
        body.dark-mode .search-input::placeholder {
            color: #94a3b8;
        }
        
        /* Cards e painis no modo escuro */
        body.dark-mode .panel {
            background: #1e293b;
            border-color: #334155;
        }
        
        body.dark-mode .panel h2,
        body.dark-mode .panel h3 {
            color: #f1f5f9;
        }
        
        body.dark-mode .panel-body {
            color: #e2e8f0;
        }
        
        /* Lista de materiais vazia no modo escuro */
        body.dark-mode .empty-state {
            background: #1e293b;
            color: #94a3b8;
            border-color: #334155;
        }
        
        body.dark-mode .empty-state h3 {
            color: #f1f5f9;
        }
        
        /* Dropdown de resultados de busca no modo escuro */
        body.dark-mode .search-inline-dropdown {
            background: #1e293b;
            border-color: #334155;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        
        body.dark-mode .search-result-item {
            color: #e2e8f0;
            border-color: #334155;
        }
        
        body.dark-mode .search-result-item:hover {
            background: #334155;
        }
        
        /* Botes de visualizao (grid/lista) no modo escuro */
        body.dark-mode .view-toggle-btn {
            background: #334155;
            color: #94a3b8;
            border-color: #475569;
        }
        
        body.dark-mode .view-toggle-btn.active {
            background: #6366f1;
            color: white;
        }
        
        body.dark-mode .view-toggle-btn:hover {
            background: #475569;
            color: #f1f5f9;
        }
        
        /* ======================================
            BOTES DE VISUALIZAO (GRID/LISTA)
        ====================================== */
        
        .view-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .view-toggle-btn {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #64748b;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        .view-toggle-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        
        .view-toggle-btn:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }
        
        /* Visualizao em grid */
        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .material-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
        }
        
        .material-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .material-card h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .material-card p {
            margin: 4px 0;
            color: #64748b;
            font-size: 14px;
        }
        
        .material-actions {
            margin-top: 16px;
            display: flex;
            gap: 8px;
        }
        
        /* Visualizao em lista */
        .materials-list {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
        }
        
        .materials-list table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .materials-list th {
            background: #f8fafc;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .materials-list td {
            padding: 12px 16px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .materials-list tbody tr:hover {
            background: #f8fafc;
        }
        
        /* ======================================
            RESPONSIVIDADE MODAL
        ====================================== */
        
        @media (max-width: 768px) {
            .modal-container.professional {
                width: 95%;
                margin: 10px;
            }
            
            .modal-header.professional {
                padding: 20px 24px;
            }
            
            .header-text h2 {
                font-size: 20px;
            }
            
            .form-section {
                padding: 24px 20px;
            }
            
            .modal-footer.professional {
                padding: 20px 24px;
            }
        }
        
        /* Animaes para modal Nova Ordem */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Melhorias de input com validao visual */
        #form-nova-ordem input:valid,
        #form-nova-ordem select:valid,
        #form-nova-ordem textarea:valid {
            border-color: #10b981 !important;
        }
        
        #form-nova-ordem input:invalid:not(:placeholder-shown),
        #form-nova-ordem select:invalid:not(:placeholder-shown),
        #form-nova-ordem textarea:invalid:not(:placeholder-shown) {
            border-color: #ef4444 !important;
        }
        
        /* Animao de hover nos botes */
        .btn-primary:hover, .btn-secondary:hover {
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        /* ======================================
            MODAL MODERNO - EDITAR PRODUTO
        ====================================== */
        
        .modal-dialog-modern {
            max-width: 600px;
            margin: 1.75rem auto;
        }
        
        .modal-header-modern {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-bottom: 2px solid #0066cc;
            padding: 1.25rem 1.5rem;
        }
        
        .modal-header-modern h5 {
            color: #1e293b;
            font-weight: 600;
            font-size: 1.25rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .modal-header-modern i {
            color: #0066cc;
        }
        
        .modal-body-modern {
            padding: 1.5rem;
            max-height: 65vh;
            overflow-y: auto;
        }
        
        /* Scrollbar personalizada */
        .modal-body-modern::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-body-modern::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        .modal-body-modern::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        .modal-body-modern::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .form-modern {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-group-modern {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .label-modern {
            font-weight: 500;
            color: #334155;
            font-size: 0.875rem;
        }
        
        .input-modern {
            padding: 0.625rem 0.875rem;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 0.9375rem;
            transition: all 0.2s;
            background: white;
        }
        
        .input-modern:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }
        
        .input-modern:disabled,
        .input-reaçãonly {
            background: #f8fafc;
            color: #64748b;
            cursor: not-allowed;
        }
        
        .divider-modern {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
            margin: 0.5rem 0;
        }
        
        .section-title-modern {
            font-weight: 600;
            color: #475569;
            font-size: 0.9375rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .section-title-modern i {
            color: #0066cc;
        }
        
        .help-text-modern {
            color: #64748b;
            font-size: 0.8125rem;
            margin-top: 0.25rem;
        }
        
        .modal-footer-modern {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            padding: 1rem 1.5rem;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        
        .btn-secondary-modern {
            background: white;
            color: #64748b;
            border: 1px solid #cbd5e1;
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-secondary-modern:hover {
            background: #f8fafc;
            border-color: #94a3b8;
        }
        
        .btn-primary-modern {
            background: linear-gradient(135deg, #0066cc, #0052a3);
            color: white;
            border: none;
            padding: 0.625rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary-modern:hover {
            background: linear-gradient(135deg, #0052a3, #004080);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }
        
        /* ======================================
            ALERTAS DE ESTOQUE
        ====================================== */
        
        .alertas-estoque-panel {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .alertas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .alertas-header h2 {
            font-size: 1.25rem;
            color: #1e293b;
            font-weight: 600;
            margin: 0;
        }
        
        .alertas-contaçãor {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .alertas-contaçãor #alertas-numero {
            font-size: 1.125rem;
        }
        
        .alertas-content {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        
        .alertas-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .alertas-content::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .alertas-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .alerta-item {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 6px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .alerta-item:hover {
            background: #fee2e2;
            transform: translateX(4px);
        }
        
        .alerta-item.critico {
            background: #fef2f2;
            border-left-color: #dc2626;
        }
        
        .alerta-item.baixo {
            background: #fef9c3;
            border-left-color: #f59e0b;
        }
        
        .alerta-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .alerta-codigo {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.9375rem;
        }
        
        .alerta-badge {
            background: #ef4444;
            color: white;
            padding: 0.25rem 0.625rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .alerta-badge.baixo {
            background: #f59e0b;
        }
        
        .alerta-nome {
            color: #475569;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .alerta-quantidades {
            display: flex;
            gap: 1rem;
            font-size: 0.8125rem;
        }
        
        .alerta-quantidade {
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }
        
        .alerta-quantidade i {
            color: #64748b;
        }
        
        .alerta-quantidade .valor {
            font-weight: 600;
            color: #1e293b;
        }
        
        .alerta-quantidade .valor.critico {
            color: #dc2626;
        }
        
        .alerta-quantidade .valor.baixo {
            color: #f59e0b;
        }
        
        .alertas-empty {
            text-align: center;
            padding: 2rem 1rem;
            color: #64748b;
        }
        
        .alertas-empty i {
            font-size: 3rem;
            color: #cbd5e1;
            margin-bottom: 1rem;
        }
        
        .alertas-empty p {
            margin: 0;
            font-size: 0.9375rem;
        }
        
        .alertas-footer {
            display: flex;
            gap: 0.75rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }
        
        .alertas-footer .btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .alertas-footer .btn-secondary {
            background: white;
            color: #475569;
            border: 1px solid #cbd5e1;
        }
        
        .alertas-footer .btn-secondary:hover {
            background: #f8fafc;
            border-color: #94a3b8;
        }
        
        .alertas-footer .btn-primary {
            background: linear-gradient(135deg, #0066cc, #0052a3);
            color: white;
            border: none;
        }
        
        .alertas-footer .btn-primary:hover {
            background: linear-gradient(135deg, #0052a3, #004080);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }

        /* ===== CATLOGO DE PRODUTOS - ESTILOS ===== */
        #catalogo-produtos-view {
            padding: 32px;
            background: #f8fafc;
            min-height: 100vh;
        }

        .catalogo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .catalogo-title-area {
            flex: 1;
        }

        .catalogo-main-title {
            font-size: 32px;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .catalogo-main-title i {
            color: #6366f1;
        }

        .catalogo-subtitle {
            font-size: 16px;
            color: #64748b;
            margin: 0;
        }

        .catalogo-actions {
            display: flex;
            gap: 12px;
        }

        .btn-catalogo {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-catalogo.primary {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-catalogo.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-catalogo:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .catalogo-filters-container {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 32px;
        }

        .search-box-catalogo {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box-catalogo i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 18px;
        }

        .search-box-catalogo input {
            width: 100%;
            padding: 14px 16px 14px 48px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s;
        }

        .search-box-catalogo input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .filter-select {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-select:focus {
            outline: none;
            border-color: #6366f1;
        }

        .btn-filter-reset {
            padding: 12px 24px;
            background: #f1f5f9;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-filter-reset:hover {
            background: #e2e8f0;
        }

        .catalogo-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card-catalogo {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
        }

        .stat-card-catalogo:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .stat-card-catalogo .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            flex-shrink: 0;
        }

        .stat-card-catalogo .stat-info h3 {
            font-size: 14px;
            color: #64748b;
            margin: 0 0 8px 0;
            font-weight: 600;
        }

        .stat-card-catalogo .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
        }

        .catalogo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .produto-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .produto-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        }

        .produto-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .produto-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .produto-image-placeholder {
            font-size: 64px;
            color: #cbd5e1;
        }

        .produto-badge-estoque {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-disponivel {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-baixo {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-zeração {
            background: #fee2e2;
            color: #991b1b;
        }

        .produto-content {
            padding: 20px;
        }

        .produto-header {
            margin-bottom: 16px;
        }

        .produto-nome {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 8px 0;
            line-height: 1.4;
        }

        .produto-categoria {
            display: inline-block;
            padding: 4px 12px;
            background: #f1f5f9;
            color: #64748b;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .produto-codes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .code-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .code-label {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .code-value {
            font-size: 13px;
            font-weight: 600;
            color: #475569;
            font-family: 'Courier New', monospace;
        }

        .produto-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #e2e8f0;
        }

        .produto-estoque {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .estoque-label {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .estoque-value {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
        }

        .produto-actions {
            display: flex;
            gap: 8px;
        }

        .btn-produto-action {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 16px;
        }

        .btn-view {
            background: #f1f5f9;
            color: #475569;
        }

        .btn-view:hover {
            background: #6366f1;
            color: white;
        }

        .btn-edit {
            background: #f1f5f9;
            color: #475569;
        }

        .btn-edit:hover {
            background: #10b981;
            color: white;
        }

        .loading-catalogo {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            color: #64748b;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e2e8f0;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .catalogo-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            padding: 24px 0;
        }

        .pagination-btn {
            padding: 10px 16px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        .pagination-info {
            padding: 10px 20px;
            color: #64748b;
            font-weight: 600;
        }
    </style>

    <!--  Sistema de Gerenciamento de Inatividade -->
    <script src="../_shared/inactivity-manager.js"></script></head>
<body>
    <a href="#main-content" class="skip-link">Pular para o conteúdo</a>
    
    <div class="app-container">
        <!-- Sidebar Padrão PCP -->
        <nav class="sidebar" style="width: 56px; background: #1a1a2e; display: flex; flex-direction: column; align-items: center; padding: 12px 0; z-index: 100; position: fixed; left: 0; top: 0; height: 100vh;">
            <a href="/dashboard" class="sidebar-logo" title="Painel Principal" style="width: 36px; height: 36px; background: linear-gradient(135deg, #dc2626, #b91c1c); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; cursor: pointer; text-decoration: none;">
                <i class="fas fa-home" style="color: white; font-size: 18px;"></i>
            </a>
            
            <div class="sidebar-nav" style="display: flex; flex-direction: column; gap: 4px; flex: 1;">
                <a href="index.html" class="sidebar-btn active" title="Dashboard" style="width: 40px; height: 40px; border: none; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; text-decoration: none;">
                    <i class="fas fa-tachometer-alt"></i>
                </a>
                <a href="index.html" class="sidebar-btn" title="Produtos e Estoque" onclick="localStorage.setItem('pcp-view','produtos')" style="width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; text-decoration: none;">
                    <i class="fas fa-boxes"></i>
                </a>
                <a href="index.html" class="sidebar-btn" title="Ordem de Compra" onclick="localStorage.setItem('pcp-view','ordem-compra')" style="width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; text-decoration: none;">
                    <i class="fas fa-shopping-cart"></i>
                </a>
                <a href="ordens-producao.html" class="sidebar-btn" title="Ordens de Produção" style="width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; text-decoration: none;">
                    <i class="fas fa-clipboard-list"></i>
                </a>
                <a href="index.html" class="sidebar-btn" title="Programação de Faturamento" onclick="localStorage.setItem('pcp-view','faturamento')" style="width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; text-decoration: none;">
                    <i class="fas fa-file-invoice-dollar"></i>
                </a>
            </div>
            
            <div class="sidebar-bottom" style="margin-top: auto; display: flex; flex-direction: column; gap: 4px;">
                <button class="sidebar-btn" title="Configurações" style="width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </nav>

        <!-- Main Area -->
        <div class="main-area" style="flex: 1; display: flex; flex-direction: column; overflow: hidden; margin-left: 56px;">
            <!-- Header Padrão PCP -->
            <header class="header" style="height: 48px; background: #1a1a2e; display: flex; align-items: center; justify-content: space-between; padding: 0 16px;">
    <link rel="icon" type="image/x-icon" href="../../public/favicon-aluforce.webp">
                <div class="header-left" style="display: flex; align-items: center; gap: 24px;">
                    <div class="header-brand" style="display: flex; align-items: center; gap: 8px; color: white;">
                        <span style="font-size: 14px; font-weight: 600; color: #8b8b9a;">PCP</span>
                        <span style="font-size: 14px; font-weight: 600; color: #8b8b9a;">|</span>
                        <span style="font-size: 14px; font-weight: 600; color: white;">Dashboard</span>
                    </div>
                </div>
                
                <div class="header-right" style="display: flex; align-items: center; gap: 8px;">
                    <button class="header-btn" title="Atualizar" onclick="location.reload()" style="width: 36px; height: 36px; border: none; background: transparent; color: #8b8b9a; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px;">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="header-btn" title="Notificações" style="width: 36px; height: 36px; border: none; background: transparent; color: #8b8b9a; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px;">
                        <i class="fas fa-bell"></i>
                    </button>
                    
                    <div class="user-greeting" style="display: flex; align-items: center; gap: 12px; margin-left: 16px; color: #8b8b9a; font-size: 13px;">
                        <span><span id="greeting-text">Bom dia</span>, <strong style="color: white;" id="user-name">Usuário</strong></span>
                    </div>
                    
                    <div class="user-avatar" id="user-avatar" style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: 600; cursor: pointer; margin-left: 8px; overflow: hidden;">
                        <img src="avatars/default.webp" alt="" id="user-photo" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                </div>
            </header>
    
    <!-- CONTEÚDO ORIGINAL MANTIDO ABAIXO -->
    <div class="container-principal" style="margin-top: 0;">
        <aside class="sidebar" style="display: none;">
            <nav id="sidebar" class="sidebar-nav" role="navigation" aria-label="Navegação principal">
                <ul>
                    <li>
                        <a href="#" id="btn-dashboard" class="nav-link active" title="Dashboard">
                            <span class="nav-icon"><i class="fas fa-tachometer-alt" aria-hidden="true"></i></span>
                            <span class="nav-tooltip">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="btn-materiais" class="nav-link" title="Gesto de Materiais">
                            <span class="nav-icon"><i class="fas fa-boxes" aria-hidden="true"></i></span>
                            <span class="nav-tooltip">Gesto de Materiais</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="btn-ordem-compra" class="nav-link" title="Gerar Ordem de Compra">
                            <span class="nav-icon"><i class="fas fa-shopping-cart" aria-hidden="true"></i></span>
                            <span class="nav-tooltip">Gerar Ordem de Compra</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="btn-controle-producao" class="nav-link" title="Controle de Produo">
                            <span class="nav-icon"><i class="fas fa-industry" aria-hidden="true"></i></span>
                            <span class="nav-tooltip">Controle de Produo</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="btn-faturamento" class="nav-link" title="Programao de Faturamento">
                            <span class="nav-icon"><i class="fas fa-file-invoice-dollar" aria-hidden="true"></i></span>
                            <span class="nav-tooltip">Programao de Faturamento</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="btn-gestao-produtos" class="nav-link" title="Gesto de Produtos">
                            <span class="nav-icon"><i class="fas fa-boxes" aria-hidden="true"></i></span>
                            <span class="nav-tooltip">Gesto de Produtos</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="btn-catalogo-produtos" class="nav-link" title="Catlogo de Produtos">
                            <span class="nav-icon"><i class="fas fa-book-open" aria-hidden="true"></i></span>
                            <span class="nav-tooltip">Catlogo de Produtos</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="btn-sair" class="nav-link" title="Voltar ao Dashboard">
                            <span class="nav-icon"><i class="fas fa-home" aria-hidden="true"></i></span>
                            <span class="nav-tooltip">Voltar ao Dashboard</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

    <!-- overlay que aparece quando o menu lateral  aberto -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <main id="main-content" class="main-content" tabindex="-1">
        <div class="app-container">
            <div id="dashboard-view">
                <div class="dashboard-grid">
                    <!-- Quick Actions Panel -->
                    <div class="panel quick-actions-panel">
                        <div class="panel-header-modern">
                            <div class="panel-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h2>Quick Actions</h2>
                        </div>
                        <div class="quick-actions">
                            <button id="pcp-new-order" type="button" class="btn-modern btn-modern-primary">
                                <span class="btn-icon">
                                    <i class="fas fa-plus-circle"></i>
                                </span>
                                <span class="btn-content">
                                    <span class="btn-label">Nova Ordem</span>
                                    <span class="btn-sublabel">Criar ordem de produo</span>
                                </span>
                            </button>
                            <button id="pcp-new-product" type="button" class="btn-modern btn-modern-success">
                                <span class="btn-icon">
                                    <i class="fas fa-box-open"></i>
                                </span>
                                <span class="btn-content">
                                    <span class="btn-label">Novo Produto</span>
                                    <span class="btn-sublabel">Cadastrar novo item</span>
                                </span>
                            </button>
                            <button id="pcp-atualizar" type="button" class="btn-modern btn-modern-secondary">
                                <span class="btn-icon">
                                    <i class="fas fa-sync-alt"></i>
                                </span>
                                <span class="btn-content">
                                    <span class="btn-label">Atualizar</span>
                                    <span class="btn-sublabel">Recarregar dados</span>
                                </span>
                            </button>
                        </div>
                        <div class="panel-footer-info">
                            <i class="fas fa-info-circle"></i>
                            <span>Aes rpidas para registrar e gerenciar dados</span>
                        </div>
                    </div>

                    <!-- KPIs Panel -->
                    <div class="panel kpis-panel">
                        <h2>Indicaçãores de Desempenho</h2>
                        <div id="pcp-kpis" class="kpis-grid">
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <span class="kpi-label">PRODUTOS</span>
                                </div>
                                <div class="kpi-value" id="stat-produtos">325</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <span class="kpi-label">MATERIAIS</span>
                                </div>
                                <div class="kpi-value" id="stat-materiais">2</div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <span class="kpi-label">ORDENS A FAZER</span>
                                </div>
                                <div class="kpi-value" id="stat-ordens">3</div>
                            </div>
                        </div>
                    </div>

                        <div class="panel pcp-monitoring-panel">
                        <div class="pcp-header">
                            <div class="pcp-header-title">
                                <h3>Ordens Recentes</h3>
                            </div>
                            <div class="pcp-actions">
                                <button class="btn-refresh" onclick="refreshRecentOrders()" title="Atualizar (F5)">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div id="pcp-recent-orders" class="pcp-monitoring-container">
                            <div class="empresas-header">
                                <h3><i class="fas fa-clock"></i> Ordens Recentes</h3>
                                <span class="empresas-subtitle">Clique em uma ordem para ver detalhes completos</span>
                            </div>
                            <div class="monitoring-content" id="monitoring-content">
                                <!-- Daçãos carregaçãos via JavaScript -->
                            </div>
                            <div class="monitoring-empty" id="monitoring-empty">
                                <i class="fas fa-inbox"></i>
                                <p>Nenhum pedido encontrado para monitoramento</p>
                            </div>
                        </div>
                    </div>

                    <div class="panel alertas-estoque-panel">
                        <div class="alertas-header">
                            <h2>Alertas de Estoque</h2>
                            <div id="alertas-contaçãor" class="alertas-contaçãor">
                                <span id="alertas-numero">0</span>
                            </div>
                        </div>
                        <div id="pcp-low-stock" class="alertas-content">
                            <!-- Itens com baixo estoque carregaçãos via JavaScript -->
                        </div>
                        <div class="alertas-footer">
                            <button id="btn-ver-todos-alertas" class="btn btn-secondary">
                                <i class="fas fa-list"></i> Ver Todos Alertas
                            </button>
                            <button id="btn-relatorios" class="btn btn-primary">
                                <i class="fas fa-chart-bar"></i> Relatrios
                            </button>
                        </div>
                    </div>
                </section>
            </div>

                        <!-- Modal: lista completa de pedidos faturados (paginada) -->
                        <div id="modal-todos-faturados-list" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-todos-faturados-list-title" aria-describedby="modal-todos-faturados-list-desc" tabindex="-1">
                            <div class="modal-dialog modal-wide" role="document">
                                <div class="modal-header"><h3 id="modal-todos-faturados-list-title">Pedidos Faturaçãos</h3><button id="close-todos-faturados-list" type="button" class="modal-close" aria-label="Fechar"></button></div>
                                <p id="modal-todos-faturados-list-desc" class="sr-only">Lista paginada de pedidos faturados com botes para abrir cada pedido. Use as teclas de pgina ou os botes de paginao para navegar.</p>
                                <div class="modal-body modal-body-scroll" id="todos-faturados-list-body"></div>
                                <div class="modal-footer text-center pad-12">
                                    <div id="todos-faturados-pagination"></div>
                                </div>
                            </div>
                        </div>

            <div id="nova-ordem-view" class="hidden">
                <!-- Hero Section -->
                <div class="page-hero gradient-primary">
                    <div class="hero-content">
                        <div class="hero-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="hero-text">
                            <h1 class="hero-title">Nova Ordem de Produo</h1>
                            <p class="hero-subtitle">Crie uma nova ordem de produo com informaes completas</p>
                        </div>
                    </div>
                </div>

                <!-- Formulrio Moderno -->
                <div class="form-modern-container">
                    <form id="form-nova-ordem" class="form-advanced">
                        <!-- Informaes do Produto -->
                        <div class="form-section">
                            <div class="section-header">
                                <i class="fas fa-box"></i>
                                <h3>Informaes do Produto</h3>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group-modern">
                                    <label for="codigo_produto" class="label-modern">
                                        <i class="fas fa-barcode"></i> Cdigo do Produto *
                                    </label>
                                    <input type="text" id="codigo_produto" class="input-modern" placeholder="Ex: PROD-001" required>
                                    <small class="help-text">Digite o cdigo nico do produto</small>
                                </div>

                                <div class="form-group-modern">
                                    <label for="quantidade" class="label-modern">
                                        <i class="fas fa-calculator"></i> Quantidade *
                                    </label>
                                    <input type="number" id="quantidade" class="input-modern" placeholder="0" min="1" required>
                                    <small class="help-text">Quantidade a ser produzida</small>
                                </div>
                            </div>

                            <div class="form-group-modern">
                                <label for="descricao_produto" class="label-modern">
                                    <i class="fas fa-align-left"></i> Descrio do Produto *
                                </label>
                                <textarea id="descricao_produto" class="input-modern" rows="4" placeholder="Descreva o produto a ser fabricação..." required></textarea>
                                <small class="help-text">Informaes detalhadas sobre o produto</small>
                            </div>
                        </div>

                        <!-- Prazos e Prioridade -->
                        <div class="form-section">
                            <div class="section-header">
                                <i class="fas fa-calendar-alt"></i>
                                <h3>Prazos e Prioridade</h3>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group-modern">
                                    <label for="data_previsao_entrega" class="label-modern">
                                        <i class="fas fa-calendar-check"></i> Previso de Entrega *
                                    </label>
                                    <input type="date" id="data_previsao_entrega" class="input-modern" required>
                                    <small class="help-text">Data estimada para concluso</small>
                                </div>

                                <div class="form-group-modern">
                                    <label for="prioridade" class="label-modern">
                                        <i class="fas fa-flag"></i> Prioridade
                                    </label>
                                    <select id="prioridade" class="input-modern">
                                        <option value="baixa"> Baixa</option>
                                        <option value="normal" selected> Normal</option>
                                        <option value="alta"> Alta</option>
                                        <option value="urgente"> Urgente</option>
                                    </select>
                                    <small class="help-text">Defina a prioridade da ordem</small>
                                </div>
                            </div>
                        </div>

                        <!-- Observaes -->
                        <div class="form-section">
                            <div class="section-header">
                                <i class="fas fa-comment-alt"></i>
                                <h3>Observaes Adicionais</h3>
                            </div>
                            
                            <div class="form-group-modern">
                                <label for="observacoes" class="label-modern">
                                    <i class="fas fa-sticky-note"></i> Observaes
                                </label>
                                <textarea id="observacoes" class="input-modern" rows="3" placeholder="Informaes adicionais, requisitos especiais, etc..."></textarea>
                                <small class="help-text">Campo opcional para anotaes importantes</small>
                            </div>
                        </div>

                        <!-- Botes de Ao -->
                        <div class="form-actions">
                            <button type="button" class="btn-modern secondary" onclick="voltarDashboard()">
                                <i class="fas fa-times"></i>
                                <span>Cancelar</span>
                            </button>
                            <button type="submit" class="btn-modern primary">
                                <i class="fas fa-check"></i>
                                <span>Criar Ordem de Produo</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div id="editar-view" class="hidden">
                <header class="main-header">
    <link rel="icon" type="image/x-icon" href="../../public/favicon-aluforce.webp"><h1>Editar Registro</h1></header>
                <div class="form-container">
                    <p class="muted">rea para editar ordens, produtos ou materiais. Aqui voc poder abrir um item e alterar seus campos. (Implementao futura)</p>
                        <div id="editar-form-placeholder" class="pad-12 estoque-card mt-6">
                        <p><strong>Exemplo:</strong> Selecione um item na lista de ordens recentes para abrir o editor.</p>
                        <button id="editar-open-sample" class="btn btn-sm btn-editar"><i class="fas fa-edit"></i> Abrir Exemplo de Edio</button>
                    </div>
                </div>
            </div>
                        <!-- Modal: lista completa de prazos (paginada) -->
                        <div id="modal-todos-prazos-list" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-todos-prazos-list-title" aria-describedby="modal-todos-prazos-list-desc" tabindex="-1">
                            <div class="modal-dialog modal-wide" role="document">
                                <div class="modal-header"><h3 id="modal-todos-prazos-list-title">Prazos de Entrega</h3><button id="close-todos-prazos-list" type="button" class="modal-close" aria-label="Fechar"></button></div>
                                <p id="modal-todos-prazos-list-desc" class="sr-only">Lista paginada dos prazos previstos de entrega para pedidos faturados. Cada linha mostra data prevista e status.</p>
                                <div class="modal-body modal-body-scroll" id="todos-prazos-list-body"></div>
                                <div class="modal-footer text-center pad-12">
                                    <div id="todos-prazos-pagination"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Modal: Editar Produto MODERNIZADO -->
                        <div id="modal-editar-produto" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-editar-produto-title" aria-describedby="modal-editar-produto-desc" tabindex="-1">
                            <div class="modal-dialog modal-extra-large modal-dialog-modern" role="document">
                                <div class="modal-header modal-header-modern">
                                    <div class="modal-title-section">
                                        <h3 id="modal-editar-produto-title">
                                            <i class="fas fa-edit" style="color: #0066cc;"></i>
                                            <span>Editar Produto</span>
                                        </h3>
                                    </div>
                                    <button id="close-editar-produto" type="button" class="modal-close modal-close-modern" aria-label="Fechar">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <p id="modal-editar-produto-desc" class="sr-only">Formulrio avanação para edio completa de informaes do produto selecionação.</p>
                                
                                <div class="modal-body modal-body-modern">
                                    <form id="form-editar-produto" class="form-modern">
                                        <!-- Campos Bsicos -->
                                        <div class="form-group-modern">
                                            <label for="edit-codigo" class="label-modern">Cdigo:</label>
                                            <input type="text" id="edit-codigo" name="codigo" reaçãonly class="input-modern input-reaçãonly">
                                        </div>
                                        
                                        <div class="form-group-modern">
                                            <label for="edit-nome" class="label-modern">Nome:</label>
                                            <input type="text" id="edit-nome" name="nome" required maxlength="255" class="input-modern">
                                        </div>
                                        
                                        <div class="form-group-modern">
                                            <label for="edit-variacao" class="label-modern">
                                                <i class="fas fa-palette"></i> Variao (Cores/Especificaes):
                                            </label>
                                            <input type="text" id="edit-variacao" name="variacao" maxlength="255" class="input-modern" placeholder="Ex: Preto / Nu">
                                            <small class="help-text-modern">Especificaes de cores ou variantes do produto</small>
                                        </div>
                                        
                                        <div class="form-group-modern">
                                            <label for="edit-descricao" class="label-modern">Descrio:</label>
                                            <textarea id="edit-descricao" name="descricao" rows="3" maxlength="1000" class="input-modern"></textarea>
                                        </div>
                                        
                                        <div class="form-group-modern">
                                            <label for="edit-sku" class="label-modern">SKU:</label>
                                            <input type="text" id="edit-sku" name="sku" reaçãonly class="input-modern input-reaçãonly">
                                        </div>
                                        
                                        <div class="form-group-modern">
                                            <label for="edit-gtin" class="label-modern">GTIN:</label>
                                            <input type="text" id="edit-gtin" name="gtin" maxlength="13" class="input-modern">
                                        </div>
                                        
                                        <div class="divider-modern"></div>
                                        
                                        <!-- Seo de Estoque -->
                                        <div class="section-title-modern">
                                            <i class="fas fa-warehouse"></i> Quantidade em Estoque:
                                        </div>
                                        
                                        <div class="form-group-modern">
                                            <label for="edit-quantidade" class="label-modern">Quantidade Atual:</label>
                                            <input type="number" id="edit-quantidade" name="quantidade" step="0.01" min="0" class="input-modern" placeholder="0">
                                        </div>
                                        
                                        <div class="divider-modern"></div>
                                        
                                        <div class="section-title-modern">
                                            <i class="fas fa-exclamation-triangle"></i> Estoque Mnimo:
                                        </div>
                                        
                                        <div class="form-group-modern">
                                            <label for="edit-estoque-minimo" class="label-modern">Estoque Mnimo:</label>
                                            <input type="number" id="edit-estoque-minimo" name="estoque_minimo" step="0.01" min="0" class="input-modern" placeholder="0">
                                            <small class="help-text-modern">Alerta quando estoque ficar abaixo deste valor</small>
                                        </div>
                                            </div>
                                        </div>
                                        
                                        <input type="hidden" id="edit-produto-id" name="id">
                                    </form>
                        </div>

            <div id="materiais-view" class="hidden">
                                <!-- HERO SECTION -->
                <div class="materials-hero">
                    <div class="hero-content">
                        <div class="hero-text">
                            <h1 class="hero-title">
                                <i class="fas fa-warehouse"></i>
                                Gesto de Materiais
                            </h1>
                            <p class="hero-subtitle">Controle completo do inventrio de materiais e produtos</p>
                        </div>
                        <div class="hero-actions">
                            <button class="btn-hero primary" onclick="window.abrirModalNovoMaterial()">
                                <i class="fas fa-plus-circle"></i>
                                <span>Novo Material</span>
                            </button>
                            <button class="btn-hero secondary" onclick="window.exportarMateriais()">
                                <i class="fas fa-file-export"></i>
                                <span>Exportar PDF</span>
                            </button>
                            <button class="btn-hero outline" onclick="window.carregarMateriais()">
                                <i class="fas fa-sync-alt"></i>
                                <span>Atualizar</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CARDS DE ESTATSTICAS -->
                <section class="stats-section">
                    <div class="stats-grid">
                        <div class="stat-card blue">
                            <div class="stat-icon">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="stat-materiais">0</div>
                                <div class="stat-label">Materiais Ativos</div>
                                <div class="stat-trend positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+5.2% este ms</span>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card orange">
                            <div class="stat-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="stat-alertas">0</div>
                                <div class="stat-label">Alertas de Estoque</div>
                                <div class="stat-trend negative">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>Requer ateno</span>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card purple">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="stat-movimentacoes">0</div>
                                <div class="stat-label">Movimentaes Hoje</div>
                                <div class="stat-trend neutral">
                                    <i class="fas fa-equals"></i>
                                    <span>Operaes normais</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- AES RPIDAS E FILTROS -->
                <section class="actions-section">
                    <div class="quick-actions-panel">
                        <div class="panel-title">
                            <i class="fas fa-bolt"></i>
                            <span>Aes Rpidas</span>
                        </div>
                        <div class="quick-actions-grid">
                            <button class="quick-action-btn" onclick="window.carregarMateriais()">
                                <i class="fas fa-sync-alt"></i>
                                <span>Recarregar</span>
                            </button>
                            <button class="quick-action-btn" onclick="window.gerarCatalogoProdutos()">
                                <i class="fas fa-file-pdf"></i>
                                <span>Catlogo</span>
                            </button>
                            <button class="quick-action-btn" onclick="window.exportarDaçãos()">
                                <i class="fas fa-download"></i>
                                <span>Exportar</span>
                            </button>
                            <button class="quick-action-btn" onclick="window.testMateriais()">
                                <i class="fas fa-flask"></i>
                                <span>Testar API</span>
                            </button>
                        </div>
                    </div>

                    <div class="filters-panel">
                        <div class="panel-title">
                            <i class="fas fa-filter"></i>
                            <span>Filtros</span>
                        </div>
                        <div class="filters-grid">
                            <select class="filter-select" id="filter-categoria" aria-label="Filtrar por categoria">
                                <option value="">Todas Categorias</option>
                                <option value="eletricos">Eltricos</option>
                                <option value="mecanicos">Mecnicos</option>
                                <option value="hidraulicos">Hidrulicos</option>
                            </select>
                            <select class="filter-select" id="filter-estoque" aria-label="Filtrar por estoque">
                                <option value="">Todos os Estoques</option>
                                <option value="disponivel">Disponvel</option>
                                <option value="baixo">Estoque Baixo</option>
                                <option value="zeração">Zeração</option>
                            </select>
                            <button class="btn-filter-apply">
                                <i class="fas fa-check"></i>
                                Aplicar Filtros
                            </button>
                        </div>
                    </div>
                </section>

                <!-- TABELA DE MATERIAIS -->
                <section class="materials-table-section">
                    <div id="tabela-materiais-container"></div>
                    <div class="table-panel">
                        <div class="table-header">
                            <div class="table-header-left">
                                <h2 class="table-title">
                                    <i class="fas fa-list"></i>
                                    Lista de Materiais
                                </h2>
                                <div class="table-counter">
                                    <span id="materials-count-display">0</span> materiais encontrados
                                </div>
                            </div>
                            <div class="table-header-right">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="search-materiais" placeholder="Buscar por cdigo ou descrio..." />
                                </div>
                                <div class="view-toggle">
                                    <button class="view-btn active" data-view="table" title="Visualizar em Tabela">
                                        <i class="fas fa-table"></i>
                                    </button>
                                    <button class="view-btn" data-view="grid" title="Visualizar em Grade">
                                        <i class="fas fa-th"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="table-content">
                            <div id="materials-table-view" class="table-view active">
                                <table class="data-table" id="materiais-table">
                                    <thead>
                                        <tr>
                                            <th width="80">
                                                <input type="checkbox" id="select-all-materials" aria-label="Selecionar todos os materiais" />
                                            </th>
                                            <th width="120">Cdigo</th>
                                            <th>Descrio</th>
                                            <th width="120">Unidade</th>
                                            <th width="120">Estoque</th>
                                            <th width="180">Fornecedor</th>
                                            <th width="180" class="text-center">Aes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="materiais-tbody">
                                        <!-- Linhas de materiais sero preenchidas dinamicamente pelo JS. -->
                                    </tbody>
                                </table>
                            </div>

                            <div id="materials-grid-view" class="grid-view">
                                <div class="materials-grid-container" id="materiais-grid">
                                    <!-- Grid ser preenchido dinamicamente -->
                                </div>
                            </div>
                        </div>

                        <div class="table-footer">
                            <div class="pagination">
                                <button class="page-btn" id="btn-first-page" title="Primeira pgina">
                                    <i class="fas fa-angle-double-left"></i>
                                </button>
                                <button class="page-btn" id="btn-prev-page" title="Pgina anterior">
                                    <i class="fas fa-angle-left"></i>
                                </button>
                                <div class="page-info">
                                    Pgina <span id="current-page">1</span> de <span id="total-pages">1</span>
                                </div>
                                <button class="page-btn" id="btn-next-page" title="Prxima pgina">
                                    <i class="fas fa-angle-right"></i>
                                </button>
                                <button class="page-btn" id="btn-last-page" title="ltima pgina">
                                    <i class="fas fa-angle-double-right"></i>
                                </button>
                            </div>
                            <div class="items-per-page">
                                <label>Itens por pgina:</label>
                                <select id="items-per-page" aria-label="Itens por pgina">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SEO DE PRODUTOS REMOVIDA DA GESTO DE MATERIAIS -->
            </div>

            <div id="ordem-compra-view" class="hidden">
                <!-- Hero Section -->
                <div class="page-hero gradient-success">
                    <div class="hero-content">
                        <div class="hero-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="hero-text">
                            <h1 class="hero-title">Ordens de Compra</h1>
                            <p class="hero-subtitle">Gerencie compras de materiais e acompanhe fornecedores em tempo real</p>
                        </div>
                        <div class="hero-actions">
                            <button class="btn-hero primary" id="btn-nova-ordem-compra">
                                <i class="fas fa-plus"></i> Nova Ordem de Compra
                            </button>
                            <button class="btn-hero secondary" onclick="exportarOrdensCompra()">
                                <i class="fas fa-file-export"></i> Exportar Excel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cards de Estatsticas Modernos -->
                <div class="stats-grid-modern">
                    <div class="stat-card-modern blue-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-compras-pendentes">0</div>
                            <div class="stat-label-modern">Compras Pendentes</div>
                            <div class="stat-trend-modern warning">
                                <i class="fas fa-clock"></i> <span>Aguardando aprovao</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern green-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-compras-transito">0</div>
                            <div class="stat-label-modern">Em Trnsito</div>
                            <div class="stat-trend-modern info">
                                <i class="fas fa-shipping-fast"></i> <span>Entrega prevista</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern orange-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-compras-atrasadas">0</div>
                            <div class="stat-label-modern">Atrasadas</div>
                            <div class="stat-trend-modern danger">
                                <i class="fas fa-exclamation-circle"></i> <span>Requer ateno</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern purple-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-valor-mes">R$ 0,00</div>
                            <div class="stat-label-modern">Total do Ms</div>
                            <div class="stat-trend-modern success">
                                <i class="fas fa-chart-line"></i> <span>Investimento</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtros e Busca -->
                <div class="filter-bar-modern">
                    <div class="filter-buttons">
                        <button class="filter-chip active" data-status="all">
                            <i class="fas fa-list"></i> Todas
                        </button>
                        <button class="filter-chip" data-status="pendente">
                            <i class="fas fa-clock"></i> Pendentes
                        </button>
                        <button class="filter-chip" data-status="aprovação">
                            <i class="fas fa-check"></i> Aprovadas
                        </button>
                        <button class="filter-chip" data-status="recebido">
                            <i class="fas fa-box"></i> Recebidas
                        </button>
                        <button class="filter-chip" data-status="cancelação">
                            <i class="fas fa-times"></i> Canceladas
                        </button>
                    </div>
                    <div class="search-box-modern">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-ordens-compra" placeholder="Buscar por fornecedor, material ou nmero da ordem...">
                    </div>
                </div>

                <!-- Lista de Ordens em Cards -->
                <div class="orders-container" id="lista-ordens-compra">
                    <div class="loading-state">
                        <div class="spinner-modern"></div>
                        <p>Carregando ordens de compra...</p>
                    </div>
                </div>

                <!-- Paginao -->
                <div class="pagination-modern" id="pagination-ordens-compra">
                    <!-- Geração dinamicamente -->
                </div>
            </div>

            <!-- ============================================ -->
            <!-- NOVA VIEW: CONTROLE DE PRODUO             -->
            <!-- ============================================ -->
            <div id="controle-producao-view" class="hidden">
                <!-- Hero Section -->
                <div class="page-hero gradient-info">
                    <div class="hero-content">
                        <div class="hero-icon">
                            <i class="fas fa-industry"></i>
                        </div>
                        <div class="hero-text">
                            <h1 class="hero-title">Controle de Produo</h1>
                            <p class="hero-subtitle">Monitore o status de produo em tempo real e gerencie suas ordens</p>
                        </div>
                        <div class="hero-actions">
                            <button class="btn-hero primary" id="btn-nova-ordem-producao">
                                <i class="fas fa-plus"></i> Nova Ordem
                            </button>
                            <button class="btn-hero secondary" onclick="atualizarDashboardProducao()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cards de KPIs -->
                <div class="stats-grid-modern">
                    <div class="stat-card-modern blue-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-ordens-ativas">0</div>
                            <div class="stat-label-modern">Ordens Ativas</div>
                            <div class="stat-trend-modern success">
                                <i class="fas fa-arrow-up"></i> <span>+12% este ms</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern green-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-producao-andamento">0</div>
                            <div class="stat-label-modern">Em Produo</div>
                            <div class="stat-trend-modern info">
                                <i class="fas fa-clock"></i> <span>Prazo mdio: 5 dias</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern orange-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-ordens-pendentes">0</div>
                            <div class="stat-label-modern">Aguardando</div>
                            <div class="stat-trend-modern warning">
                                <i class="fas fa-exclamation-triangle"></i> <span>Requer incio</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern purple-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-producao-concluida">0</div>
                            <div class="stat-label-modern">Concludas Hoje</div>
                            <div class="stat-trend-modern success">
                                <i class="fas fa-check"></i> <span>Meta: 85%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtros e Timeline -->
                <div class="filter-bar-modern">
                    <div class="filter-buttons">
                        <button class="filter-chip active" data-status="all">
                            <i class="fas fa-list"></i> Todas
                        </button>
                        <button class="filter-chip" data-status="pendente">
                            <i class="fas fa-clock"></i> Pendentes
                        </button>
                        <button class="filter-chip" data-status="em_producao">
                            <i class="fas fa-cogs"></i> Em Produo
                        </button>
                        <button class="filter-chip" data-status="concluido">
                            <i class="fas fa-check-circle"></i> Concludas
                        </button>
                        <button class="filter-chip" data-status="atrasada">
                            <i class="fas fa-exclamation-circle"></i> Atrasadas
                        </button>
                    </div>
                    <div class="search-box-modern">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-producao" placeholder="Buscar por cdigo, produto ou cliente...">
                    </div>
                </div>

                <!-- Timeline de Produo -->
                <div class="production-timeline-container">
                    <div class="timeline-header">
                        <h3><i class="fas fa-stream"></i> Timeline de Produo</h3>
                        <div class="timeline-legend">
                            <span class="legend-item pending"><i class="fas fa-circle"></i> Pendente</span>
                            <span class="legend-item in-progress"><i class="fas fa-circle"></i> Em Produo</span>
                            <span class="legend-item completed"><i class="fas fa-circle"></i> Concluda</span>
                            <span class="legend-item delayed"><i class="fas fa-circle"></i> Atrasada</span>
                        </div>
                    </div>
                    <div class="production-timeline" id="lista-ordens-producao">
                        <div class="loading-state">
                            <div class="spinner-modern"></div>
                            <p>Carregando ordens de produo...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================ -->
            <!-- NOVA VIEW: PROGRAMAO DE FATURAMENTO       -->
            <!-- ============================================ -->
            <div id="faturamento-view" class="hidden">
                <!-- Hero Section -->
                <div class="page-hero gradient-warning">
                    <div class="hero-content">
                        <div class="hero-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <div class="hero-text">
                            <h1 class="hero-title">Programao de Faturamento</h1>
                            <p class="hero-subtitle">Gerencie notas fiscais e agende faturamentos com eficincia</p>
                        </div>
                        <div class="hero-actions">
                            <button class="btn-hero primary" id="btn-novo-faturamento">
                                <i class="fas fa-plus"></i> Programar Faturamento
                            </button>
                            <button class="btn-hero success" id="btn-gerar-nfe">
                                <i class="fas fa-file-invoice"></i> Gerar NF-e
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cards de Estatsticas -->
                <div class="stats-grid-modern">
                    <div class="stat-card-modern blue-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-faturar-hoje">0</div>
                            <div class="stat-label-modern">Faturar Hoje</div>
                            <div class="stat-trend-modern info">
                                <i class="fas fa-dollar-sign"></i> R$ <span id="valor-faturar-hoje">0,00</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern green-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-nfe-emitidas">0</div>
                            <div class="stat-label-modern">NF-e Este Ms</div>
                            <div class="stat-trend-modern success">
                                <i class="fas fa-arrow-up"></i> <span>+15% vs ms anterior</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern orange-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-faturamento-atrasação">0</div>
                            <div class="stat-label-modern">Atrasaçãos</div>
                            <div class="stat-trend-modern warning">
                                <i class="fas fa-clock"></i> <span>Requer ateno</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern purple-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern">R$ <span id="stat-receita-mes">0,00</span></div>
                            <div class="stat-label-modern">Receita do Ms</div>
                            <div class="stat-trend-modern success">
                                <i class="fas fa-check"></i> <span>Meta: 90%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendrio e Filtros -->
                <div class="calendar-billing-container">
                    <div class="calendar-section-modern">
                        <div class="calendar-header-modern">
                            <h3><i class="fas fa-calendar-alt"></i> Calendrio de Faturamento</h3>
                            <div class="calendar-nav-modern">
                                <button class="nav-btn" id="btn-prev-month"><i class="fas fa-chevron-left"></i></button>
                                <span class="current-month" id="current-month-year">Dezembro 2025</span>
                                <button class="nav-btn" id="btn-next-month"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <div class="calendar-grid-modern" id="calendar-faturamento">
                            <!-- Geração dinamicamente -->
                        </div>
                    </div>

                    <div class="billing-list-section-modern">
                        <div class="filter-bar-modern">
                            <div class="filter-buttons">
                                <button class="filter-chip active" data-status="all">
                                    <i class="fas fa-list"></i> Todos
                                </button>
                                <button class="filter-chip" data-status="programação">
                                    <i class="fas fa-clock"></i> Programaçãos
                                </button>
                                <button class="filter-chip" data-status="emitido">
                                    <i class="fas fa-check-circle"></i> Emitidos
                                </button>
                                <button class="filter-chip" data-status="cancelação">
                                    <i class="fas fa-times-circle"></i> Cancelados
                                </button>
                            </div>
                        </div>
                        <div class="billing-list-modern" id="lista-faturamentos">
                            <div class="loading-state">
                                <div class="spinner-modern"></div>
                                <p>Carregando faturamentos...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================ -->
            <!-- NOVA VIEW: GESTO DE PRODUTOS               -->
            <!-- ============================================ -->
            <div id="gestao-produtos-view" class="hidden">
                <!-- Hero Section -->
                <div class="page-hero gradient-purple">
                    <div class="hero-content">
                        <div class="hero-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="hero-text">
                            <h1 class="hero-title">Gesto de Produtos</h1>
                            <p class="hero-subtitle">Controle completo do catlogo, estoque e variaes de produtos</p>
                        </div>
                        <div class="hero-actions">
                            <button class="btn-hero primary" onclick="window.abrirModalNovoProduto()">
                                <i class="fas fa-plus"></i> Novo Produto
                            </button>
                            <button class="btn-hero secondary" onclick="window.exportarProdutos()">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                            <button class="btn-hero outline" onclick="carregarGestaProdutos()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cards de Estatsticas -->
                <div class="stats-grid-modern">
                    <div class="stat-card-modern blue-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-total-produtos-gestao">0</div>
                            <div class="stat-label-modern">Total de Produtos</div>
                            <div class="stat-trend-modern success">
                                <i class="fas fa-arrow-up"></i> <span>Ativos no sistema</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern orange-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-estoque-baixo-gestao">0</div>
                            <div class="stat-label-modern">Estoque Baixo</div>
                            <div class="stat-trend-modern warning">
                                <i class="fas fa-arrow-down"></i> <span>Requer ateno</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern red-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-produtos-criticos-gestao">0</div>
                            <div class="stat-label-modern">Nvel Crtico</div>
                            <div class="stat-trend-modern danger">
                                <i class="fas fa-exclamation"></i> <span>Urgente</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card-modern green-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="stat-produtos-ok-gestao">0</div>
                            <div class="stat-label-modern">Estoque Normal</div>
                            <div class="stat-trend-modern info">
                                <i class="fas fa-check"></i> <span>Saudvel</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Barra de Busca e Filtros Avanada -->
                <div class="advanced-search-container">
                    <div class="search-bar-main">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-produtos-gestao" placeholder="Buscar por cdigo, nome, descrio, SKU ou GTIN..." 
                               onkeyup="buscarProdutosGestao()">
                    </div>
                    
                    <div class="filters-row">
                        <select id="filter-categoria-gestao" class="filter-select-modern" onchange="buscarProdutosGestao()">
                            <option value="">Todas as categorias</option>
                            <option value="cabo">Cabos</option>
                            <option value="fio">Fios</option>
                            <option value="acessorio">Acessrios</option>
                        </select>
                        
                        <select id="filter-estoque-gestao" class="filter-select-modern" onchange="buscarProdutosGestao()">
                            <option value="">Todos</option>
                            <option value="baixo"> Estoque Baixo</option>
                            <option value="normal"> Estoque Normal</option>
                            <option value="alto"> Estoque Alto</option>
                            <option value="critico"> Crtico</option>
                        </select>
                        
                        <button onclick="limparFiltrosGestao()" class="btn-clear-filters">
                            <i class="fas fa-redo"></i> Limpar
                        </button>
                    </div>
                    
                    <div class="shortcuts-bar">
                        <span class="shortcuts-label">Atalhos:</span>
                        <button onclick="filtrarRapidoGestao('estoque-baixo')" class="shortcut-chip">
                             Estoque Baixo
                        </button>
                        <button onclick="filtrarRapidoGestao('critico')" class="shortcut-chip">
                             Crtico
                        </button>
                        <button onclick="filtrarRapidoGestao('com-variacao')" class="shortcut-chip">
                             Com Variaes
                        </button>
                        <button onclick="filtrarRapidoGestao('todos')" class="shortcut-chip">
                            Todos
                        </button>
                    </div>
                </div>

                <!-- Tabela de Produtos -->
                <div class="table-container-modern">
                    <div class="table-header-actions">
                        <h3><i class="fas fa-list"></i> Catlogo de Produtos</h3>
                        <div class="view-toggle-modern">
                            <button class="view-btn-modern active" data-view="table"><i class="fas fa-table"></i> Tabela</button>
                            <button class="view-btn-modern" data-view="cards"><i class="fas fa-th-large"></i> Cards</button>
                            <button class="view-btn-modern" data-view="compact"><i class="fas fa-list"></i> Compacto</button>
                        </div>
                    </div>
                    <div class="table-responsive-modern">
                        <div id="tabela-produtos-gestao-container">
                            <div class="loading-state">
                                <div class="spinner-modern"></div>
                                <p>Carregando produtos...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================ -->
                            <!-- ============================================ -->            <!-- MODAL: VISUALIZAR ORDEM                      -->
            <!-- ============================================ -->
            <div id="modal-visualizar-ordem" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-header">
                        <h3><i class="fas fa-eye"></i> Detalhes da Ordem</h3>
                        <button type="button" class="modal-close" onclick="fecharModalVisualizarOrdem()" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body" id="visualizar-ordem-content">
                        <!-- Contedo preenchido dinamicamente -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModalVisualizarOrdem()">Fechar</button>
                    </div>
                </div>
            </div>

            <!-- ============================================ -->
            <!-- MODAL: ATUALIZAR PROGRESSO                   -->
            <!-- ============================================ -->
            <div id="modal-atualizar-progresso" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-header">
                        <h3><i class="fas fa-tasks"></i> Atualizar Progresso</h3>
                        <button type="button" class="modal-close" onclick="fecharModalProgresso()" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-atualizar-progresso" onsubmit="salvarProgresso(event)">
                            <input type="hidden" id="progresso-ordem-id">
                            
                            <div class="form-group">
                                <label for="progresso-valor">Progresso Atual (%)</label>
                                <input type="range" id="progresso-slider" min="0" max="100" value="0" class="form-control-range" oninput="document.getElementById('progresso-valor').value = this.value">
                                <input type="number" id="progresso-valor" name="progresso" class="form-control" min="0" max="100" value="0" oninput="document.getElementById('progresso-slider').value = this.value" required>
                            </div>

                            <div class="form-group">
                                <label for="progresso-status">Atualizar Status</label>
                                <select id="progresso-status" name="status" class="form-control">
                                    <option value="pendente">Pendente</option>
                                    <option value="ativa">Ativa</option>
                                    <option value="em_producao">Em Produo</option>
                                    <option value="concluida">Concluda</option>
                                    <option value="cancelada">Cancelada</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="progresso-observacao">Observao do Progresso</label>
                                <textarea id="progresso-observacao" name="observacao" class="form-control" rows="3" placeholder="Descreva o que foi realização..."></textarea>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="fecharModalProgresso()">Cancelar</button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check"></i> Atualizar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ============================================ -->
            <!-- MODAL: EDITAR ORDEM                          -->
            <!-- ============================================ -->
            <div id="modal-editar-ordem" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-header">
                        <h3><i class="fas fa-edit"></i> Editar Ordem de Produo</h3>
                        <button type="button" class="modal-close" onclick="fecharModalEditarOrdem()" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-editar-ordem" onsubmit="salvarEdicaoOrdem(event)">
                            <input type="hidden" id="editar-ordem-id">
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="editar-ordem-codigo">Cdigo da Ordem</label>
                                    <input type="text" id="editar-ordem-codigo" name="codigo" class="form-control" reaçãonly>
                                </div>

                                <div class="form-group">
                                    <label for="editar-ordem-prioridade">Prioridade</label>
                                    <select id="editar-ordem-prioridade" name="prioridade" class="form-control">
                                        <option value="baixa"> Baixa</option>
                                        <option value="media"> Mdia</option>
                                        <option value="alta"> Alta</option>
                                        <option value="urgente"> Urgente</option>
                                    </select>
                                </div>

                                <div class="form-group full-width">
                                    <label for="editar-ordem-produto">Produto</label>
                                    <input type="text" id="editar-ordem-produto" name="produto_nome" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="editar-ordem-quantidade">Quantidade</label>
                                    <input type="number" id="editar-ordem-quantidade" name="quantidade" class="form-control" step="0.01" min="0">
                                </div>

                                <div class="form-group">
                                    <label for="editar-ordem-unidade">Unidade</label>
                                    <select id="editar-ordem-unidade" name="unidade" class="form-control">
                                        <option value="UN">UN - Unidade</option>
                                        <option value="MT">MT - Metro</option>
                                        <option value="KG">KG - Quilograma</option>
                                        <option value="PC">PC - Pea</option>
                                        <option value="CX">CX - Caixa</option>
                                        <option value="LT">LT - Litro</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="editar-ordem-data-inicio">Data de Incio</label>
                                    <input type="date" id="editar-ordem-data-inicio" name="data_inicio" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="editar-ordem-data-prevista">Data Prevista</label>
                                    <input type="date" id="editar-ordem-data-prevista" name="data_prevista" class="form-control">
                                </div>

                                <div class="form-group full-width">
                                    <label for="editar-ordem-responsavel">Responsvel</label>
                                    <input type="text" id="editar-ordem-responsavel" name="responsavel" class="form-control">
                                </div>

                                <div class="form-group full-width">
                                    <label for="editar-ordem-observacoes">Observaes</label>
                                    <textarea id="editar-ordem-observacoes" name="observacoes" class="form-control" rows="3"></textarea>
                                </div>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="fecharModalEditarOrdem()">Cancelar</button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Salvar Alteraes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Resultados da pesquisa (modal) -->
                                    <div id="search-results-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="search-results-title" aria-describedby="search-results-desc" tabindex="-1">
                                                                    <div class="modal-dialog" role="document">
                                                                                                            <div class="modal-header">
                                                                                                                    <h3 id="search-results-title">Resultados da busca</h3>
                                                                                                                    <button id="search-modal-close" type="button" class="modal-close" aria-label="Fechar"></button>
                                                                                                            </div>
                                                                                                            <p id="search-results-desc" class="sr-only">Resultados detalhaçãos da pesquisa. Use Tab para navegar entre sees: Ordens, Materiais, Produtos e Pedidos.</p>
                                                                                                            <div class="modal-body" id="search-results-body">
                                                <!-- resultados dinmicos -->
                                            </div>
                                        </div>
                                    </div>

            <!-- ============================================ -->
            <!-- MODAL: NOVA ORDEM DE COMPRA                 -->
            <!-- ============================================ -->
            <div id="modal-nova-ordem-compra" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-header">
                      </i> Nova Ordem de Compra</h3>
                        <button type="button" class="modal-close" onclick="fecharModalNovaOrdemCompra()" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form-nova-ordem-compra" onsubmit="salvarNovaOrdemCompra(event)">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="compra-numero">Nmero da OC *</label>
                                    <input type="text" id="compra-numero" name="numero" class="form-control" placeholder="Ex: OC-2025-001" required>
                                </div>

                                <div class="form-group">
                                    <label for="compra-fornecedor">Fornecedor *</label>
                                    <input type="text" id="compra-fornecedor" name="fornecedor" class="form-control" placeholder="Nome do fornecedor" required>
                                </div>

                                <div class="form-group full-width">
                                    <label for="compra-material">Material *</label>
                                    <select id="compra-material" name="material_id" class="form-control" required>
                                        <option value="">-- Selecione um material --</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="compra-quantidade">Quantidade *</label>
                                    <input type="number" id="compra-quantidade" name="quantidade" class="form-control" placeholder="0.00" step="0.01" min="0" required>
                                </div>

                                <div class="form-group">
                                    <label for="compra-unidade">Unidade *</label>
                                    <select id="compra-unidade" name="unidade" class="form-control" required>
                                        <option value="UN" selected>UN - Unidade</option>
                                        <option value="MT">MT - Metro</option>
                                        <option value="KG">KG - Quilograma</option>
                                        <option value="PC">PC - Pea</option>
                                        <option value="CX">CX - Caixa</option>
                                        <option value="LT">LT - Litro</option>
                                        <option value="TON">TON - Tonelada</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="compra-valor-unitario">Valor Unitrio (R$) *</label>
                                    <input type="number" id="compra-valor-unitario" name="valor_unitario" class="form-control" placeholder="0.00" step="0.01" min="0" required>
                                </div>

                                <div class="form-group">
                                    <label for="compra-data-pedido">Data do Pedido *</label>
                                    <input type="date" id="compra-data-pedido" name="data_pedido" class="form-control" required>
                                </div>

                                <div class="form-group">
                                    <label for="compra-data-entrega">Previso de Entrega *</label>
                                    <input type="date" id="compra-data-entrega" name="data_entrega_prevista" class="form-control" required>
                                </div>

                                <div class="form-group">
                                    <label for="compra-status">Status *</label>
                                    <select id="compra-status" name="status" class="form-control" required>
                                        <option value="pendente" selected> Pendente</option>
                                        <option value="aprovação"> Aprovação</option>
                                        <option value="em_transito"> Em Trnsito</option>
                                        <option value="recebido"> Recebido</option>
                                        <option value="cancelação"> Cancelação</option>
                                    </select>
                                </div>

                                <div class="form-group full-width">
                                    <label for="compra-observacoes">Observaes</label>
                                    <textarea id="compra-observacoes" name="observacoes" class="form-control" rows="3" placeholder="Informaes adicionais sobre a compra..."></textarea>
                                </div>
                            </div>

                            <div class="form-summary">
                                <div class="summary-item">
                                    <span>Subtotal:</span>
                                    <strong id="compra-subtotal">R$ 0,00</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Impostos (est.):</span>
                                    <strong id="compra-impostos">R$ 0,00</strong>
                                </div>
                                <div class="summary-item total">
                                    <span>Total:</span>
                                    <strong id="compra-total">R$ 0,00</strong>
                                </div>
                            </div>

                            <div class="modal-actions">
                                <button type="button" class="btn-secondary" onclick="fecharModalNovaOrdemCompra()">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-save"></i> Criar Ordem de Compra
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Modal de Detalhes do Produto -->
            <div id="product-details-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="product-details-title" aria-describedby="product-details-desc" tabindex="-1">
              <div class="modal-dialog modal-lg" role="document">
                                <div class="modal-header">
                                    <h3 id="product-details-title">Detalhes do Produto</h3>
                                    <button id="product-details-close" type="button" class="modal-close" aria-label="Fechar"></button>
                                </div>
                                <p id="product-details-desc" class="sr-only">Informaes completas do produto selecionação, incluindo cdigo, descrio, estoque, variaes e histrico.</p>
                                <div class="modal-body" id="product-details-body">
                                    <div class="product-details-loading">
                                        <i class="fas fa-spinner fa-spin"></i> Carregando informaes do produto...
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" onclick="closeProductDetailsModal()">Fechar</button>
                                    <button type="button" class="btn btn-primary" onclick="editProductFromDetails()">
                                        <i class="fas fa-edit"></i> Editar Produto
                                    </button>
                                </div>
              </div>
            </div>

            <!-- Item edit modal genrico -->
            <div id="item-edit-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="item-edit-title" aria-describedby="item-edit-desc" tabindex="-1">
              <div class="modal-dialog" role="document">
                                <div class="modal-header">
                                    <h3 id="item-edit-title">Editar Item</h3>
                                    <button id="item-edit-close" type="button" class="modal-close" aria-label="Fechar"></button>
                                </div>
                                <p id="item-edit-desc" class="sr-only">Editor do item selecionação. Preencha ou revise os campos e use o boto Salvar para gravar alteraes.</p>
                                                                                <div class="modal-body" id="item-edit-body">
                                                    <!-- formulrio dinmico -->
                                                </div>
                                                <div class="modal-footer pad-12 text-right">
                                                    <button id="item-save" class="btn">Salvar</button>
                                                </div>
              </div>
            </div>

            <!-- Modal para todos os pedidos faturados (moved here by maintenance script) -->
            <div id="modal-todos-faturados" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-todos-faturados-title" aria-describedby="modal-todos-faturados-desc" tabindex="-1">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-header">
                        <h3 id="modal-todos-faturados-title">Todos os Pedidos Faturaçãos</h3>
                        <button id="close-todos-faturados" type="button" class="modal-close" aria-label="Fechar"></button>
                    </div>
                    <p id="modal-todos-faturados-desc" class="sr-only">Lista resumida dos pedidos que j foram faturados. Use Tab para navegar pelos itens e Enter para abrir detalhes.</p>
                    <div class="modal-body modal-body-scroll" id="todos-faturados-body"></div>
                </div>
            </div>

            <!-- Materiais modal: lista e editor rpido -->
            <div id="materiais-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="materiais-modal-title" aria-describedby="materiais-modal-desc" tabindex="-1">
                <div class="modal-dialog modal-wide" role="document">
                    <div class="modal-header">
                        <h3 id="materiais-modal-title">Materiais</h3>
                        <button id="materiais-modal-close" type="button" class="modal-close" aria-label="Fechar"></button>
                    </div>
                    <p id="materiais-modal-desc" class="sr-only">Lista de materiais com aes para editar e excluir. Use Tab para navegar e Enter para ativar aes.</p>
                    <div class="modal-body modal-body-scroll" id="materiais-modal-body">
                        <div id="materiais-modal-list">Carregando materiais...</div>
                    </div>
                    <div class="modal-footer pad-12 text-right">
                        <button id="materiais-new" class="btn">+ Novo Material</button>
                    </div>
                </div>
            </div>
                        <!-- Modal de Edio de Produto Profissional -->
            <div id="product-edit-modal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="product-edit-title" tabindex="-1">
                <div class="modal-dialog modal-xl" role="document">
                    <div class="modal-header">
                        <h3 id="product-edit-title">
                            <i class="fas fa-edit"></i> Editar Produto
                        </h3>
                        <button id="product-edit-close" type="button" class="modal-close" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="product-edit-form" class="product-edit-form">
                            <input type="hidden" id="edit-product-id" />
                            
                            <!-- Seo: Informaes Bsicas -->
                            <div class="form-section">
                                <div class="section-header">
                                    <h4><i class="fas fa-info-circle"></i> Informaes Bsicas</h4>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-codigo">Cdigo do Produto</label>
                                        <input type="text" id="edit-codigo" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-nome">Nome do Produto</label>
                                        <input type="text" id="edit-nome" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-sku">SKU (Stock Keeping Unit)</label>
                                        <div class="input-with-badge">
                                            <input type="text" id="edit-sku" class="form-control" placeholder="Cdigo interno nico">
                                            <span class="input-badge">AUTO</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-gtin">GTIN (Cdigo de Barras)</label>
                                        <input type="text" id="edit-gtin" class="form-control" placeholder="13 ou 14 dgitos" maxlength="14">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="edit-descricao">Descrio Detalhada</label>
                                    <textarea id="edit-descricao" class="form-control" rows="3" placeholder="Descrio completa do produto"></textarea>
                                </div>
                            </div>

                            <!-- Seo: Especificaes Tcnicas -->
                            <div class="form-section">
                                <div class="section-header">
                                    <h4><i class="fas fa-cogs"></i> Especificaes Tcnicas</h4>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-marca">Marca</label>
                                        <input type="text" id="edit-marca" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-unidade">Unidade de Medida</label>
                                        <select id="edit-unidade" class="form-control">
                                            <option value="">Selecionar</option>
                                            <option value="un">Unidade</option>
                                            <option value="kg">Quilograma</option>
                                            <option value="m">Metro</option>
                                            <option value="m">Metro Quadração</option>
                                            <option value="m">Metro Cbico</option>
                                            <option value="l">Litro</option>
                                            <option value="cx">Caixa</option>
                                            <option value="pc">Pea</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="edit-variacao">Variaes</label>
                                    <div class="tags-input-container">
                                        <input type="text" id="edit-variacao" class="form-control tags-input" placeholder="Digite uma variao e pressione Enter">
                                        <div id="edit-variacao-tags" class="tags-display"></div>
                                    </div>
                                    <small class="form-help">Ex: Cor, Tamanho, Voltagem, etc.</small>
                                </div>
                            </div>

                            <!-- Seo: Controle de Estoque -->
                            <div class="form-section">
                                <div class="section-header">
                                    <h4><i class="fas fa-warehouse"></i> Controle de Estoque</h4>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-estoque">Quantidade em Estoque</label>
                                        <input type="number" id="edit-estoque" class="form-control" step="0.01" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-custo">Custo Unitrio</label>
                                        <div class="input-with-currency">
                                            <span class="currency-symbol">R$</span>
                                            <input type="number" id="edit-custo" class="form-control" step="0.01" min="0" placeholder="0,00">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Seo: Informaes Adicionais -->
                            <div class="form-section">
                                <div class="section-header">
                                    <h4><i class="fas fa-clock"></i> Informaes do Sistema</h4>
                                </div>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Data de Cadastro</label>
                                        <span id="edit-data-criacao" class="info-value">-</span>
                                    </div>
                                    <div class="info-item">
                                        <label>ltima Atualizao</label>
                                        <span id="edit-ultima-atualizacao" class="info-value">-</span>
                                    </div>
                                    <div class="info-item">
                                        <label>ID do Produto</label>
                                        <span id="edit-produto-id-display" class="info-value">-</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Status</label>
                                        <span id="edit-status" class="info-value status-badge">Ativo</span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="product-edit-cancel" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="button" id="product-edit-duplicate" class="btn btn-info">
                            <i class="fas fa-copy"></i> Duplicar
                        </button>
                        <button type="submit" form="product-edit-form" id="product-edit-save" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Alteraes
                        </button>
                    </div>
                </div>
            </div>

            <div id="order-modal" class="modal hidden order-modal-modern" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="order-modal-title" aria-describedby="order-modal-desc" tabindex="-1">
                <div class="modal-dialog modal-dialog-modern" role="document">
                    <div class="modal-content">
                        <!-- Header -->
                        <div class="modal-header">
                            <h3 id="order-modal-title" class="modal-title">
                                Nova Ordem de Produo
                            </h3>
                            <button id="order-modal-close" type="button" class="btn-close" aria-label="Fechar">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                        </div>

                        <p id="order-modal-desc" class="sr-only">Formulrio rpido para criar uma nova ordem de produo. Preencha os campos e clique em Criar Ordem.</p>
                        
                        <div class="modal-body">
                            <form id="order-form" class="form-container order-form-grid">
                                <!-- Left: Product & Logistics -->
                                <div class="order-main">
                                    <section class="order-section">
                                        <div class="section-header">
                                            <h4>Produtos</h4>
                                        </div>
                                        <div class="order-items-wrap">
                                            <div class="order-items-actions">
                                                <button type="button" id="order-add-item">
                                                    + Adicionar Item
                                                </button>
                                            </div>
                                        <div style="overflow-x: auto;">
                                            <table class="order-items-table">
                                                <thead>
                                                    <tr>
                                                        <th>Cdigo</th>
                                                        <th>Produto</th>
                                                        <th>Qtde</th>
                                                        <th>Valor Unit.</th>
                                                        <th>Valor Total</th>
                                                        <th style="text-align: center;"></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="order-items-tbody"></tbody>
                                                <tfoot>
                                                    <tr>
                                                        <td colspan="3"></td>
                                                        <td style="padding: 14px; font-weight: 700; color: #1f2937;">Total</td>
                                                        <td style="padding: 14px;"><input class="modern-input" id="order-valor_total" reaçãonly placeholder="0.00" style="border: 2px solid #0ea5e9; background: #f0f9ff; font-weight: 700; color: #0284c7; font-size: 16px;" /></td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="form-row mt-3">
                                        <div class="form-group"><label for="order-data_previsao_entrega">Previso de Entrega <span class="required">*</span></label><input class="modern-input" type="date" id="order-data_previsao_entrega" required></div>
                                    </div>
                                    <div class="form-group"><label for="order-observacoes">Observaes</label><input class="modern-input" type="text" id="order-observacoes" placeholder="Observaes (opcional)"></div>
                                    <div id="order-product-preview" class="pad-8 muted text-sm order-product-preview" aria-live="polite"></div>
                                </section>

                                <section class="order-section">
                                    <div class="section-header">
                                        <h4>Configuraes</h4>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label for="order-variacao">Variao <span class="required">*</span></label><input class="modern-input" type="text" id="order-variacao" placeholder="Ex: Cor;Tamanho - separadas por vrgula" required></div>
                                        <div class="form-group"><label for="order-embalagem">Embalagem <span class="required">*</span></label>
                                            <select class="modern-input" id="order-embalagem" required>
                                                <option value="">-- Selecionar --</option>
                                                <option value="Bobina">Bobina</option>
                                                <option value="Rolo">Rolo</option>
                                                <option value="Lances">Lances</option>
                                                <option value="Caixa">Caixa</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group full-width"><label for="order-lances">Lance(s) <span class="required">*</span></label><input class="modern-input" type="text" id="order-lances" placeholder="Ex: 100,120 - valores separados por vrgula" required></div>
                                    </div>
                                </section>

                                <section class="order-section">
                                    <div class="section-header">
                                        <h4>Transporte</h4>
                                    </div>
                                    <fieldset class="transportaçãora-fieldset">
                                        <legend class="sr-only">Daçãos da Transportaçãora</legend>
                                        <div class="form-row">
                                            <div class="form-group"><label for="order-transportaçãora_nome">Nome</label><input class="modern-input" type="text" id="order-transportaçãora_nome" placeholder="Nome da transportaçãora"></div>
                                            <div class="form-group"><label for="order-transportaçãora_fone">Telefone</label><input class="modern-input" type="tel" id="order-transportaçãora_fone" placeholder="(11) 99999-9999"></div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group"><label for="order-transportaçãora_cep">CEP</label><input class="modern-input" type="text" id="order-transportaçãora_cep" placeholder="00000-000"></div>
                                            <div class="form-group"><label for="order-transportaçãora_endereco">Endereo</label><input class="modern-input" type="text" id="order-transportaçãora_endereco" placeholder="Rua, nmero, bairro"></div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group"><label for="order-transportaçãora_cpf_cnpj">CPF/CNPJ</label><input class="modern-input" type="text" id="order-transportaçãora_cpf_cnpj" placeholder="Documento"></div>
                                            <div class="form-group"><label for="order-transportaçãora_email_nfe">E-mail NFe</label><input class="modern-input" type="email" id="order-transportaçãora_email_nfe" placeholder="nf-e@transportaçãora.com"></div>
                                        </div>
                                    </fieldset>
                                </section>

                                <!--  NOVA SEO: Entrega e Pagamento -->
                                <section class="order-section">
                                    <div class="section-header">
                                        <h4>Entrega e Pagamento</h4>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label for="order-qtd_volumes">Quantidade de Volumes</label><input class="modern-input" type="text" id="order-qtd_volumes" placeholder="Ex: 10 volumes"></div>
                                        <div class="form-group"><label for="order-tipo_embalagem_entrega">Tipo de Embalagem</label><input class="modern-input" type="text" id="order-tipo_embalagem_entrega" placeholder="Ex: Caixas, Pallets"></div>
                                    </div>
                                    <div class="form-group"><label for="order-observacoes_entrega">Observaes de Entrega</label><textarea class="modern-input" id="order-observacoes_entrega" rows="2" placeholder="Observaes sobre a entrega"></textarea></div>
                                    <div class="form-row">
                                        <div class="form-group"><label for="order-condicoes_pagamento">Condies de Pagamento</label><input class="modern-input" type="text" id="order-condicoes_pagamento" placeholder="Ex: 30 dias aps faturamento" value="30 dias aps faturamento"></div>
                                        <div class="form-group"><label for="order-metodo_pagamento">Mtodo de Pagamento</label>
                                            <select class="modern-input" id="order-metodo_pagamento">
                                                <option value="Transferncia Bancria" selected>Transferncia</option>
                                                <option value="Boleto">Boleto</option>
                                                <option value="PIX">PIX</option>
                                                <option value="Carto">Carto</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group"><label for="order-observacoes_pedido">Observaes do Pedido</label><textarea class="modern-input" id="order-observacoes_pedido" rows="3" placeholder="Observaes gerais do pedido"></textarea></div>
                                    <div class="form-group"><label for="order-numero_pedido">Nmero do Pedido</label><input class="modern-input" type="text" id="order-numero_pedido" placeholder="Nmero do pedido (distinto da referncia)"></div>
                                </section>
                            </div>

                            <!-- Right: Cliente & Comercial -->
                            <aside class="order-side">
                                <section class="order-section sticky-side">
                                    <div class="section-header">
                                        <h4>Cliente & Contato</h4>
                                    </div>
                                    <div class="form-group" style="position: relative;">
                                        <label for="order-cliente">Cliente <span class="required">*</span></label>
                                        <input class="modern-input" type="text" id="order-cliente" placeholder="Buscar por nome ou CNPJ" required
                                               oninput="buscarCliente(this.value)"
                                               onfocus="mostrarClientesDropdown()"
                                               onblur="setTimeout(() => ocultarClientesDropdown(), 200)">
                                        <div id="cliente-autocomplete" class="autocomplete-dropdown" style="display: none;"></div>
                                        <input type="hidden" id="order-cliente_id" value="" />
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label for="order-contato">Contato <span class="required">*</span></label><input class="modern-input" type="text" id="order-contato" placeholder="Pessoa de contato" required></div>
                                        <div class="form-group"><label for="order-email">Email <span class="required">*</span></label><input class="modern-input" type="email" id="order-email" placeholder="contato@empresa.com" required></div>
                                    </div>
                                    <div class="form-group"><label for="order-telefone">Telefone <span class="required">*</span></label><input class="modern-input" type="tel" id="order-telefone" placeholder="(11) 99999-9999" required></div>
                                </section>

                                <section class="order-section">
                                    <div class="section-header">
                                        <h4>Comercial</h4>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label for="order-frete">Tipo de Frete</label>
                                            <select class="modern-input" id="order-frete">
                                                <option value="FOB">FOB</option>
                                                <option value="CIF">CIF</option>
                                            </select>
                                        </div>
                                        <div class="form-group" style="position: relative;">
                                            <label for="order-vendedor">Vendedor</label>
                                            <input class="modern-input" type="text" id="order-vendedor" placeholder="Vendedor responsvel" 
                                                   onfocus="mostrarVendedoresDropdown()" 
                                                   onblur="setTimeout(() => ocultarVendedoresDropdown(), 200)"
                                                   oninput="filtrarVendedores(this.value)">
                                            <div id="vendedor-dropdown" class="autocomplete-dropdown" style="display: none;"></div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label for="order-numero_orcamento">Nmero do Oramento</label><input class="modern-input" type="text" id="order-numero_orcamento" placeholder="Oramento #"></div>
                                        <div class="form-group"><label for="order-revisao">Reviso</label><input class="modern-input" type="text" id="order-revisao" placeholder="Rev."></div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label for="order-pedido_referencia">Pedido (ref.)</label><input class="modern-input" type="text" id="order-pedido_referencia" placeholder="Pedido cliente"></div>
                                        <div class="form-group"><label for="order-data_liberacao">Data de Liberao</label><input class="modern-input" type="date" id="order-data_liberacao"></div>
                                    </div>
                                    
                                    <!-- Formas de Pagamento -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="order-forma_pagamento">Forma de Pagamento</label>
                                            <select class="modern-input" id="order-forma_pagamento">
                                                <option value="">-- Selecionar --</option>
                                                <option value="A VISTA">A VISTA</option>
                                                <option value="PARCELADO">PARCELADO</option>
                                                <option value="ANTECIPADO">ANTECIPADO</option>
                                                <option value="ENTREGA">ENTREGA</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- Mtodo de Pagamento com percentuais -->
                                    <div class="form-group">
                                        <label>Mtodo de Pagamento</label>
                                        <div class="payment-methods">
                                            <div class="payment-method-item">
                                                <input type="checkbox" id="order-metodo_transferencia" value="TRANSFERENCIA">
                                                <label for="order-metodo_transferencia">TRANSFERNCIA</label>
                                                <input type="number" id="order-metodo_transferencia_percent" class="modern-input percent-input" placeholder="%" min="0" max="100" step="0.01" disabled>
                                            </div>
                                            <div class="payment-method-item">
                                                <input type="checkbox" id="order-metodo_deposito" value="DEPOSITO">
                                                <label for="order-metodo_deposito">DEPSITO</label>
                                                <input type="number" id="order-metodo_deposito_percent" class="modern-input percent-input" placeholder="%" min="0" max="100" step="0.01" disabled>
                                            </div>
                                            <div class="payment-method-item">
                                                <input type="checkbox" id="order-metodo_faturamento" value="FATURAMENTO">
                                                <label for="order-metodo_faturamento">FATURAMENTO</label>
                                                <input type="number" id="order-metodo_faturamento_percent" class="modern-input percent-input" placeholder="%" min="0" max="100" step="0.01" disabled>
                                            </div>
                                            <div class="payment-total">
                                                Total: <span id="order-metodo-total-percent">0</span>%
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                </section>
                            </aside>
                        </form>
                    </div>
                    
                    <!-- Footer -->
                    <div class="modal-footer">
                        <button type="button" id="order-cancel" class="btn-secondary">
                            Cancelar
                        </button>
                        <button type="submit" form="order-form" class="btn-primary">
                            Criar Ordem
                        </button>
                    </div>
                </div>
            </div>

            <!-- View de Catlogo de Produtos -->
            <div id="catalogo-produtos-view" class="hidden">
                <!-- Hero Section -->
                <div class="page-hero gradient-indigo">
                    <div class="hero-content">
                        <div class="hero-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="hero-text">
                            <h1 class="hero-title">Catlogo de Produtos</h1>
                            <p class="hero-subtitle">Sistema completo com EAN-13, SKU, NCM e controle de estoque</p>
                        </div>
                        <div class="hero-actions">
                            <button class="btn-hero primary" onclick="carregarCatalogoProdutos()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                            <button class="btn-hero danger" onclick="exportarCatalogoPDF()">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn-hero success" onclick="exportarCatalogoExcel()">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Estatsticas do Catlogo -->
                <div class="stats-grid-modern">
                    <div class="stat-card-modern indigo-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="catalogo-total-produtos">0</div>
                            <div class="stat-label-modern">Total de Produtos</div>
                        </div>
                    </div>
                    <div class="stat-card-modern green-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="catalogo-com-estoque">0</div>
                            <div class="stat-label-modern">Com Estoque</div>
                        </div>
                    </div>
                    <div class="stat-card-modern orange-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="catalogo-estoque-baixo">0</div>
                            <div class="stat-label-modern">Estoque Baixo</div>
                        </div>
                    </div>
                    <div class="stat-card-modern purple-gradient">
                        <div class="stat-icon-modern">
                            <i class="fas fa-barcode"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value-modern" id="catalogo-com-ean">0</div>
                            <div class="stat-label-modern">Com EAN-13</div>
                        </div>
                    </div>
                </div>

                <!-- Filtros e Busca -->
                <div class="catalog-filters-container">
                    <div class="search-box-modern">
                        <i class="fas fa-search"></i>
                        <input type="text" id="catalogo-search" placeholder="Buscar por nome, EAN-13, SKU ou NCM..." onkeyup="filtrarCatalogo()">
                    </div>
                    <div class="filters-row">
                        <select id="filter-categoria" class="filter-select-modern" onchange="filtrarCatalogo()">
                            <option value="">Todas as Categorias</option>
                            <option value="ALUMNIO">Alumnio</option>
                            <option value="VIDRO">Vidro</option>
                            <option value="FERRAGENS">Ferragens</option>
                            <option value="ACESSRIOS">Acessrios</option>
                        </select>
                        <select id="filter-estoque" class="filter-select-modern" onchange="filtrarCatalogo()">
                            <option value="">Todos os Estoques</option>
                            <option value="disponivel">Disponvel (> 0)</option>
                            <option value="baixo">Estoque Baixo (< 10)</option>
                            <option value="zeração">Zeração (= 0)</option>
                        </select>
                        <button class="btn-clear-filters" onclick="limparFiltrosCatalogo()">
                            <i class="fas fa-redo"></i> Limpar
                        </button>
                    </div>
                </div>

                <!-- Grid de Produtos -->
                <div class="catalog-grid-modern" id="catalogo-grid">
                    <div class="loading-state">
                        <div class="spinner-modern"></div>
                        <p>Carregando catlogo...</p>
                    </div>
                </div>

                <!-- Paginao -->
                <div class="pagination-modern" id="catalogo-pagination">
                    <!-- Geração dinamicamente -->
                </div>
            </div>

            <!-- View de Relatrios -->
            <div id="relatorios-view" class="hidden">
                <!-- Hero Section -->
                <div class="page-hero gradient-teal">
                    <div class="hero-content">
                        <div class="hero-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="hero-text">
                            <h1 class="hero-title">Relatrios e Anlises</h1>
                            <p class="hero-subtitle">Visualize dados, exporte relatrios e analise performance</p>
                        </div>
                        <div class="hero-actions">
                            <button class="btn-hero primary" onclick="atualizarRelatorios()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Grid de Painis de Relatrios -->
                <div class="reports-grid-modern">
                    <!-- Alertas de Estoque -->
                    <div class="report-card-modern">
                        <div class="report-header">
                            <div class="report-icon warning">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="report-title">
                                <h3>Alertas de Estoque</h3>
                                <p>Produtos com estoque abaixo do mnimo</p>
                            </div>
                        </div>
                        <div class="report-body" id="alertas-container">
                            <div class="loading-state-small">
                                <div class="spinner-small"></div>
                                <p>Carregando alertas...</p>
                            </div>
                        </div>
                        <div class="report-footer">
                            <button class="btn-report success" id="btn-export-alertas">
                                <i class="fas fa-file-excel"></i> Exportar Excel
                            </button>
                        </div>
                    </div>

                    <!-- Exports Rpidos -->
                    <div class="report-card-modern">
                        <div class="report-header">
                            <div class="report-icon primary">
                                <i class="fas fa-file-export"></i>
                            </div>
                            <div class="report-title">
                                <h3>Exportaes Rpidas</h3>
                                <p>Relatrios em Excel e PDF</p>
                            </div>
                        </div>
                        <div class="report-body">
                            <div class="export-buttons-grid">
                                <button class="export-btn" id="btn-export-ordens">
                                    <i class="fas fa-tasks"></i>
                                    <span>Ordens de Produo</span>
                                </button>
                                <button class="export-btn" id="btn-export-completo">
                                    <i class="fas fa-database"></i>
                                    <span>Daçãos Completos</span>
                                </button>
                                <button class="export-btn" id="btn-relatorio-produtividade">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Produtividade</span>
                                </button>
                                <button class="export-btn" id="btn-relatorio-custos">
                                    <i class="fas fa-dollar-sign"></i>
                                    <span>Anlise de Custos</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Movimentaes de Estoque -->
                    <div class="report-card-modern">
                        <div class="report-header">
                            <div class="report-icon info">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="report-title">
                                <h3>Movimentaes</h3>
                                <p>Registrar entradas e sadas</p>
                            </div>
                        </div>
                        <div class="report-body">
                            <form id="form-movimentacao" class="form-movimentacao-modern">
                                <div class="form-group-modern">
                                    <select id="mov-material" class="input-modern" required>
                                        <option value="">Selecione Material</option>
                                    </select>
                                </div>
                                <div class="form-group-modern">
                                    <select id="mov-tipo" class="input-modern" required>
                                        <option value="ENTRADA"> Entrada</option>
                                        <option value="SAIDA"> Sada</option>
                                        <option value="AJUSTE"> Ajuste</option>
                                    </select>
                                </div>
                                <div class="form-group-modern">
                                    <input type="number" id="mov-quantidade" step="0.01" placeholder="Quantidade" class="input-modern" required>
                                </div>
                                <div class="form-group-modern">
                                    <input type="text" id="mov-observacoes" placeholder="Observaes" class="input-modern">
                                </div>
                                <button type="submit" class="btn-modern primary full-width">
                                    <i class="fas fa-save"></i> Registrar Movimentao
                                </button>
                            </form>
                        </div>
                        <div class="report-footer">
                            <button class="btn-report secondary" id="btn-ver-movimentacoes">
                                <i class="fas fa-history"></i> Ver Histrico
                            </button>
                        </div>
                    </div>

                    <!-- Backup e Manuteno -->
                    <div class="report-card-modern">
                        <div class="report-header">
                            <div class="report-icon danger">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="report-title">
                                <h3>Backup & Manuteno</h3>
                                <p>Segurana e integridade dos dados</p>
                            </div>
                        </div>
                        <div class="report-body">
                            <div class="backup-info">
                                <div class="info-item">
                                    <i class="fas fa-clock"></i>
                                    <span>Backup automtico: Dirio s 2:00h</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>ltimo backup: Hoje, 02:15</span>
                                </div>
                            </div>
                            <div class="backup-buttons">
                                <button class="btn-backup" id="btn-backup-manual">
                                    <i class="fas fa-save"></i> Backup Manual
                                </button>
                                <button class="btn-backup secondary" id="btn-historico-backup">
                                    <i class="fas fa-history"></i> Histrico
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

    <!-- ===== SISTEMA DE ERROR BOUNDARY E PROTEO GLOBAL ===== -->
    <script>
        // Sistema de captura global de erros
        class ErrorBoundary {
            constructor() {
                this.errors = [];
                this.maxErrors = 10;
                this.fallbackShown = false;
                this.init();
            }

            init() {
                // Capturar erros JavaScript globais
                window.addEventListener('error', (event) => {
                    this.handleError({
                        type: 'runtime',
                        message: event.message,
                        filename: event.filename,
                        lineno: event.lineno,
                        colno: event.colno,
                        stack: event.error.stack,
                        timestamp: new Date().toISOString()
                    });
                    event.preventDefault();
                });

                // Capturar promises rejeitadas no tratadas
                window.addEventListener('unhandledrejection', (event) => {
                    this.handleError({
                        type: 'promise',
                        message: event.reason.message || String(event.reason),
                        stack: event.reason.stack,
                        timestamp: new Date().toISOString()
                    });
                    event.preventDefault();
                });

                // Verificar DOM periodicamente
                this.startHealthCheck();
            }

            handleError(error) {
                console.error(' Error Boundary capturou erro:', error);
                
                // Adicionar erro  lista
                this.errors.push(error);
                if (this.errors.length > this.maxErrors) {
                    this.errors.shift();
                }

                // Mostrar feedback ao usurio
                this.showErrorNotification(error);

                // Se erros crticos persistirem, mostrar fallback
                if (this.errors.length >= 3 && !this.fallbackShown) {
                    this.showFallbackUI();
                }
            }

            showErrorNotification(error) {
                // Remover notificaes antigas
                const oldNotification = document.querySelector('.error-boundary-notification');
                if (oldNotification) {
                    oldNotification.remove();
                }

                // Criar nova notificao
                const notification = document.createElement('div');
                notification.className = 'error-boundary-notification';
                notification.innerHTML = `
                    <div class="error-boundary-content">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="error-boundary-message">
                            <strong>Ocorreu um erro temporrio</strong>
                            <small>${this.getSafeErrorMessage(error)}</small>
                        </div>
                        <button class="error-boundary-retry" onclick="window.errorBoundary.retry()">
                            <i class="fas fa-sync-alt"></i> Tentar novamente
                        </button>
                        <button class="error-boundary-close" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;

                document.body.appendChild(notification);

                // Auto-remover aps 10 segundos
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 10000);
            }

            getSafeErrorMessage(error) {
                const message = error.message || 'Erro desconhecido';
                
                // Mensagens amigveis para erros comuns
                if (message.includes('fetch') || message.includes('network')) {
                    return 'Problema de conexo. Verifique sua internet.';
                }
                if (message.includes('null') || message.includes('undefined')) {
                    return 'Alguns dados no foram carregaçãos corretamente.';
                }
                if (message.includes('timeout')) {
                    return 'A operao demorou muito tempo.';
                }
                
                return 'Tente recarregar a pgina ou entre em contato com o suporte.';
            }

            showFallbackUI() {
                this.fallbackShown = true;
                
                const fallback = document.createElement('div');
                fallback.className = 'error-boundary-fallback';
                fallback.innerHTML = `
                    <div class="error-boundary-fallback-content">
                        <i class="fas fa-exclamation-circle"></i>
                        <h2>Ops! Algo deu erração</h2>
                        <p>Detectamos mltiplos erros na aplicao.</p>
                        <div class="error-boundary-actions">
                            <button class="btn-primary" onclick="window.location.reload()">
                                <i class="fas fa-sync-alt"></i> Recarregar Pgina
                            </button>
                            <button class="btn-secondary" onclick="window.errorBoundary.dismissFallback()">
                                <i class="fas fa-times"></i> Continuar Mesmo Assim
                            </button>
                        </div>
                        <details class="error-boundary-details">
                            <summary>Detalhes tcnicos</summary>
                            <pre>${JSON.stringify(this.errors, null, 2)}</pre>
                        </details>
                    </div>
                `;

                document.body.appendChild(fallback);
            }

            dismissFallback() {
                const fallback = document.querySelector('.error-boundary-fallback');
                if (fallback) {
                    fallback.remove();
                }
                this.fallbackShown = false;
                this.errors = [];
            }

            retry() {
                // Remover notificao
                const notification = document.querySelector('.error-boundary-notification');
                if (notification) {
                    notification.remove();
                }

                // Recarregar a view atual
                const activeView = document.querySelector('.app-container > div:not(.hidden)');
                if (activeView) {
                    const viewId = activeView.id;
                    console.log(` Tentando recarregar view: ${viewId}`);
                    
                    // Tentar recarregar dados especficos da view
                    switch(viewId) {
                        case 'dashboard-view':
                            if (typeof carregarDashboard === 'function') carregarDashboard();
                            break;
                        case 'materiais-view':
                            if (typeof carregarMateriais === 'function') carregarMateriais();
                            break;
                        case 'catalogo-produtos-view':
                            if (typeof carregarCatalogoProdutos === 'function') carregarCatalogoProdutos();
                            break;
                        case 'producao-faturamento-view':
                            if (typeof carregarProducaoFaturamento === 'function') carregarProducaoFaturamento();
                            break;
                        default:
                            console.log('Nenhuma ao de reload definida para esta view');
                    }
                }
            }

            startHealthCheck() {
                // Verificar se o DOM est saudvel a cada 30 segundos
                setInterval(() => {
                    const appContainer = document.querySelector('.app-container');
                    if (!appContainer) {
                        console.error(' Container principal no encontrado!');
                        this.handleError({
                            type: 'dom',
                            message: 'Container principal ausente do DOM',
                            timestamp: new Date().toISOString()
                        });
                    }
                }, 30000);
            }

            getErrorReport() {
                return {
                    totalErrors: this.errors.length,
                    errors: this.errors,
                    timestamp: new Date().toISOString()
                };
            }
        }

        // Inicializar Error Boundary global
        window.errorBoundary = new ErrorBoundary();
        console.log(' Sistema de Error Boundary inicialização');

        // Wrapper seguro para chamadas de API
        window.safeApiCall = async function(apiFunction, fallbackData = null) {
            try {
                const result = await apiFunction();
                return { success: true, data: result };
            } catch (error) {
                console.error(' Erro em safeApiCall:', error);
                window.errorBoundary.handleError({
                    type: 'api',
                    message: error.message,
                    stack: error.stack,
                    timestamp: new Date().toISOString()
                });
                return { success: false, error: error.message, data: fallbackData };
            }
        };

        // Wrapper seguro para operaes DOM
        window.safeDomOperation = function(operation, errorMessage = 'Erro na operao DOM') {
            try {
                return operation();
            } catch (error) {
                console.error(' Erro em safeDomOperation:', error);
                window.errorBoundary.handleError({
                    type: 'dom',
                    message: errorMessage,
                    originalError: error.message,
                    stack: error.stack,
                    timestamp: new Date().toISOString()
                });
                return null;
            }
        };
    </script>

    <!-- ===== ESTILOS DO ERROR BOUNDARY ===== -->
    <style>
        /* Notificaes de erro */
        .error-boundary-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10000;
            animation: slideInRight 0.3s ease-out;
        }

        .error-boundary-content {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
            max-width: 500px;
        }

        .error-boundary-content i.fa-exclamation-triangle {
            color: #dc2626;
            font-size: 24px;
            flex-shrink: 0;
        }

        .error-boundary-message {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .error-boundary-message strong {
            color: #991b1b;
            font-size: 14px;
            font-weight: 600;
        }

        .error-boundary-message small {
            color: #7f1d1d;
            font-size: 12px;
        }

        .error-boundary-retry,
        .error-boundary-close {
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .error-boundary-retry:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }

        .error-boundary-close {
            background: transparent;
            color: #991b1b;
            padding: 8px;
        }

        .error-boundary-close:hover {
            background: rgba(220, 38, 38, 0.1);
        }

        /* Fallback UI */
        .error-boundary-fallback {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .error-boundary-fallback-content {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .error-boundary-fallback-content i {
            font-size: 64px;
            color: #ef4444;
            margin-bottom: 20px;
        }

        .error-boundary-fallback-content h2 {
            font-size: 28px;
            margin-bottom: 12px;
            color: white;
        }

        .error-boundary-fallback-content p {
            font-size: 16px;
            color: #cbd5e1;
            margin-bottom: 30px;
        }

        .error-boundary-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .error-boundary-actions button {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .error-boundary-actions .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .error-boundary-actions .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .error-boundary-actions .btn-secondary {
            background: transparent;
            border: 2px solid #475569;
            color: #cbd5e1;
        }

        .error-boundary-actions .btn-secondary:hover {
            border-color: #64748b;
            background: rgba(71, 85, 105, 0.1);
        }

        .error-boundary-details {
            margin-top: 20px;
            text-align: left;
        }

        .error-boundary-details summary {
            cursor: pointer;
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .error-boundary-details pre {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            font-size: 11px;
            color: #e2e8f0;
            overflow: auto;
            max-height: 200px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Loading skeletons */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .skeleton-title {
            height: 20px;
            width: 60%;
            margin-bottom: 12px;
        }

        .skeleton-text {
            height: 14px;
            width: 100%;
            margin-bottom: 8px;
        }

        .skeleton-text:last-child {
            width: 80%;
        }
    </style>

    <script src="socket.io/socket.io.js"></script>
    <!-- Chart.js for mini-charts in dashboard panels -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="auth-redirect.js"></script>
    
    <!-- ===== MDULOS PCP - Carregam ANTES do pcp_modern.js ===== -->
    <script src="pcp.jsv=14.0&cache=1732234800"></script>
    <script src="aplicar-tema-premium.js"></script>
    <script src="auto-gerar-ordem.js"></script>
    <script src="busca-estoque.js"></script>
    <script src="estoque-tempo-real.jsv=1.0&cache=1732234800"></script>
    <script src="materiais-functions.js"></script>
    <script src="usuario-system.js"></script>
    
    <!-- ===== NAVEGAO PRINCIPAL - Carrega POR LTIMO ===== -->
    <script src="pcp_modern.jsv=8.1&cache=1732234800"></script>
    
    <!-- Scripts auxiliares -->
    <script src="exclusao-produto-moderna.jsv=1.0&cache=1732234800"></script>
    <script src="modal-nova-ordem-aprimoração.jsv=1.0&cache=1732234800"></script>
    <script src="producao-faturamento.js"></script>
    <script src="ordens-compra.js"></script>
    
    <!-- Hidden template: Novo Material (used as modal form source) -->
    <div id="form-novo-material" class="hidden" aria-hidden="true">
        <form id="form-novo-material-template">
            <div class="form-row">
                <div class="form-group"><label for="codigo_material_form">Cdigo do Material</label><input class="modern-input" type="text" id="codigo_material_form" required></div>
                <div class="form-group"><label for="unidade_medida_form">Unidade de Medida</label><input class="modern-input" type="text" id="unidade_medida_form" placeholder="Ex: kg, m, un" required></div>
            </div>
            <div class="form-group"><label for="descricao_material_form">Descrio</label><input class="modern-input" type="text" id="descricao_material_form" required></div>
            <div class="form-group"><label for="estoque_inicial_form">Estoque Inicial</label><input class="modern-input" type="number" step="0.01" id="estoque_inicial_form" value="0" required></div>
            <div class="mt-12"><button type="submit" class="btn">Adicionar Material</button></div>
        </form>
    </div>
    <!-- Toast container for non-blocking notifications -->
    <div id="pcp-toast-container" role="status" aria-live="polite" aria-atomic="true" class="pcp-toast-container" hidden></div>
    
    <!-- Script de fora-atualizao para garantir que as colunas SKU/GTIN apaream -->
    <script>
        // ==================== ALERTAS DE ESTOQUE ====================
        
        async function carregarAlertasEstoque() {
            console.log(' Carregando alertas de estoque...');
            const container = document.getElementById('pcp-low-stock');
            const contaçãor = document.getElementById('alertas-numero');
            
            if (!container || !contaçãor) {
                console.warn('Containers de alertas no encontrados');
                return;
            }
            
            try {
                // Primary: try legacy endpoint
                let response = await fetch('/api/alertas-estoque');
                // Fallback: try PCP namespaced endpoint if legacy returns error/404
                if (!response.ok) {
                    console.warn('Legacy /api/alertas-estoque failed, trying /api/pcp/produtos/estoque-baixo', response.status);
                    try {
                        response = await fetch('/api/pcp/produtos/estoque-baixo');
                    } catch (e) {
                        console.warn('Fallback request to /api/pcp/produtos/estoque-baixo failed', e);
                    }
                }

                let data = null;
                if (response && response.ok) {
                    try { data = await response.json(); } catch (e) { console.warn('Erro ao parsear JSON de alertas:', e); }
                } else {
                    console.warn('Nenhuma resposta ok para alertas de estoque');
                }
                
                contaçãor.textContent = data.total || 0;
                
                if (data.alertas && data.alertas.length > 0) {
                    container.innerHTML = data.alertas.map(alerta => {
                        const statusClass = alerta.status === 'critico' ? 'critico' : 'baixo';
                        const statusLabel = alerta.status === 'critico' ? 'Crtico' : 
                                          alerta.status === 'indisponivel' ? 'Indisponvel' : 'Baixo';
                        
                        return `
                            <div class="alerta-item ${statusClass}" data-produto-id="${alerta.id}">
                                <div class="alerta-item-header">
                                    <span class="alerta-codigo">${alerta.codigo}</span>
                                    <span class="alerta-badge ${statusClass}">${statusLabel}</span>
                                </div>
                                <div class="alerta-nome">${alerta.nome}</div>
                                <div class="alerta-quantidades">
                                    <div class="alerta-quantidade">
                                        <i class="fas fa-cubes"></i>
                                        <span>Atual: <span class="valor ${statusClass}">${alerta.quantidade_atual}</span></span>
                                    </div>
                                    <div class="alerta-quantidade">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <span>Mnimo: <span class="valor">${alerta.estoque_minimo}</span></span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // Adicionar eventos de clique nos alertas
                    container.querySelectorAll('.alerta-item').forEach(item => {
                        item.addEventListener('click', () => {
                            const produtoId = item.dataset.produtoId;
                            // Navegar para gesto de produtos
                            document.getElementById('btn-gestao-produtos').click();
                            setTimeout(() => {
                                // Highlight do produto na tabela
                                const linha = document.querySelector(r[data-produto-id="${produtoId}"]`);
                                if (linha) {
                                    linha.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                    linha.style.background = '#fef2f2';
                                    setTimeout(() => {
                                        linha.style.background = '';
                                    }, 2000);
                                }
                            }, 500);
                        });
                    });
                    
                    console.log(` ${data.total} alertas de estoque carregaçãos`);
                } else {
                    container.innerHTML = `
                        <div class="alertas-empty">
                            <i class="fas fa-check-circle"></i>
                            <p>Nenhum alerta de estoque</p>
                            <small style="color: #10b981;">Todos os produtos esto com estoque adequação!</small>
                        </div>
                    `;
                    console.log(' Nenhum alerta de estoque');
                }
            } catch (error) {
                console.error(' Erro ao carregar alertas:', error);
                container.innerHTML = `
                    <div class="alertas-empty">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Erro ao carregar alertas</p>
                        <small style="color: #ef4444;">Tente novamente mais tarde</small>
                    </div>
                `;
                contaçãor.textContent = '0';
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar alertas de estoque ao iniciar
            carregarAlertasEstoque();
            
            // Configurar botes de ao dos alertas
            const btnVerAlertas = document.getElementById('btn-ver-todos-alertas');
            const btnRelatorios = document.getElementById('btn-relatorios');
            
            if (btnVerAlertas) {
                btnVerAlertas.addEventListener('click', () => {
                    // Ir para gesto de produtos com filtro de baixo estoque
                    document.getElementById('btn-gestao-produtos').click();
                });
            }
            
            if (btnRelatorios) {
                btnRelatorios.addEventListener('click', () => {
                    // Ir para gesto de materiais
                    document.getElementById('btn-materiais').click();
                });
            }
            
            // Atualizar alertas a cada 5 minutos
            setInterval(carregarAlertasEstoque, 5 * 60 * 1000);
            
            // Garantir que as variveis globais esto definidas
            if (typeof API_BASE_URL === 'undefined') {
                window.API_BASE_URL = '/api/pcp';
            }
            
            // Fora a recarga da seo de produtos aps 2 segundos
            setTimeout(() => {
                if (typeof switchSection === 'function') {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Forando reload da seo produtos...');
                    switchSection('produtos');
                } else if (typeof carregarProdutos === 'function') {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Carregando produtos diretamente...');
                    carregarProdutos(1, 10);
                }
            }, 2000);
            
            // Fora atualizao visual dos botes
            setTimeout(() => {
                const editBtns = document.querySelectorAll('.btn-editar-prod');
                const deleteBtns = document.querySelectorAll('.btn-excluir-prod');
                
                console.log(`<i class="fas fa-tools"></i> Botes encontrados: ${editBtns.length} editar, ${deleteBtns.length} excluir`);
                
                if (editBtns.length === 0 || deleteBtns.length === 0) {
                    console.warn('<i class="fas fa-exclamation-triangle"></i> Botes no encontrados - pode haver problema de cache');
                    
                    // Fora hard refresh se necessrio
                    if (!localStorage.getItem('force_refreshed')) {
                        localStorage.setItem('force_refreshed', 'true');
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Fazendo hard refresh...');
                        window.location.reload(true);
                    }
                }
            }, 5000);
        });

        // ==================== SISTEMA DE AUTOCOMPLETAR DE PRODUTOS MELHORADO ====================
        
        // Array global para armazenar produtos da API
        let produtosCompletos = [];
        
        // Funo para mostrar toast (DEVE ESTAR ANTES de carregarProdutosDaAPI)
        function mostrarToast(mensagem, tipo = 'info') {
            const toastExistente = document.querySelector('.autocomplete-toast');
            if (toastExistente) {
                toastExistente.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'autocomplete-toast';
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 6px;
                color: white;
                font-weight: 500;
                font-size: 14px;
                z-index: 10000;
                min-width: 300px;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
            `;
            
            switch (tipo) {
                case 'success':
                    toast.style.background = '#28a745';
                    break;
                case 'warning':
                    toast.style.background = '#ffc107';
                    toast.style.color = '#212529';
                    break;
                case 'error':
                    toast.style.background = '#dc3545';
                    break;
                default:
                    toast.style.background = '#6c757d';
            }
            
            toast.textContent = mensagem;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            }, 10);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }
        
        // Funo para carregar produtos da API
        async function carregarProdutosDaAPI() {
            // Produtos hardcoded como fallback (cdigos corretos: sem sufixo = Aluforce, _LAB = Labor Energy)
            const produtosLocal = [
                // TRIPLEX ALUFORCE (sem sufixo)
                { codigo: 'TRI10', nome: 'CABO TRIPLEX 3x10mm (2#10 + 1#10) LABOR 0,6/1KV', preco: 35.50, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI16', nome: 'CABO TRIPLEX 3x16mm (2#16 + 1#16) LABOR 0,6/1KV', preco: 45.80, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI25', nome: 'CABO TRIPLEX 3x25mm (2#25 + 1#25) LABOR 0,6/1KV', preco: 65.90, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI35', nome: 'CABO TRIPLEX 3x35mm (2#35 + 1#35) LABOR 0,6/1KV', preco: 85.20, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI50', nome: 'CABO TRIPLEX 3x50mm (2#50 + 1#50) LABOR 0,6/1KV', preco: 125.50, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI70', nome: 'CABO TRIPLEX 3x70mm (2#70 + 1#70) LABOR 0,6/1KV', preco: 165.80, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI95', nome: 'CABO TRIPLEX 3x95mm (2#95 + 1#95) LABOR 0,6/1KV', preco: 210.90, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI120', nome: 'CABO TRIPLEX 3x120mm (2#120 + 1#120) LABOR 0,6/1KV', preco: 285.40, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI150', nome: 'CABO TRIPLEX 3x150mm (2#150 + 1#150) LABOR 0,6/1KV', preco: 355.60, marca: 'Aluforce', variacao: 'Preto / Preto / Nu' },
                
                // TRIPLEX LABOR (_LAB)
                { codigo: 'TRI10_LAB', nome: 'CABO TRIPLEX 3x10mm (2#10 + 1#10) LABOR 0,6/1KV', preco: 32.30, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI16_LAB', nome: 'CABO TRIPLEX 3x16mm (2#16 + 1#16) LABOR 0,6/1KV', preco: 42.60, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI25_LAB', nome: 'CABO TRIPLEX 3x25mm (2#25 + 1#25) LABOR 0,6/1KV', preco: 62.70, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI35_LAB', nome: 'CABO TRIPLEX 3x35mm (2#35 + 1#35) LABOR 0,6/1KV', preco: 82.00, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI50_LAB', nome: 'CABO TRIPLEX 3x50mm (2#50 + 1#50) LABOR 0,6/1KV', preco: 122.30, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI70_LAB', nome: 'CABO TRIPLEX 3x70mm (2#70 + 1#70) LABOR 0,6/1KV', preco: 162.60, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI95_LAB', nome: 'CABO TRIPLEX 3x95mm (2#95 + 1#95) LABOR 0,6/1KV', preco: 207.70, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI120_LAB', nome: 'CABO TRIPLEX 3x120mm (2#120 + 1#120) LABOR 0,6/1KV', preco: 282.20, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                { codigo: 'TRI150_LAB', nome: 'CABO TRIPLEX 3x150mm (2#150 + 1#150) LABOR 0,6/1KV', preco: 352.40, marca: 'Labor Energy', variacao: 'Preto / Preto / Nu' },
                
                // DUPLEX ALUFORCE (sem sufixo)
                { codigo: 'DUN10', nome: 'CABO DUPLEX NEUTRO NU 2x10mm LABOR 0,6/1KV', preco: 28.90, marca: 'Aluforce', variacao: 'Preto / Nu' },
                { codigo: 'DUN16', nome: 'CABO DUPLEX NEUTRO NU 2x16mm LABOR 0,6/1KV', preco: 38.20, marca: 'Aluforce', variacao: 'Preto / Nu' },
                { codigo: 'DUN25', nome: 'CABO DUPLEX NEUTRO NU 2x25mm LABOR 0,6/1KV', preco: 52.30, marca: 'Aluforce', variacao: 'Preto / Nu' },
                { codigo: 'DUN35', nome: 'CABO DUPLEX NEUTRO NU 2x35mm LABOR 0,6/1KV', preco: 68.40, marca: 'Aluforce', variacao: 'Preto / Nu' },
                { codigo: 'DUN50', nome: 'CABO DUPLEX NEUTRO NU 2x50mm LABOR 0,6/1KV', preco: 95.60, marca: 'Aluforce', variacao: 'Preto / Nu' },
                
                // DUPLEX LABOR (_LAB)
                { codigo: 'DUN10_LAB', nome: 'CABO DUPLEX NEUTRO NU 2x10mm LABOR 0,6/1KV', preco: 25.70, marca: 'Labor Energy', variacao: 'Preto / Nu' },
                { codigo: 'DUN16_LAB', nome: 'CABO DUPLEX NEUTRO NU 2x16mm LABOR 0,6/1KV', preco: 35.00, marca: 'Labor Energy', variacao: 'Preto / Nu' },
                { codigo: 'DUN25_LAB', nome: 'CABO DUPLEX NEUTRO NU 2x25mm LABOR 0,6/1KV', preco: 49.10, marca: 'Labor Energy', variacao: 'Preto / Nu' },
                { codigo: 'DUN35_LAB', nome: 'CABO DUPLEX NEUTRO NU 2x35mm LABOR 0,6/1KV', preco: 65.20, marca: 'Labor Energy', variacao: 'Preto / Nu' },
                { codigo: 'DUN50_LAB', nome: 'CABO DUPLEX NEUTRO NU 2x50mm LABOR 0,6/1KV', preco: 92.40, marca: 'Labor Energy', variacao: 'Preto / Nu' },
                
                // QUADRUPLEX ALUFORCE (sem sufixo)
                { codigo: 'QDN10', nome: 'CABO QUADRUPLEX NEUTRO NU 3x10mm + 1x10mm LABOR 0,6/1KV', preco: 42.80, marca: 'Aluforce', variacao: 'Preto / Preto / Preto / Nu' },
                { codigo: 'QDN16', nome: 'CABO QUADRUPLEX NEUTRO NU 3x16mm + 1x16mm LABOR 0,6/1KV', preco: 58.90, marca: 'Aluforce', variacao: 'Preto / Preto / Preto / Nu' },
                { codigo: 'QDN25', nome: 'CABO QUADRUPLEX NEUTRO NU 3x25mm + 1x25mm LABOR 0,6/1KV', preco: 82.40, marca: 'Aluforce', variacao: 'Preto / Preto / Preto / Nu' },
                { codigo: 'QDN50', nome: 'CABO QUADRUPLEX NEUTRO NU 3x50mm + 1x50mm LABOR 0,6/1KV', preco: 125.50, marca: 'Aluforce', variacao: 'Preto / Preto / Preto / Nu' },
                
                // QUADRUPLEX LABOR (_LAB)
                { codigo: 'QDN10_LAB', nome: 'CABO QUADRUPLEX NEUTRO NU 3x10mm + 1x10mm LABOR 0,6/1KV', preco: 39.60, marca: 'Labor Energy', variacao: 'Preto / Preto / Preto / Nu' },
                { codigo: 'QDN16_LAB', nome: 'CABO QUADRUPLEX NEUTRO NU 3x16mm + 1x16mm LABOR 0,6/1KV', preco: 55.70, marca: 'Labor Energy', variacao: 'Preto / Preto / Preto / Nu' },
                { codigo: 'QDN25_LAB', nome: 'CABO QUADRUPLEX NEUTRO NU 3x25mm + 1x25mm LABOR 0,6/1KV', preco: 79.20, marca: 'Labor Energy', variacao: 'Preto / Preto / Preto / Nu' },
                
                // POTNCIA CET ALUFORCE (sem sufixo)
                { codigo: 'CET2.15', nome: 'CABO DE POTNCIA HEPR 0,6/1KV - 2x1,5mm', preco: 45.80, marca: 'Aluforce', variacao: 'Vermelho / Preto' },
                { codigo: 'CET2.25', nome: 'CABO DE POTNCIA HEPR 0,6/1KV - 2x2,5mm', preco: 55.90, marca: 'Aluforce', variacao: 'Vermelho / Preto' },
                { codigo: 'CET3.15', nome: 'CABO DE POTNCIA HEPR 0,6/1KV - 3x1,5mm', preco: 58.90, marca: 'Aluforce', variacao: 'Vermelho / Azul / Preto' },
                
                // POTNCIA CET LABOR (_LAB)
                { codigo: 'CET2.15_LAB', nome: 'CABO DE POTNCIA HEPR 0,6/1KV - 2x1,5mm', preco: 42.60, marca: 'Labor Energy', variacao: 'Vermelho / Preto' },
                { codigo: 'CET2.25_LAB', nome: 'CABO DE POTNCIA HEPR 0,6/1KV - 2x2,5mm', preco: 52.70, marca: 'Labor Energy', variacao: 'Vermelho / Preto' },
                { codigo: 'CET3.15_LAB', nome: 'CABO DE POTNCIA HEPR 0,6/1KV - 3x1,5mm', preco: 55.70, marca: 'Labor Energy', variacao: 'Vermelho / Azul / Preto' },
                
                // FLORES (Cabos nus de alumnio)
                { codigo: 'PEAC', nome: 'CABO ACCIA NU XLPE/PVC 0,6/1KV', preco: 45.50, marca: 'Aluforce', variacao: 'Alumnio' },
                { codigo: 'ROSE', nome: 'CABO ROSA NU XLPE/PVC 0,6/1KV', preco: 52.30, marca: 'Aluforce', variacao: 'Alumnio' },
                { codigo: 'IRIS', nome: 'CABO IRIS NU XLPE/PVC 0,6/1KV', preco: 58.90, marca: 'Aluforce', variacao: 'Alumnio' },
                
                // FLORES LABOR (_LAB)
                { codigo: 'PEAC_LAB', nome: 'CABO ACCIA NU XLPE/PVC 0,6/1KV', preco: 42.30, marca: 'Labor Energy', variacao: 'Alumnio' },
                { codigo: 'ROSE_LAB', nome: 'CABO ROSA NU XLPE/PVC 0,6/1KV', preco: 49.10, marca: 'Labor Energy', variacao: 'Alumnio' },
                { codigo: 'IRIS_LAB', nome: 'CABO IRIS NU XLPE/PVC 0,6/1KV', preco: 55.70, marca: 'Labor Energy', variacao: 'Alumnio' },
                
                // PROTEGIDO 15KV
                { codigo: 'PRO35', nome: 'CABO PROTEGIDO 15KV 35mm AL', preco: 125.80, marca: 'Aluforce', variacao: 'Preto' },
                { codigo: 'PRO50', nome: 'CABO PROTEGIDO 15KV 50mm AL', preco: 168.40, marca: 'Aluforce', variacao: 'Preto' },
                { codigo: 'PRO70', nome: 'CABO PROTEGIDO 15KV 70mm AL', preco: 225.60, marca: 'Aluforce', variacao: 'Preto' },
                
                // PROTEGIDO LABOR (_LAB)
                { codigo: 'PRO35_LAB', nome: 'CABO PROTEGIDO 15KV 35mm AL', preco: 122.60, marca: 'Labor Energy', variacao: 'Preto' },
                { codigo: 'PRO50_LAB', nome: 'CABO PROTEGIDO 15KV 50mm AL', preco: 165.20, marca: 'Labor Energy', variacao: 'Preto' },
                { codigo: 'PRO70_LAB', nome: 'CABO PROTEGIDO 15KV 70mm AL', preco: 222.40, marca: 'Labor Energy', variacao: 'Preto' },
                
                // UNIPOLAR 0,6/1KV
                { codigo: 'UN10', nome: 'CABO UNIPOLAR 10mm XLPE/PVC 0,6/1KV', preco: 18.90, marca: 'Aluforce', variacao: 'Preto' },
                { codigo: 'UN16', nome: 'CABO UNIPOLAR 16mm XLPE/PVC 0,6/1KV', preco: 26.50, marca: 'Aluforce', variacao: 'Preto' },
                { codigo: 'UN25', nome: 'CABO UNIPOLAR 25mm XLPE/PVC 0,6/1KV', preco: 38.70, marca: 'Aluforce', variacao: 'Preto' },
                
                // UNIPOLAR LABOR (_LAB)
                { codigo: 'UN10_LAB', nome: 'CABO UNIPOLAR 10mm XLPE/PVC 0,6/1KV', preco: 15.70, marca: 'Labor Energy', variacao: 'Preto' },
                { codigo: 'UN16_LAB', nome: 'CABO UNIPOLAR 16mm XLPE/PVC 0,6/1KV', preco: 23.30, marca: 'Labor Energy', variacao: 'Preto' },
                { codigo: 'UN25_LAB', nome: 'CABO UNIPOLAR 25mm XLPE/PVC 0,6/1KV', preco: 35.50, marca: 'Labor Energy', variacao: 'Preto' },
                
                // ACESSRIOS
                { codigo: 'CLIP3,0', nome: 'CLIP DE ANCORAGEM 3,0mm', preco: 2.50, marca: 'Aluforce', variacao: 'Metlico' },
                { codigo: 'CLIP3,0_LAB', nome: 'CLIP DE ANCORAGEM 3,0mm', preco: 2.30, marca: 'Labor Energy', variacao: 'Metlico' }
            ];
            
            try {
                console.log(' Carregando produtos da API...');
                const response = await fetch('/api/produtoslimit=0');
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const produtosAPI = await response.json();
                console.log(` ${produtosAPI.length} produtos carregaçãos da API`);
                
                // Mapear produtos da API
                const produtosAPIFormataçãos = produtosAPI.map(p => {
                    const preco = p.preco || p.preco_unitario || p.valor_unitario || p.custo_unitario || 0;
                    return {
                        id: p.id,
                        codigo: p.codigo || '',
                        nome: p.nome || '',
                        descricao: p.descricao || p.nome || '',
                        preco: parseFloat(preco) || 0,
                        preco_unitario: parseFloat(preco) || 0,
                        gtin: p.gtin || '',
                        sku: p.sku || '',
                        variacao: p.variacao || '',
                        marca: p.marca || ''
                    };
                });
                
                // Mesclar: produtos da API + produtos hardcoded (sem duplicar)
                const mapaProdutos = new Map();
                
                // Adicionar produtos da API primeiro
                produtosAPIFormataçãos.forEach(p => {
                    if (p.codigo) {
                        mapaProdutos.set(p.codigo.toUpperCase(), p);
                    }
                });
                
                // Adicionar ou atualizar com produtos hardcoded
                produtosLocal.forEach(p => {
                    const key = p.codigo.toUpperCase();
                    const produtoAPI = mapaProdutos.get(key);
                    
                    if (!produtoAPI) {
                        // Se no existe na API, adicionar hardcoded
                        mapaProdutos.set(key, p);
                    } else if (produtoAPI.preco === 0 && p.preco > 0) {
                        // Se API no tem preo mas hardcoded tem, usar preo hardcoded
                        mapaProdutos.set(key, { ...produtoAPI, preco: p.preco, preco_unitario: p.preco });
                    }
                });
                
                produtosCompletos = Array.from(mapaProdutos.values());
                
                // Contar produtos com preo
                const produtosComPreco = produtosCompletos.filter(p => p.preco > 0).length;
                
                console.log(` Total de produtos disponveis: ${produtosCompletos.length}`);
                console.log(`   - ${produtosAPIFormataçãos.length} produtos da API`);
                console.log(`   - ${produtosLocal.length} produtos hardcoded`);
                console.log(`   - ${produtosComPreco} produtos com preo definido`);
                console.log(' Exemplos de cdigos disponveis:', 
                    produtosCompletos.slice(0, 5).map(p => `${p.codigo} (R$ ${p.preco})`).join(', '));
                
                mostrarToast(` ${produtosCompletos.length} produtos carregaçãos (${produtosComPreco} com preo)!`, 'success');
                
                return produtosCompletos;
            } catch (error) {
                console.error(' Erro ao carregar API:', error);
                console.log(' Usando apenas produtos hardcoded');
                produtosCompletos = produtosLocal;
                mostrarToast(` API indisponvel. ${produtosLocal.length} produtos locais carregaçãos.`, 'warning');
                return produtosCompletos;
            }
        }
        
        function setupProductAutocomplete() {
            let contaçãorItens = 0;

            // Funo para adicionar novo item na tabela
            function adicionarNovoItem() {
                contaçãorItens++;
                const tbody = document.getElementById('order-items-tbody');
                
                if (!tbody) {
                    console.error(' Tbody no encontrado!');
                    return;
                }
                
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #eee';
                row.innerHTML = `
                    <td >
                        <input type="text" class="modern-input item-codigo order-item-codigo" placeholder="Ex: TRI10, DUN16..."  data-item="${contaçãorItens}">
                    </td>
                    <td >
                        <input type="text" class="modern-input item-descricao order-item-produto" placeholder="Produto ser preenchido automaticamente"  data-item="${contaçãorItens}">
                    </td>
                    <td >
                        <input type="number" class="modern-input item-quantidade order-item-qtde" placeholder="Qtde"  min="1" data-item="${contaçãorItens}" value="1">
                    </td>
                    <td >
                        <input type="number" class="modern-input item-valor_unitario order-item-valor-unit" placeholder="0.00"  step="0.01" min="0" data-item="${contaçãorItens}">
                    </td>
                    <td >
                        <input type="number" class="modern-input order-item-valor-total" placeholder="0.00"  step="0.01" reaçãonly data-item="${contaçãorItens}">
                    </td>
                    <td style="text-align: center;">
                        <button type="button" class="btn-remove-item order-item-remove" onclick="removerItem(this)" title="Remover item">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
                
                // Adicionar eventos para o novo item
                adicionarEventosAutocompletar(row);
                adicionarEventosCalculo(row);
                
                console.log(` Item ${contaçãorItens} adicionação`);
                mostrarToast(` Item ${contaçãorItens} adicionação! Digite um cdigo para buscar produto.`, 'success');
                
                // Focar no campo cdigo
                const codigoInput = row.querySelector('.item-codigo');
                if (codigoInput) {
                    setTimeout(() => codigoInput.focus(), 100);
                }
                
                return row;
            }

            // Funo para remover item
            window.removerItem = function(button) {
                const row = button.closest('tr');
                if (row) {
                    row.remove();
                    recalcularTotal();
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Item removido');
                }
            };

            // Funo para recalcular valores
            function adicionarEventosCalculo(row) {
                const qtdeInput = row.querySelector('.order-item-qtde') || row.querySelector('.item-quantidade');
                const valorUnitInput = row.querySelector('.order-item-valor-unit') || row.querySelector('.item-valor_unitario');
                const valorTotalInput = row.querySelector('.order-item-valor-total');
                
                if (!qtdeInput || !valorUnitInput) {
                    console.warn(' Alguns inputs de clculo no foram encontrados', {
                        qtde: !!qtdeInput,
                        valorUnit: !!valorUnitInput,
                        valorTotal: !!valorTotalInput
                    });
                    return;
                }
                
                function calcularTotal() {
                    const qtde = parseFloat(qtdeInput.value) || 0;
                    const valorUnit = parseFloat(valorUnitInput.value) || 0;
                    const total = qtde * valorUnit;
                    
                    if (valorTotalInput) {
                        valorTotalInput.value = total.toFixed(2);
                    }
                    recalcularTotal();
                }
                
                qtdeInput.addEventListener('input', calcularTotal);
                valorUnitInput.addEventListener('input', calcularTotal);
                
                // Trigger initial calculation
                calcularTotal();
            }

            // Funo para recalcular total geral
            function recalcularTotal() {
                const totalInputs = document.querySelectorAll('.order-item-valor-total, .item-total');
                let totalGeral = 0;
                
                totalInputs.forEach(input => {
                    if (input.tagName === 'INPUT') {
                        totalGeral += parseFloat(input.value) || 0;
                    } else {
                        totalGeral += parseFloat(input.textContent) || 0;
                    }
                });
                
                const totalField = document.getElementById('order-valor_total');
                if (totalField) {
                    totalField.value = totalGeral.toFixed(2);
                }
                
                console.log(` Total geral: R$ ${totalGeral.toFixed(2)}`);
            }

            // Funo para buscar produto por cdigo
            async function buscarProduto(codigo) {
                if (!codigo || codigo.length < 2) return null;
                
                try {
                    console.log(` Buscando produto: "${codigo}" em ${produtosCompletos.length} produtos`);
                    
                    // Buscar nos dados locais primeiro
                    const codigoUpper = codigo.toUpperCase().trim();
                    
                    // Primeira tentativa: match exato
                    let produtoLocal = produtosCompletos.find(p => 
                        (p.codigo || '').toUpperCase() === codigoUpper
                    );
                    
                    // Segunda tentativa: comea com o cdigo
                    if (!produtoLocal) {
                        produtoLocal = produtosCompletos.find(p => 
                            (p.codigo || '').toUpperCase().startsWith(codigoUpper)
                        );
                    }
                    
                    // Terceira tentativa: contm o cdigo
                    if (!produtoLocal) {
                        produtoLocal = produtosCompletos.find(p => 
                            (p.codigo || '').toUpperCase().includes(codigoUpper)
                        );
                    }
                    
                    // Quarta tentativa: buscar por nome
                    if (!produtoLocal) {
                        produtoLocal = produtosCompletos.find(p => 
                            (p.nome || '').toUpperCase().includes(codigoUpper)
                        );
                    }
                    
                    if (produtoLocal) {
                        console.log(` Produto encontrado:`, produtoLocal);
                        return {
                            codigo: produtoLocal.codigo,
                            nome: produtoLocal.nome,
                            descricao: produtoLocal.descricao || produtoLocal.nome,
                            preco_unitario: produtoLocal.preco || produtoLocal.preco_unitario || 0,
                            preco_sugerido: produtoLocal.preco || produtoLocal.preco_unitario || 0,
                            preco: produtoLocal.preco || produtoLocal.preco_unitario || 0,
                            variacao: produtoLocal.variacao || '',
                            marca: produtoLocal.marca || '',
                            gtin: produtoLocal.gtin || '',
                            sku: produtoLocal.sku || ''
                        };
                    }
                    
                    console.log(` Produto no encontrado: "${codigo}"`);
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Sugesto: Tente digitar pelo menos 3 caracteres do cdigo');
                    return null;
                    
                } catch (error) {
                    console.error(' Erro ao buscar produto:', error);
                    return null;
                }
            }

            // Funo para mostrar dropdown de sugestes
            function mostrarSugestoes(input, codigo) {
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: mostrarSugestoes chamada com:', codigo);
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Total de produtos disponveis:', produtosCompletos.length);
                
                // Remover dropdown existente antes de criar novo
                const dropdownExistente = input.parentNode.querySelector('.autocomplete-dropdown');
                if (dropdownExistente) {
                    dropdownExistente.remove();
                }
                
                if (produtosCompletos.length === 0) {
                    console.warn(' Array produtosCompletos est vazio!');
                    // Mostrar mensagem ao usurio
                    const dropdown = document.createElement('div');
                    dropdown.className = 'autocomplete-dropdown';
                    dropdown.style.cssText = `
                        position: absolute; top: 100%; left: 0; right: 0;
                        background: white; border: 2px solid #fbbf24; border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000;
                        padding: 12px; color: #92400e; text-align: center;
                    `;
                    dropdown.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Carregando produtos...';
                    input.parentNode.style.position = 'relative';
                    input.parentNode.appendChild(dropdown);
                    return;
                }
                
                if (!codigo || codigo.length < 1) return;
                
                const codigoUpper = codigo.toUpperCase().trim();
                const sugestoes = produtosCompletos.filter(p => {
                    const codigoProduto = (p.codigo || '').toUpperCase();
                    const nomeProduto = (p.nome || '').toUpperCase();
                    return codigoProduto.includes(codigoUpper) || 
                           codigoProduto.startsWith(codigoUpper) ||
                           nomeProduto.includes(codigoUpper);
                }).slice(0, 10);
                
                console.log(` Encontradas ${sugestoes.length} sugestes para "${codigo}"`);
                
                if (sugestoes.length === 0) {
                    // Mostrar mensagem de nenhum resultado
                    const dropdown = document.createElement('div');
                    dropdown.className = 'autocomplete-dropdown';
                    dropdown.style.cssText = `
                        position: absolute; top: 100%; left: 0; right: 0;
                        background: white; border: 2px solid #e5e7eb; border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000;
                        padding: 12px; color: #6b7280; text-align: center;
                    `;
                    dropdown.innerHTML = '<i class="fas fa-search"></i> Nenhum produto encontrado';
                    input.parentNode.style.position = 'relative';
                    input.parentNode.appendChild(dropdown);
                    return;
                }
                
                const dropdown = document.createElement('div');
                dropdown.className = 'autocomplete-dropdown';
                dropdown.style.cssText = `
                    position: absolute; top: 100%; left: 0; right: 0;
                    background: white; border: 2px solid #3b82f6; border-radius: 8px;
                    box-shadow: 0 8px 24px rgba(59,130,246,0.25); z-index: 1000;
                    max-height: 320px; overflow-y: auto;
                `;
                
                sugestoes.forEach(produto => {
                    const item = document.createElement('div');
                    item.style.cssText = `
                        padding: 12px 14px; cursor: pointer; border-bottom: 1px solid #f3f4f6;
                        font-size: 14px; transition: background 0.2s ease;
                    `;
                    
                    const preco = produto.preco || produto.preco_unitario || 0;
                    const variacao = produto.variacao ? `<div style="color: #8b5cf6; font-size: 11px; margin-top: 2px;"> ${produto.variacao}</div>` : '';
                    const precoTexto = preco > 0 ? `<div style="color: #10b981; font-weight: 700; margin-top: 4px;">R$ ${preco.toFixed(2)}</div>` : '';
                    
                    item.innerHTML = `
                        <div style="font-weight: 700; color: #1f2937; font-size: 15px;">${produto.codigo}</div>
                        <div style="color: #6b7280; font-size: 13px; margin-top: 2px;">${produto.nome}</div>
                        ${variacao}
                        ${precoTexto}
                    `;
                    
                    item.addEventListener('mouseenter', () => {
                        item.style.background = '#eff6ff';
                    });
                    
                    item.addEventListener('mouseleave', () => {
                        item.style.background = '';
                    });
                    
                    item.addEventListener('click', () => {
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Produto selecionação do dropdown:', produto);
                        input.value = produto.codigo;
                        dropdown.remove();
                        // Trigger busca automtica
                        setTimeout(() => {
                            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Disparando evento input...');
                            input.dispatchEvent(new Event('input', { bubbles: true }));
                        }, 50);
                    });
                    
                    dropdown.appendChild(item);
                });
                
                // Posicionar dropdown
                input.parentNode.style.position = 'relative';
                input.parentNode.appendChild(dropdown);
                
                // Remover dropdown ao clicar fora
                setTimeout(() => {
                    const removerDropdown = (e) => {
                        if (!dropdown.contains(e.target) && e.target !== input) {
                            dropdown.remove();
                            document.removeEventListener('click', removerDropdown);
                        }
                    };
                    document.addEventListener('click', removerDropdown);
                }, 100);
            }

            // Funo para preenchimento automtico
            function preencherCamposProduto(row, produto) {
                const produtoInput = row.querySelector('.order-item-produto') || row.querySelector('.item-descricao');
                const valorInput = row.querySelector('.order-item-valor-unit') || row.querySelector('.item-valor_unitario');
                
                if (produtoInput) {
                    produtoInput.value = produto.nome || produto.descricao || '';
                    produtoInput.style.background = '#e8f5e8';
                    produtoInput.style.transition = 'background 0.3s ease';
                    setTimeout(() => {
                        produtoInput.style.background = '';
                    }, 2000);
                }
                
                if (valorInput) {
                    const preco = produto.preco_sugerido || produto.preco_unitario || produto.preco || 0;
                    if (preco > 0) {
                        valorInput.value = preco.toFixed(2);
                        valorInput.style.background = '#e8f5e8';
                        valorInput.style.transition = 'background 0.3s ease';
                        setTimeout(() => {
                            valorInput.style.background = '';
                        }, 2000);
                    }
                }
                
                // Preencher variao no campo principal (fora da tabela)
                if (produto.variacao) {
                    const variacaoInput = document.getElementById('order-variacao');
                    if (variacaoInput && !variacaoInput.value) {
                        variacaoInput.value = produto.variacao;
                        variacaoInput.style.background = '#e8f5e8';
                        setTimeout(() => {
                            variacaoInput.style.background = '';
                        }, 2000);
                    }
                }
                
                // Trigger reclculo se tiver quantidade
                const qtdInput = row.querySelector('.order-item-qtde') || row.querySelector('.item-quantidade');
                if (qtdInput && qtdInput.value) {
                    qtdInput.dispatchEvent(new Event('input', { bubbles: true }));
                }
                
                console.log(` Campos preenchidos para: ${produto.codigo} (Variao: ${produto.variacao || 'N/A'})`);
            }

            // Adicionar eventos de autocompletar
            function adicionarEventosAutocompletar(row) {
                const codigoInput = row.querySelector('.order-item-codigo') || row.querySelector('.item-codigo');
                
                if (!codigoInput) {
                    console.warn(' Campo cdigo no encontrado na linha');
                    return;
                }
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Eventos de autocomplete adicionaçãos ao campo:', codigoInput);
                
                let timeoutId;
                
                codigoInput.addEventListener('input', function(e) {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Input digitado:', this.value);
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Produtos disponveis:', produtosCompletos.length);
                    
                    clearTimeout(timeoutId);
                    const codigo = this.value.trim().toUpperCase();
                    
                    // Remover destaque anterior
                    this.style.background = '';
                    this.style.borderColor = '';
                    
                    // Mostrar sugestes em tempo real
                    if (codigo.length >= 1) {
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Mostrando sugestes para:', codigo);
                        mostrarSugestoes(this, codigo);
                    }
                    
                    if (codigo.length >= 2) {
                        // Feedback visual de busca
                        this.style.background = '#fff3cd';
                        this.style.borderColor = '#ffc107';
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Iniciando busca para:', codigo);
                        
                        timeoutId = setTimeout(async () => {
                            const produto = await buscarProduto(codigo);
                            
                            if (produto) {
                                // Sucesso - produto encontrado
                                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Produto encontrado:', produto);
                                this.style.background = '#e8f5e8';
                                this.style.borderColor = '#28a745';
                                preencherCamposProduto(row, produto);
                                
                                // Mostrar toast de sucesso
                                mostrarToast(` ${produto.codigo} - ${produto.nome}`, 'success');
                            } else {
                                // Produto no encontrado
                                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Produto no encontrado:', codigo);
                                this.style.background = '#f8d7da';
                                this.style.borderColor = '#dc3545';
                                
                                setTimeout(() => {
                                    this.style.background = '';
                                    this.style.borderColor = '';
                                }, 3000);
                            }
                        }, 400);
                    }
                });
                
                codigoInput.addEventListener('focus', function() {
                    const codigo = this.value.trim();
                    if (codigo.length >= 2) {
                        mostrarSugestoes(this, codigo);
                    }
                });
                
                codigoInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        this.style.background = '';
                        this.style.borderColor = '';
                    }, 200);
                });
            }

            // Configurar boto "Adicionar Item"
            const btnAdicionarItem = document.getElementById('order-add-item');
            if (btnAdicionarItem) {
                btnAdicionarItem.addEventListener('click', function() {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Adicionando novo item...');
                    adicionarNovoItem();
                });
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Boto "Adicionar Item" configuração');
            } else {
                console.warn(' Boto "Adicionar Item" no encontrado');
            }

            // Observer para novos itens adicionaçãos dinamicamente
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.nodeType === 1 && node.tagName === 'TR') {
                            adicionarEventosAutocompletar(node);
                            adicionarEventosCalculo(node);
                        }
                    });
                });
            });

            // Observar a tabela de produtos
            const tbody = document.getElementById('order-items-tbody');
            if (tbody) {
                observer.observe(tbody, { childList: true });
                
                // Aplicar para itens j existentes
                tbody.querySelectorAll('tr').forEach(row => {
                    adicionarEventosAutocompletar(row);
                    adicionarEventosCalculo(row);
                });
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Sistema de produtos completo inicialização!');
                mostrarToast(' Sistema completo! ' + produtosCompletos.length + ' produtos disponveis', 'success');
                
                // Adicionar primeiro item automaticamente se estiver vazio
                setTimeout(() => {
                    if (tbody.children.length === 0) {
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Adicionando primeiro item automaticamente...');
                        adicionarNovoItem();
                    }
                }, 500);
            } else {
                console.error(' Tbody "order-items-tbody" no encontrado!');
            }
        }

        // Inicializar quando a pgina carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: DOM carregação, iniciando sistema...');
            setTimeout(async () => {
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Timeout executação, carregando produtos...');
                
                // Carregar produtos da API primeiro
                await carregarProdutosDaAPI();
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Produtos aps carregamento:', produtosCompletos.length);
                if (produtosCompletos.length > 0) {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Exemplo do primeiro produto:', produtosCompletos[0]);
                }
                
                // Depois inicializar o sistema de autocomplete
                setupProductAutocomplete();
                setupValidationListeners();
                setupPaymentMethodListeners();
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Sistema totalmente inicialização!');
            }, 1000);
        });
        
        //  FUNO: Configurar listeners para mtodos de pagamento
        function setupPaymentMethodListeners() {
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Configurando listeners de mtodos de pagamento...');
            
            const checkboxes = [
                { checkbox: 'order-metodo_transferencia', percent: 'order-metodo_transferencia_percent' },
                { checkbox: 'order-metodo_deposito', percent: 'order-metodo_deposito_percent' },
                { checkbox: 'order-metodo_faturamento', percent: 'order-metodo_faturamento_percent' }
            ];
            
            checkboxes.forEach(({ checkbox, percent }) => {
                const checkElement = document.getElementById(checkbox);
                const percentElement = document.getElementById(percent);
                
                if (checkElement && percentElement) {
                    // Habilitar/desabilitar campo de percentual quando checkbox  marcado
                    checkElement.addEventListener('change', function() {
                        percentElement.disabled = !this.checked;
                        if (!this.checked) {
                            percentElement.value = '';
                        }
                        calcularTotalMetodosPagamento();
                    });
                    
                    // Recalcular total quando percentual mudar
                    percentElement.addEventListener('input', function() {
                        calcularTotalMetodosPagamento();
                    });
                }
            });
            
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Listeners de mtodos de pagamento configuraçãos');
        }
        
        //  FUNO: Calcular total dos mtodos de pagamento
        function calcularTotalMetodosPagamento() {
            let total = 0;
            
            const metodos = [
                'order-metodo_transferencia_percent',
                'order-metodo_deposito_percent',
                'order-metodo_faturamento_percent'
            ];
            
            metodos.forEach(id => {
                const element = document.getElementById(id);
                if (element && !element.disabled && element.value) {
                    total += parseFloat(element.value) || 0;
                }
            });
            
            const totalDisplay = document.getElementById('order-metodo-total-percent');
            if (totalDisplay) {
                totalDisplay.textContent = total.toFixed(2);
                
                // Adicionar indicaçãor visual se no for 100%
                const container = totalDisplay.closest('div');
                if (total > 0 && total !== 100) {
                    container.style.background = '#fef3c7';
                    container.style.color = '#92400e';
                } else if (total === 100) {
                    container.style.background = '#d1fae5';
                    container.style.color = '#065f46';
                } else {
                    container.style.background = '#f0f9ff';
                    container.style.color = '#0369a1';
                }
            }
            
            return total;
        }
        
        // ==================== SISTEMA DE AUTOCOMPLETE DE VENDEDORES ====================
        
        const vendedoresDisponiveis = [
            'Renata Alvez',
            'Augusto Ladeira',
            'Fabola Souza',
            'Tain Freitas',
            'Ariel Silva',
            'Marcia Scarcella',
            'Andria Trovo',
            'Fabiano Marques'
        ];
        
        function mostrarVendedoresDropdown() {
            const dropdown = document.getElementById('vendedor-dropdown');
            const input = document.getElementById('order-vendedor');
            
            if (!dropdown || !input) return;
            
            // Mostrar todos os vendedores ao focar
            filtrarVendedores('');
            dropdown.style.display = 'block';
        }
        
        function ocultarVendedoresDropdown() {
            const dropdown = document.getElementById('vendedor-dropdown');
            if (dropdown) {
                dropdown.style.display = 'none';
            }
        }
        
        function filtrarVendedores(termo) {
            const dropdown = document.getElementById('vendedor-dropdown');
            const input = document.getElementById('order-vendedor');
            
            if (!dropdown || !input) return;
            
            const termoLower = termo.toLowerCase();
            const vendedoresFiltraçãos = vendedoresDisponiveis.filter(vendedor => 
                vendedor.toLowerCase().includes(termoLower)
            );
            
            // Limpar dropdown
            dropdown.innerHTML = '';
            
            if (vendedoresFiltraçãos.length === 0) {
                dropdown.innerHTML = '<div style="padding: 12px; color: #94a3b8; text-align: center;">Nenhum vendedor encontrado</div>';
                dropdown.style.display = 'block';
                return;
            }
            
            // Adicionar vendedores filtraçãos
            vendedoresFiltraçãos.forEach(vendedor => {
                const item = document.createElement('div');
                item.style.cssText = `
                    padding: 12px 14px;
                    cursor: pointer;
                    border-bottom: 1px solid #f1f5f9;
                    transition: all 0.2s ease;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                `;
                
                item.innerHTML = `
                    <i class="fas fa-user" style="color: #ec4899;"></i>
                    <span style="font-weight: 500; color: #1f2937;">${vendedor}</span>
                `;
                
                item.addEventListener('mouseenter', () => {
                    item.style.background = 'linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%)';
                    item.style.borderLeft = '3px solid #ec4899';
                    item.style.paddingLeft = '11px';
                });
                
                item.addEventListener('mouseleave', () => {
                    item.style.background = '';
                    item.style.borderLeft = '';
                    item.style.paddingLeft = '14px';
                });
                
                item.addEventListener('click', () => {
                    input.value = vendedor;
                    dropdown.style.display = 'none';
                    input.style.background = '#fdf2f8';
                    setTimeout(() => {
                        input.style.background = '';
                    }, 1000);
                });
                
                dropdown.appendChild(item);
            });
            
            dropdown.style.display = 'block';
        }
        
        // ==================== SISTEMA DE AUTOCOMPLETE DE CLIENTES ====================
        
        let clientesCache = [];
        
        async function carregarClientesAutocomplete() {
            try {
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Carregando clientes e empresas para autocomplete...');
                
                // Carregar clientes
                const responseClientes = await fetch('/api/pcp/clienteslimit=500&empresa_id=1');
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Response clientes status:', responseClientes.status);
                
                let clientes = [];
                if (responseClientes.ok) {
                    clientes = await responseClientes.json();
                    console.log(` ${clientes.length} clientes carregaçãos`);
                }
                
                // Carregar empresas (tenta endpoint direto, depois fallback para /api/empresas/buscar)
                let responseEmpresas = null;
                try {
                    responseEmpresas = await fetch('/api/empresaslimit=500');
                } catch (e) {
                    console.warn('Erro ao chamar /api/empresaslimit=500:', e);
                }
                console.log('Response empresas (primary) status:', responseEmpresas && responseEmpresas.status);

                // Fallback para alias mais novo
                if (!responseEmpresas || !responseEmpresas.ok) {
                    try {
                        console.log('Tentando fallback /api/empresas/buscartermo=');
                        responseEmpresas = await fetch('/api/empresas/buscartermo=');
                    } catch (e) {
                        console.warn('Erro no fallback /api/empresas/buscar:', e);
                    }
                }

                let empresas = [];
                if (responseEmpresas && responseEmpresas.ok) {
                    try { empresas = await responseEmpresas.json(); } catch (e) { console.warn('Erro ao parsear JSON de empresas:', e); }
                    console.log(` ${empresas.length} empresas carregadas`);
                } else {
                    console.warn('Nenhuma lista de empresas carregada (responseEmpresas vazio ou no ok)');
                }
                
                // NOVO: Carregar tambm empresas e clientes do mdulo Vendas
                try {
                    const responseVendas = await fetch('/api/vendas/empresaslimit=1000');
                    if (responseVendas.ok) {
                        const empresasVendas = await responseVendas.json();
                        console.log(` ${empresasVendas.length} empresas do Vendas carregadas`);
                        empresas = empresas.concat(empresasVendas);
                    }
                } catch (e) {
                    console.warn(' Erro ao carregar empresas do Vendas:', e);
                }
                
                try {
                    const responseClientesVendas = await fetch('/api/vendas/clienteslimit=1000');
                    if (responseClientesVendas.ok) {
                        const clientesVendas = await responseClientesVendas.json();
                        console.log(` ${clientesVendas.length} clientes do Vendas carregaçãos`);
                        clientes = clientes.concat(clientesVendas);
                    }
                } catch (e) {
                    console.warn(' Erro ao carregar clientes do Vendas:', e);
                }
                
                // Combinar clientes e empresas removendo duplicatas
                const todosClientes = [...clientes, ...empresas];
                const uniqueMap = new Map();
                todosClientes.forEach(cliente => {
                    const key = cliente.cnpj || cliente.cnpj_cpf || cliente.id;
                    if (key && !uniqueMap.has(key)) {
                        uniqueMap.set(key, cliente);
                    }
                });
                
                clientesCache = Array.from(uniqueMap.values());
                console.log(` Total: ${clientesCache.length} registros disponveis`);
                console.log(' Primeiros 3 registros:', clientesCache.slice(0, 3));
                
            } catch (error) {
                console.error(' Erro ao carregar clientes:', error);
            }
        }
        
        function mostrarClientesDropdown() {
            buscarCliente('');
        }
        
        function ocultarClientesDropdown() {
            const dropdown = document.getElementById('cliente-autocomplete');
            if (dropdown) {
                dropdown.style.display = 'none';
            }
        }
        
        function buscarCliente(termo) {
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: buscarCliente chamada com termo:', termo);
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: clientesCache.length:', clientesCache.length);
            
            const dropdown = document.getElementById('cliente-autocomplete');
            if (!dropdown) {
                console.error(' Dropdown cliente-autocomplete no encontrado!');
                return;
            }
            
            const termoLower = termo.toLowerCase();
            const clientesFiltraçãos = clientesCache.filter(cliente => {
                const nome = cliente.nome || cliente.nome_fantasia || cliente.razao_social || '';
                const cnpj = cliente.cnpj || cliente.cnpj_cpf || '';
                return nome.toLowerCase().includes(termoLower) || cnpj.includes(termo);
            }).slice(0, 10); // Limitar a 10 resultados
            
            console.log(` ${clientesFiltraçãos.length} clientes filtraçãos`);
            
            dropdown.innerHTML = '';
            
            if (clientesFiltraçãos.length === 0 && termo) {
                dropdown.innerHTML = '<div style="padding: 12px; color: #94a3b8; text-align: center;">Nenhum cliente encontrado</div>';
                dropdown.style.display = 'block';
                return;
            }
            
            if (clientesFiltraçãos.length === 0 && !termo) {
                dropdown.innerHTML = '<div style="padding: 12px; color: #94a3b8; text-align: center;">Digite para buscar clientes...</div>';
                dropdown.style.display = 'block';
                return;
            }
            
            clientesFiltraçãos.forEach(cliente => {
                const nomeExibir = cliente.nome || cliente.nome_fantasia || cliente.razao_social || 'Sem nome';
                const cnpjExibir = cliente.cnpj || cliente.cnpj_cpf || '';
                
                const item = document.createElement('div');
                item.style.cssText = 'padding: 12px; cursor: pointer; border-bottom: 1px solid #f3f4f6; transition: background 0.2s;';
                item.innerHTML = `
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <div style="font-weight: 700; color: #0ea5e9; font-size: 15px;">${nomeExibir}</div>
                        ${cnpjExibir ? `<div style="color: #64748b; font-size: 13px;">CNPJ: ${cnpjExibir}</div>` : ''}
                    </div>
                `;
                
                item.addEventListener('mouseenter', () => item.style.background = '#f8fafc');
                item.addEventListener('mouseleave', () => item.style.background = '');
                
                item.addEventListener('click', () => {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Cliente/Empresa selecionação:', cliente);
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Estrutura completa do objeto:', JSON.stringify(cliente, null, 2));
                    
                    // Preencher nome
                    const inputCliente = document.getElementById('order-cliente');
                    const inputClienteId = document.getElementById('order-cliente_id');
                    if (inputCliente) {
                        inputCliente.value = nomeExibir;
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Nome preenchido:', nomeExibir);
                    }
                    if (inputClienteId) {
                        inputClienteId.value = cliente.id;
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: ID preenchido:', cliente.id);
                    }
                    
                    // Preencher contato (tentar TODAS as propriedades possveis)
                    const inputContato = document.getElementById('order-contato');
                    if (inputContato) {
                        const contato = cliente.contato || cliente.pessoa_contato || cliente.responsavel || 
                                       cliente.nome_contato || cliente.contact || cliente.contact_name || '';
                        inputContato.value = contato;
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Contato:', contato || '(vazio)');
                        if (contato) {
                            inputContato.style.background = '#e8f5e9';
                            setTimeout(() => inputContato.style.background = '', 1500);
                        }
                    } else {
                        console.error(' Campo order-contato no encontrado!');
                    }
                    
                    // Preencher email (tentar TODAS as propriedades possveis)
                    const inputEmail = document.getElementById('order-email');
                    if (inputEmail) {
                        const email = cliente.email || cliente.email_principal || cliente.email_contato || 
                                     cliente.e_mail || cliente.mail || '';
                        inputEmail.value = email;
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Email:', email || '(vazio)');
                        if (email) {
                            inputEmail.style.background = '#e8f5e9';
                            setTimeout(() => inputEmail.style.background = '', 1500);
                        }
                    } else {
                        console.error(' Campo order-email no encontrado!');
                    }
                    
                    // Preencher telefone (tentar TODAS as propriedades possveis)
                    const inputTelefone = document.getElementById('order-telefone');
                    if (inputTelefone) {
                        const telefone = cliente.telefone || cliente.fone || cliente.celular || 
                                        cliente.telefone_principal || cliente.phone || cliente.tel || '';
                        inputTelefone.value = telefone;
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Telefone:', telefone || '(vazio)');
                        if (telefone) {
                            inputTelefone.style.background = '#e8f5e9';
                            setTimeout(() => inputTelefone.style.background = '', 1500);
                        }
                    } else {
                        console.error(' Campo order-telefone no encontrado!');
                    }
                    
                    // Preencher vendedor se disponvel
                    if (cliente.vendedor_responsavel) {
                        const vendedorInput = document.getElementById('order-vendedor');
                        if (vendedorInput) {
                            vendedorInput.value = cliente.vendedor_responsavel;
                            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Vendedor preenchido:', cliente.vendedor_responsavel);
                        }
                    }
                    
                    dropdown.style.display = 'none';
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Processamento concludo!');
                });
                
                dropdown.appendChild(item);
            });
            
            dropdown.style.display = clientesFiltraçãos.length > 0 ? 'block' : 'none';
        }
        
        // ==================== MELHORAR AUTOCOMPLETE DE PRODUTOS ====================
        
        // Modificar a funo mostrarSugestoes para melhor apresentao
        const mostrarSugestoesOriginal = window.mostrarSugestoes;
        
        function mostrarSugestoesAprimoração(inputElement, codigo) {
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: mostrarSugestoesAprimoração chamada com:', codigo);
            
            if (!codigo || codigo.length < 2) {
                const existingDropdown = inputElement.parentElement.querySelector('.autocomplete-dropdown');
                if (existingDropdown) existingDropdown.remove();
                return;
            }
            
            const codigoLower = codigo.toLowerCase();
            const sugestoes = produtosCompletos.filter(p => 
                p.codigo.toLowerCase().includes(codigoLower) ||
                p.nome.toLowerCase().includes(codigoLower)
            ).slice(0, 8);
            
            console.log(` Encontradas ${sugestoes.length} sugestes para '${codigo}'`);
            
            let dropdown = inputElement.parentElement.querySelector('.autocomplete-dropdown');
            if (!dropdown) {
                dropdown = document.createElement('div');
                dropdown.className = 'autocomplete-dropdown';
                inputElement.parentElement.style.position = 'relative';
                inputElement.parentElement.appendChild(dropdown);
            }
            
            dropdown.innerHTML = '';
            
            if (sugestoes.length === 0) {
                dropdown.innerHTML = '<div style="padding: 12px; color: #94a3b8; text-align: center;">Nenhum produto encontrado</div>';
                dropdown.style.display = 'block';
                return;
            }
            
            sugestoes.forEach(produto => {
                const item = document.createElement('div');
                item.innerHTML = `
                    <div class="produto-info">
                        <div class="produto-codigo">${produto.codigo}</div>
                        <div class="produto-nome">${produto.nome}</div>
                        ${produto.variacao ? `<div class="produto-variacao"><i class="fas fa-palette"></i> ${produto.variacao}</div>` : ''}
                        ${produto.preco ? `<div class="produto-preco">R$ ${parseFloat(produto.preco).toFixed(2)}</div>` : ''}
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    inputElement.value = produto.codigo;
                    
                    // Preencher campos na linha
                    const row = inputElement.closest('tr');
                    if (row) {
                        const produtoInput = row.querySelector('[id^="order-produto-"]');
                        const variacaoInput = row.querySelector('[id^="order-variacao-"]');
                        const valorInput = row.querySelector('[id^="order-valor-unitario-"]');
                        
                        if (produtoInput) produtoInput.value = produto.nome;
                        if (variacaoInput && produto.variacao) variacaoInput.value = produto.variacao;
                        if (valorInput && produto.preco) {
                            valorInput.value = parseFloat(produto.preco).toFixed(2);
                            calcularTotal();
                        }
                    }
                    
                    dropdown.style.display = 'none';
                });
                
                dropdown.appendChild(item);
            });
            
            dropdown.style.display = 'block';
        }
        
        // Substituir a funo global
        window.mostrarSugestoes = mostrarSugestoesAprimoração;
        
        // ==================== ABRIR MODAL NOVA ORDEM ====================
        
        window.abrirModalNovaOrdem = async function() {
            const modal = document.getElementById('order-modal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.zIndex = '99999';
                
                // Carregar clientes para autocomplete
                if (clientesCache.length === 0) {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Carregando clientes...');
                    await carregarClientesAutocomplete();
                }
                
                // Carregar produtos se no estiverem carregaçãos
                if (produtosCompletos.length === 0) {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Carregando produtos...');
                    await carregarProdutosDaAPI();
                }
                
                // Garantir que a tabela tenha pelo menos uma linha
                const tbody = document.getElementById('order-items-tbody');
                if (tbody && tbody.children.length === 0) {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Adicionando primeira linha de produto...');
                    adicionarNovoItem();
                }
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Modal Nova Ordem aberto');
                console.log(` Clientes: ${clientesCache.length}, Produtos: ${produtosCompletos.length}`);
            }
        };
        
        window.fecharModalNovaOrdem = function() {
            const modal = document.getElementById('order-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Modal Nova Ordem fechação');
            }
        };
        
        //  FUNO: Configurar listeners para limpar validao em tempo real
        function setupValidationListeners() {
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Configurando listeners de validao...');
            
            const camposObrigatorios = [
                'order-cliente', 'order-contato', 'order-email', 'order-telefone',
                'order-data_previsao_entrega', 'order-variacao', 'order-embalagem', 'order-lances'
            ];
            
            camposObrigatorios.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    // Limpar erro quando o usurio comear a digitar
                    field.addEventListener('input', function() {
                        clearFieldError(this);
                    });
                    
                    // Limpar erro quando o usurio sair do campo (blur)
                    field.addEventListener('blur', function() {
                        if (this.value.trim()) {
                            clearFieldError(this);
                        }
                    });
                    
                    // Para select, usar evento change
                    if (field.tagName === 'SELECT') {
                        field.addEventListener('change', function() {
                            if (this.value) {
                                clearFieldError(this);
                            }
                        });
                    }
                }
            });
            
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Listeners de validao configuraçãos para', camposObrigatorios.length, 'campos');
        }
        
        //  FUNO: Limpar erro de um campo especfico
        function clearFieldError(field) {
            field.classList.remove('form-error');
            
            // Remover mensagem de erro especfica
            const errorMsg = field.parentNode.querySelector('.error-message');
            if (errorMsg) {
                errorMsg.remove();
            }
            
            // Verificar se ainda h erros - se no, remover o resumo
            setTimeout(() => {
                const remainingErrors = document.querySelectorAll('.form-error');
                if (remainingErrors.length === 0) {
                    const validationSummary = document.querySelector('.validation-summary');
                    if (validationSummary) {
                        validationSummary.remove();
                    }
                }
            }, 100);
        }
        
        // ======================================
        //     FUNES DE VISUALIZAO GRID/LISTA
        // ======================================
        
        let currentView = 'grid'; // Padro  grade
        
        function switchToGridView() {
            currentView = 'grid';
            
            // Atualizar botes
            document.getElementById('btn-view-grid').classList.add('active');
            document.getElementById('btn-view-list').classList.remove('active');
            
            // Atualizar visualizao
            updateMaterialsDisplay();
            
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Visualizao alterada para: Grade');
        }
        
        function switchToListView() {
            currentView = 'list';
            
            // Atualizar botes  
            document.getElementById('btn-view-grid').classList.remove('active');
            document.getElementById('btn-view-list').classList.add('active');
            
            // Atualizar visualizao
            updateMaterialsDisplay();
            
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Visualizao alterada para: Lista');
        }
        
        function updateMaterialsDisplay() {
            const materialsContainer = document.getElementById('materials-container');
            if (!materialsContainer) {
                console.warn(' Container de materiais no encontrado');
                return;
            }
            
            // Simular dados de exemplo (substitua pela sua fonte de dados)
            const materiaisExemplo = [
                { id: 1, codigo: 'MAT001', descricao: 'Material Exemplo 1', categoria: 'Ferramentas', estoque: 10 },
                { id: 2, codigo: 'MAT002', descricao: 'Material Exemplo 2', categoria: 'Eltricos', estoque: 25 }
            ];
            
            if (currentView === 'grid') {
                materialsContainer.innerHTML = renderGridView(materiaisExemplo);
            } else {
                materialsContainer.innerHTML = renderListView(materiaisExemplo);
            }
        }
        
        function renderGridView(materiais) {
            if (!materiais || materiais.length === 0) {
                return '<div class="empty-state"><h3>Nenhum material encontrado</h3><p>Adicione novos materiais para comear.</p></div>';
            }
            
            const cards = materiais.map(material => `
                <div class="material-card">
                    <h3>${material.codigo}</h3>
                    <p><strong>Descrio:</strong> ${material.descricao}</p>
                    <p><strong>Categoria:</strong> ${material.categoria}</p>
                    <p><strong>Estoque:</strong> ${material.estoque} unidades</p>
                    <div class="material-actions">
                        <button class="btn btn-sm btn-editar-prod" onclick="editarMaterial(${material.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-sm btn-excluir-prod" onclick="excluirMaterial(${material.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
            
            return `<div class="materials-grid">${cards}</div>`;
        }
        
        function renderListView(materiais) {
            if (!materiais || materiais.length === 0) {
                return '<div class="empty-state"><h3>Nenhum material encontrado</h3><p>Adicione novos materiais para comear.</p></div>';
            }
            
            const rows = materiais.map(material => `
                <tr>
                    <td>${material.codigo}</td>
                    <td>${material.descricao}</td>
                    <td>${material.categoria}</td>
                    <td>${material.estoque}</td>
                    <td>
                        <button class="btn btn-sm btn-editar-prod" onclick="editarMaterial(${material.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-excluir-prod" onclick="excluirMaterial(${material.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
            
            return `
                <div class="materials-list">
                    <table>
                        <thead>
                            <tr>
                                <th>Cdigo</th>
                                <th>Descrio</th>
                                <th>Categoria</th>
                                <th>Estoque</th>
                                <th>Aes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rows}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        //  CORREO: Funes para controlar modal de novo produto
        window.abrirModalNovoProduto = function() {
            const modal = document.getElementById('modal-novo-produto');
            if (modal) {
                // Remove classe hidden primeiro
                modal.classList.remove('hidden');
                // Aplica estilos inline para garantir visibilidade
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.zIndex = '99999';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.right = '0';
                modal.style.bottom = '0';
                modal.style.background = 'rgba(0,0,0,0.8)';
                modal.style.backdropFilter = 'blur(5px)';
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Modal Novo Produto aberto');
                
                // Limpar formulrio
                const form = document.getElementById('form-novo-produto');
                if (form) form.reset();
            }
        };
        
        window.fecharModalNovoProduto = function() {
            const modal = document.getElementById('modal-novo-produto');
            if (modal) {
                // Adiciona classe hidden
                modal.classList.add('hidden');
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.zIndex = '-1';
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Modal Novo Produto fechação');
            }
        };
        
        // Garantir que o modal esteja oculto ao carregar a pgina
        document.addEventListener('DOMContentLoaded', function() {
            window.fecharModalNovoProduto();
        });
        
        // Funes placeholder para aes (implemente conforme necessrio)
        function editarMaterial(id) {
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Editando material:', id);
            // Implementar lgica de edio
        }
        
        function excluirMaterial(id) {
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Excluindo material:', id);
            // Implementar lgica de excluso
        }
    </script>

    <!-- ========================================= -->
    <!-- MODAIS INDEPENDENTES DO DASHBOARD        -->
    <!-- ========================================= -->
    
    <!-- Modal Profissional para Novo Produto -->
    <div id="modal-novo-produto" class="modal-overlay professional hidden">
        <div class="modal-container professional" >
            <div class="modal-header professional">
                <div class="header-content">
                    <div class="header-icon product">
                        <i class="fas fa-cube"></i>
                    </div>
                    <div class="header-text">
                        <h2>Novo Produto</h2>
                        <p class="header-subtitle">Cadastro completo de produto</p>
                    </div>
                </div>
                <button class="modal-close" onclick="fecharModalNovoProduto()" title="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body professional">
                <form id="form-novo-produto" class="professional-form">
                    <!-- Seo 1: Informaes Bsicas -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon basic">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="section-text">
                                <h3>Informaes Bsicas</h3>
                                <p>Daçãos principais do produto</p>
                            </div>
                        </div>
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="produto-codigo">Cdigo do Produto <span class="required">*</span></label>
                                <input type="text" id="produto-codigo" name="codigo" class="form-input" required>
                                <span class="form-hint">Cdigo nico de identificao</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-descricao">Descrio <span class="required">*</span></label>
                                <input type="text" id="produto-descricao" name="descricao" class="form-input" required>
                                <span class="form-hint">Descrio completa do produto</span>
                            </div>
                        </div>
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="produto-categoria">Categoria</label>
                                <select id="produto-categoria" name="categoria" class="form-input">
                                    <option value="">Selecionar categoria</option>
                                    <option value="cabo_eletrico">Cabo Eltrico</option>
                                    <option value="cabo_telefonia">Cabo Telefonia</option>
                                    <option value="cabo_dados">Cabo de Daçãos</option>
                                    <option value="acessorio">Acessrio</option>
                                    <option value="equipamento">Equipamento</option>
                                    <option value="outros">Outros</option>
                                </select>
                                <span class="form-hint">Categoria do produto</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-unidade">Unidade de Medida <span class="required">*</span></label>
                                <select id="produto-unidade" name="unidade" class="form-input" required>
                                    <option value="">Selecionar unidade</option>
                                    <option value="metro">Metro (m)</option>
                                    <option value="quilometro">Quilmetro (km)</option>
                                    <option value="bobina">Bobina</option>
                                    <option value="rolo">Rolo</option>
                                    <option value="unidade">Unidade</option>
                                    <option value="kit">Kit</option>
                                </select>
                                <span class="form-hint">Unidade para vendas</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seo 2: Especificaes Tcnicas -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon technical">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <div class="section-text">
                                <h3>Especificaes Tcnicas</h3>
                                <p>Caractersticas tcnicas do produto</p>
                            </div>
                        </div>
                        <div class="form-grid three-columns">
                            <div class="form-group">
                                <label for="produto-voltagem">Voltagem (V)</label>
                                <input type="text" id="produto-voltagem" name="voltagem" class="form-input" placeholder="Ex: 750V, 0,6/1KV">
                                <span class="form-hint">Voltagem nominal do produto</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-secao">Seo (mm)</label>
                                <input type="text" id="produto-secao" name="secao" class="form-input" placeholder="Ex: 2,5; 4,0; 6,0">
                                <span class="form-hint">Seo transversal em mm</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-condutor">Material Condutor</label>
                                <select id="produto-condutor" name="condutor" class="form-input">
                                    <option value="">Selecionar material</option>
                                    <option value="cobre">Cobre</option>
                                    <option value="aluminio">Alumnio</option>
                                    <option value="cobre_nu">Cobre Nu</option>
                                    <option value="outros">Outros</option>
                                </select>
                                <span class="form-hint">Material do condutor</span>
                            </div>
                        </div>
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="produto-isolacao">Isolao</label>
                                <input type="text" id="produto-isolacao" name="isolacao" class="form-input" placeholder="Ex: PVC, XLPE, EPR">
                                <span class="form-hint">Material de isolao</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-norma">Norma</label>
                                <input type="text" id="produto-norma" name="norma" class="form-input" placeholder="Ex: NBR 7286, NBR 13248">
                                <span class="form-hint">Norma tcnica aplicvel</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seo 3: Estoque e Preos -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon pricing">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="section-text">
                                <h3>Estoque e Preos</h3>
                                <p>Controle de estoque e valores</p>
                            </div>
                        </div>
                        <div class="form-grid three-columns">
                            <div class="form-group">
                                <label for="produto-quantidade">Quantidade em Estoque</label>
                                <input type="number" id="produto-quantidade" name="quantidade_estoque" class="form-input" min="0" step="0.01" value="0">
                                <span class="form-hint">Quantidade disponvel</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-custo">Custo Unitrio (R$)</label>
                                <input type="number" id="produto-custo" name="custo_unitario" class="form-input" step="0.01" min="0">
                                <span class="form-hint">Custo de produo/aquisio</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-preco">Preo de Venda (R$) <span class="required">*</span></label>
                                <input type="number" id="produto-preco" name="preco_venda" class="form-input" step="0.01" min="0" required>
                                <span class="form-hint">Preo de venda ao cliente</span>
                            </div>
                        </div>
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="produto-fornecedor">Fornecedor Principal</label>
                                <input type="text" id="produto-fornecedor" name="fornecedor" class="form-input">
                                <span class="form-hint">Fornecedor padro</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-peso">Peso (kg/unidade)</label>
                                <input type="number" id="produto-peso" name="peso" class="form-input" step="0.001" min="0">
                                <span class="form-hint">Peso para clculo de frete</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seo 4: Cdigos e Status -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon status">
                                <i class="fas fa-barcode"></i>
                            </div>
                            <div class="section-text">
                                <h3>Cdigos e Status</h3>
                                <p>Identificao e controle</p>
                            </div>
                        </div>
                        <div class="form-grid three-columns">
                            <div class="form-group">
                                <label for="produto-sku">SKU</label>
                                <input type="text" id="produto-sku" name="sku" class="form-input">
                                <span class="form-hint">Stock Keeping Unit</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-gtin">GTIN/EAN</label>
                                <input type="text" id="produto-gtin" name="gtin" class="form-input">
                                <span class="form-hint">Cdigo de barras</span>
                            </div>
                            <div class="form-group">
                                <label for="produto-status">Status</label>
                                <select id="produto-status" name="status" class="form-input">
                                    <option value="ativo">Ativo</option>
                                    <option value="inativo">Inativo</option>
                                    <option value="descontinuação">Descontinuação</option>
                                    <option value="lancamento">Lanamento</option>
                                </select>
                                <span class="form-hint">Status do produto</span>
                            </div>
                        </div>
                        <div class="form-grid full-width">
                            <div class="form-group">
                                <label for="produto-observacoes">Observaes</label>
                                <textarea id="produto-observacoes" name="observacoes" class="form-textarea" rows="3" placeholder="Informaes adicionais sobre o produto..."></textarea>
                                <span class="form-hint">Detalhes importantes ou instrues especiais</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer professional">
                <div class="footer-actions">
                    <button type="button" class="btn-modern secondary" onclick="fecharModalNovoProduto()">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="submit" form="form-novo-produto" class="btn-modern primary">
                        <i class="fas fa-save"></i>
                        Salvar Produto
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Profissional para Novo Material -->
    <div id="modal-novo-material" class="modal-overlay professional hidden">
        <div class="modal-container professional" >
            <div class="modal-header professional">
                <div class="header-content">
                    <div class="header-icon material">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="header-text">
                        <h2>Novo Material</h2>
                        <p class="header-subtitle">Cadastro completo de material</p>
                    </div>
                </div>
                <button class="modal-close" onclick="fecharModalNovoMaterial()" title="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body professional">
                <form id="form-novo-material-modal" class="professional-form">
                    <!-- Seo 1: Informaes Bsicas -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon basic">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="section-text">
                                <h3>Informaes Bsicas</h3>
                                <p>Daçãos principais do material</p>
                            </div>
                        </div>
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="material-codigo">Cdigo do Material <span class="required">*</span></label>
                                <input type="text" id="material-codigo" name="codigo" class="form-input" required>
                                <span class="form-hint">Cdigo nico de identificao</span>
                            </div>
                            <div class="form-group">
                                <label for="material-descricao">Descrio <span class="required">*</span></label>
                                <input type="text" id="material-descricao" name="descricao" class="form-input" required>
                                <span class="form-hint">Descrio completa do material</span>
                            </div>
                        </div>
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="material-categoria">Categoria</label>
                                <select id="material-categoria" name="categoria" class="form-input">
                                    <option value="">Selecionar categoria</option>
                                    <option value="materia_prima">Matria Prima</option>
                                    <option value="componente">Componente</option>
                                    <option value="embalagem">Embalagem</option>
                                    <option value="insumo">Insumo</option>
                                    <option value="ferramenta">Ferramenta</option>
                                    <option value="acabamento">Acabamento</option>
                                </select>
                                <span class="form-hint">Categoria do material</span>
                            </div>
                            <div class="form-group">
                                <label for="material-unidade">Unidade de Medida <span class="required">*</span></label>
                                <select id="material-unidade" name="unidade" class="form-input" required>
                                    <option value="">Selecionar unidade</option>
                                    <option value="UN">Unidade (UN)</option>
                                    <option value="M">Metro (M)</option>
                                    <option value="M2">Metro Quadração (M)</option>
                                    <option value="M3">Metro Cbico (M)</option>
                                    <option value="KG">Quilograma (KG)</option>
                                    <option value="L">Litro (L)</option>
                                    <option value="PC">Pea (PC)</option>
                                    <option value="CX">Caixa (CX)</option>
                                    <option value="ML">Mililitro (ML)</option>
                                    <option value="G">Grama (G)</option>
                                </select>
                                <span class="form-hint">Unidade para controle de estoque</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seo 2: Estoque e Fornecimento -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon stock">
                                <i class="fas fa-warehouse"></i>
                            </div>
                            <div class="section-text">
                                <h3>Estoque e Fornecimento</h3>
                                <p>Controle de estoque e fornecedores</p>
                            </div>
                        </div>
                        <div class="form-grid three-columns">
                            <div class="form-group">
                                <label for="material-estoque-inicial">Estoque Inicial</label>
                                <input type="number" id="material-estoque-inicial" name="estoque_inicial" class="form-input" min="0" value="0" step="0.01">
                                <span class="form-hint">Quantidade inicial em estoque</span>
                            </div>
                            <div class="form-group">
                                <label for="material-estoque-minimo">Estoque Mnimo <span class="required">*</span></label>
                                <input type="number" id="material-estoque-minimo" name="estoque_minimo" class="form-input" required min="0" step="0.01">
                                <span class="form-hint">Quantidade mnima em estoque</span>
                            </div>
                            <div class="form-group">
                                <label for="material-estoque-maximo">Estoque Mximo</label>
                                <input type="number" id="material-estoque-maximo" name="estoque_maximo" class="form-input" min="0" step="0.01">
                                <span class="form-hint">Quantidade mxima em estoque</span>
                            </div>
                        </div>
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="material-fornecedor">Fornecedor Principal</label>
                                <input type="text" id="material-fornecedor" name="fornecedor" class="form-input">
                                <span class="form-hint">Nome do fornecedor principal</span>
                            </div>
                            <div class="form-group">
                                <label for="material-localizacao">Localizao no Estoque</label>
                                <input type="text" id="material-localizacao" name="localizacao" class="form-input" placeholder="Ex: A1-B2-C3">
                                <span class="form-hint">Endereo fsico no estoque</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seo 3: Custos e Preos -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon pricing">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="section-text">
                                <h3>Custos e Preos</h3>
                                <p>Valores e informaes financeiras</p>
                            </div>
                        </div>
                        <div class="form-grid three-columns">
                            <div class="form-group">
                                <label for="material-custo">Custo Unitrio (R$)</label>
                                <input type="number" id="material-custo" name="custo" class="form-input" step="0.01" min="0">
                                <span class="form-hint">Custo de aquisio por unidade</span>
                            </div>
                            <div class="form-group">
                                <label for="material-preco">Preo de Venda (R$)</label>
                                <input type="number" id="material-preco" name="preco" class="form-input" step="0.01" min="0">
                                <span class="form-hint">Preo de venda por unidade</span>
                            </div>
                            <div class="form-group">
                                <label for="material-margem">Margem (%)</label>
                                <input type="number" id="material-margem" name="margem" class="form-input" step="0.01" min="0" reaçãonly>
                                <span class="form-hint">Calculação automaticamente</span>
                            </div>
                        </div>
                    </div>

                    <!-- Seo 4: Informaes Adicionais -->
                    <div class="form-section">
                        <div class="section-header">
                            <div class="section-icon additional">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <div class="section-text">
                                <h3>Informaes Adicionais</h3>
                                <p>Detalhes complementares</p>
                            </div>
                        </div>
                        <div class="form-grid full-width">
                            <div class="form-group">
                                <label for="material-observacoes">Observaes</label>
                                <textarea id="material-observacoes" name="observacoes" class="form-textarea" rows="3" placeholder="Informaes adicionais sobre o material..."></textarea>
                                <span class="form-hint">Detalhes importantes ou instrues especiais</span>
                            </div>
                        </div>
                        <div class="form-grid two-columns">
                            <div class="form-group">
                                <label for="material-status">Status</label>
                                <select id="material-status" name="status" class="form-input">
                                    <option value="ativo">Ativo</option>
                                    <option value="inativo">Inativo</option>
                                    <option value="descontinuação">Descontinuação</option>
                                    <option value="em_analise">Em Anlise</option>
                                </select>
                                <span class="form-hint">Situao atual do material</span>
                            </div>
                            <div class="form-group">
                                <label for="material-criticidade">Criticidade</label>
                                <select id="material-criticidade" name="criticidade" class="form-input">
                                    <option value="baixa">Baixa</option>
                                    <option value="media">Mdia</option>
                                    <option value="alta">Alta</option>
                                    <option value="critica">Crtica</option>
                                </select>
                                <span class="form-hint">Nvel de importncia do material</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer professional">
                <div class="footer-actions">
                    <button type="button" class="btn-modern secondary" onclick="fecharModalNovoMaterial()">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="submit" form="form-novo-material-modal" class="btn-modern primary">
                        <i class="fas fa-save"></i>
                        Salvar Material
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =======================================
        //  FUNES PARA CONTROLE DOS MODAIS
        // =======================================
        
        // Modal Novo Produto
        function abrirModalNovoProduto() {
            const modal = document.getElementById('modal-novo-produto');
            if (modal) {
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                
                // Focar no primeiro campo
                setTimeout(() => {
                    const firstInput = modal.querySelector('#produto-codigo');
                    if (firstInput) firstInput.focus();
                }, 100);
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Modal Novo Produto aberto');
            }
        }
        
        function fecharModalNovoProduto() {
            const modal = document.getElementById('modal-novo-produto');
            if (modal) {
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                
                // Limpar formulrio
                const form = modal.querySelector('#form-novo-produto');
                if (form) form.reset();
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Modal Novo Produto fechação');
            }
        }
        
        // Modal Novo Material
        function abrirModalNovoMaterial() {
            const modal = document.getElementById('modal-novo-material');
            if (modal) {
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                
                // Focar no primeiro campo
                setTimeout(() => {
                    const firstInput = modal.querySelector('#material-codigo');
                    if (firstInput) firstInput.focus();
                }, 100);
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Modal Novo Material aberto');
            }
        }
        
        function fecharModalNovoMaterial() {
            const modal = document.getElementById('modal-novo-material');
            if (modal) {
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                
                // Limpar formulrio
                const form = modal.querySelector('#form-novo-material-modal');
                if (form) form.reset();
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Modal Novo Material fechação');
            }
        }
        
        // =======================================
        //  EVENT LISTENERS PARA OS BOTES
        // =======================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar clientes para autocomplete
            carregarClientesAutocomplete();
            
            // Boto Novo Produto
            const btnNovoProduto = document.getElementById('pcp-new-product');
            if (btnNovoProduto) {
                btnNovoProduto.addEventListener('click', abrirModalNovoProduto);
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Event listener adicionação ao boto Novo Produto');
            }
            
            // Boto Novo Material
            const btnNovoMaterial = document.getElementById('materiais-new');
            if (btnNovoMaterial) {
                btnNovoMaterial.addEventListener('click', abrirModalNovoMaterial);
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Event listener adicionação ao boto Novo Material');
            }
            
            // Fechar modal clicando fora dele
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal-overlay')) {
                    if (e.target.id === 'modal-novo-produto') {
                        fecharModalNovoProduto();
                    } else if (e.target.id === 'modal-novo-material') {
                        fecharModalNovoMaterial();
                    }
                }
            });
            
            // Fechar modal com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modalProduto = document.getElementById('modal-novo-produto');
                    const modalMaterial = document.getElementById('modal-novo-material');
                    
                    if (modalProduto && modalProduto.style.display === 'flex') {
                        fecharModalNovoProduto();
                    } else if (modalMaterial && modalMaterial.style.display === 'flex') {
                        fecharModalNovoMaterial();
                    }
                }
            });
            
            // Funo para calcular margem automaticamente no modal de material
            const custosInput = document.getElementById('material-custo');
            const precoInput = document.getElementById('material-preco');
            const margemInput = document.getElementById('material-margem');
            
            function calcularMargem() {
                const custo = parseFloat(custosInput.value) || 0;
                const preco = parseFloat(precoInput.value) || 0;
                
                if (custo > 0 && preco > 0) {
                    const margem = ((preco - custo) / custo) * 100;
                    margemInput.value = margem.toFixed(2);
                } else {
                    margemInput.value = '';
                }
            }
            
            if (custosInput) custosInput.addEventListener('input', calcularMargem);
            if (precoInput) precoInput.addEventListener('input', calcularMargem);
            
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Sistema de modais inicialização com sucesso!');
        });
        
        // =======================================
        //  FUNES DE SUBMIT DOS FORMULRIOS
        // =======================================
        
        // Submit Novo Produto - Conectação com a API existente
        document.addEventListener('DOMContentLoaded', function() {
            const formNovoProduto = document.getElementById('form-novo-produto');
            if (formNovoProduto) {
                formNovoProduto.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Usar a funo existente do pcp_modern.js que j est conectada com a API
                    if (typeof salvarNovoProduto === 'function') {
                        await salvarNovoProduto();
                    } else {
                        console.error('Funo salvarNovoProduto no encontrada. Verifique se pcp_modern.js foi carregação.');
                        alert('Erro: Sistema de salvamento no est disponvel. Verifique a conexo.');
                    }
                });
            }
            
            // Submit Novo Material - Verso melhorada conectada com a API
            const formNovoMaterial = document.getElementById('form-novo-material-modal');
            if (formNovoMaterial) {
                formNovoMaterial.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const submitBtn = this.querySelector('.btn-modern.primary');
                    const originalText = submitBtn.innerHTML;
                    
                    // Validar campos obrigatrios
                    const codigoInput = document.getElementById('material-codigo');
                    const descricaoInput = document.getElementById('material-descricao');
                    const unidadeInput = document.getElementById('material-unidade');
                    const estoqueInicialInput = document.getElementById('material-estoque-inicial');
                    const estoqueMinimoInput = document.getElementById('material-estoque-minimo');
                    
                    if (!codigoInput.value.trim() || !descricaoInput.value.trim() || !unidadeInput.value || !estoqueMinimoInput.value) {
                        alert('Por favor, preencha todos os campos obrigatrios (Cdigo, Descrio, Unidade e Estoque Mnimo).');
                        return;
                    }
                    
                    // Loading state
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
                    submitBtn.disabled = true;
                    
                    try {
                        // Coletar dados do formulrio
                        const formData = new FormData(this);
                        const materialData = {};
                        
                        for (let [key, value] of formData.entries()) {
                            if (value.trim() !== '') {
                                materialData[key] = value.trim();
                            }
                        }
                        
                        // Converter nmeros
                        ['estoque_inicial', 'estoque_minimo', 'estoque_maximo', 'custo', 'preco'].forEach(field => {
                            if (materialData[field]) {
                                materialData[field] = parseFloat(materialData[field]);
                            }
                        });
                        
                        // Adicionar metadados
                        materialData.data_cadastro = new Date().toISOString();
                        materialData.usuario_cadastro = window.currentUser.nome || 'Sistema';
                        
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Enviando dados do material:', materialData);
                        
                        // Fazer requisio para a API
                        const response = await fetch('/api/pcp/materiais', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(materialData)
                        });
                        
                        if (!response.ok) {
                            const error = await response.text();
                            throw new Error(error || 'Erro ao salvar material');
                        }
                        
                        const novoMaterial = await response.json();
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Material salvo:', novoMaterial);
                        
                        // Sucesso - usar a funo showToast se disponvel
                        if (typeof showToast === 'function') {
                            showToast('Material cadastração com sucesso!', 'success');
                        } else {
                            alert(' Material cadastração com sucesso!');
                        }
                        
                        // Fechar modal e recarregar lista
                        fecharModalNovoMaterial();
                        
                        // Recarregar lista de materiais se a funo existir
                        if (typeof carregarMateriais === 'function') {
                            carregarMateriais();
                        }
                        
                    } catch (error) {
                        console.error(' Erro ao salvar material:', error);
                        
                        if (typeof showToast === 'function') {
                            showToast(`Erro ao salvar material: ${error.message}`, 'error');
                        } else {
                            alert(`Erro ao salvar material: ${error.message}`);
                        }
                    } finally {
                        // Restaurar boto
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                });
            }
        });
    </script>

    <!-- Script de Produo e Faturamento - J CARREGADO NO TOPO -->
    
    <!-- Script para limpar elementos externos do sistema principal -->
    <script>
        // Remover qualquer menu ou overlay que no seja do PCP
        function limparElementosExternos() {
            // Lista de seletores para remover
            const selectorsToRemove = [
                'body > nav:not(.sidebar-nav)',
                'body > aside:not(.sidebar)',
                'body > ul:not(#sidebar ul)',
                'body > .menu-principal',
                'body > .sidebar-sistema',
                'body > .menu-lateral',
                'body > [class*="menu-"]:not(.container-principal *)',
                'body > .overlay:not(.sidebar-overlay)',
                '.menu-overlay'
            ];
            
            selectorsToRemove.forEach(selector => {
                try {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        if (!el.closest('.container-principal')) {
                            el.remove();
                        }
                    });
                } catch (e) {
                    console.log('Seletor invlido:', selector);
                }
            });
        }
        
        // Executar limpeza ao carregar
        document.addEventListener('DOMContentLoaded', limparElementosExternos);
        
        // Observar mudanas no DOM e remover elementos externos
        const observer = new MutationObserver(limparElementosExternos);
        observer.observe(document.body, { 
            childList: true, 
            subtree: false 
        });
    </script>

    <!-- Script para carregar Ordens Recentes no Dashboard -->
    <script>
        // Funo para carregar ordens recentes
        async function refreshRecentOrders() {
            console.log(' Carregando ordens recentes...');
            const container = document.getElementById('monitoring-content');
            const emptyState = document.getElementById('monitoring-empty');
            
            if (!container) return;
            
            try {
                // Mostrar loading
                container.innerHTML = '<div style="text-align:center;padding:20px;"><i class="fas fa-spinner fa-spin"></i> Carregando...</div>';
                emptyState.style.display = 'none';
                
                const response = await fetch('/api/pcp/ordens-producao');
                if (!response.ok) throw new Error('Erro ao carregar ordens');
                
                const ordens = await response.json();
                console.log(` Carregadas ${ordens.length} ordens`);
                
                if (ordens && ordens.length > 0) {
                    // Limitar a 6 ordens mais recentes
                    const ordensRecentes = ordens.slice(0, 6);
                    
                    container.innerHTML = ordensRecentes.map(ordem => `
                        <div class="ordem-item" style="padding:12px; border-bottom:1px solid #e5e7eb; cursor:pointer;">
                            <div style="font-weight:600; color:#1f2937; margin-bottom:4px;">
                                ${ordem.numero || ordem.codigo || 'N/A'}
                            </div>
                            <div style="font-size:13px; color:#6b7280;">
                                ${ordem.cliente || ordem.descricao || 'Cliente no informação'}
                            </div>
                            <div style="font-size:12px; color:#9ca3af; margin-top:4px;">
                                ${ordem.data_criacao  new Date(ordem.data_criacao).toLocaleDateString('pt-BR') : 'Data no informada'}
                            </div>
                        </div>
                    `).join('');
                    emptyState.style.display = 'none';
                } else {
                    container.innerHTML = '';
                    emptyState.style.display = 'flex';
                }
            } catch (error) {
                console.error(' Erro ao carregar ordens:', error);
                container.innerHTML = '<div style="text-align:center;padding:20px;color:#ef4444;">Erro ao carregar ordens</div>';
                emptyState.style.display = 'none';
            }
        }
        
        // Carregar ordens ao inicializar o dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log(' Inicializando dashboard PCP...');
            
            // Carregar ordens recentes
            refreshRecentOrders();
            
            // Recarregar a cada 30 segundos
            setInterval(refreshRecentOrders, 30000);
        });
    </script>

    <!-- Script de integrao e fix para carregamento de dados -->
    <script>
        // Interceptar clique no boto de materiais para forar carregamento
        document.addEventListener('DOMContentLoaded', function() {
            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Configurando integrao de materiais...');
            
            const btnMateriais = document.getElementById('btn-materiais');
            if (btnMateriais) {
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Boto de materiais encontrado');
                
                btnMateriais.addEventListener('click', function(e) {
                    console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Clique no boto de materiais detectado');
                    
                    // Aguardar um pouco para a view ser mostrada
                    setTimeout(function() {
                        console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Disparando carregamento de dados...');
                        
                        if (typeof window.onMateriaisViewShown === 'function') {
                            console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Chamando onMateriaisViewShown()');
                            window.onMateriaisViewShown();
                        } else {
                            console.warn(' onMateriaisViewShown no encontrada, tentando alternativas...');
                            
                            if (typeof window.carregarMateriais === 'function') {
                                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Chamando carregarMateriais()');
                                window.carregarMateriais();
                            }
                            
                            if (typeof window.carregarProdutos === 'function') {
                                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Chamando carregarProdutos()');
                                window.carregarProdutos();
                            }
                        }
                    }, 500);
                });
                
                console.log('SUCCESS:INFO:INIT:INFO:SAVE:REFRESH:DATA:TARGET:WARNING:ERROR:SUCCESS:INFO:DEBUG: Event listener instalação no boto de materiais');
            } else {
                console.warn(' Boto de materiais no encontrado');
            }
        });
    </script>
    
    <!-- ===== CATLOGO DE PRODUTOS - JAVASCRIPT ===== -->
    <script>
        // Variveis globais do catlogo
        let produtosCatalogo = [];
        let produtosFiltraçãos = [];
        let paginaAtual = 1;
        const produtosPorPagina = 12;

        // Carregar catlogo ao clicar no boto
        document.addEventListener('DOMContentLoaded', function() {
            const btnCatalogo = document.getElementById('btn-catalogo-produtos');
            if (btnCatalogo) {
                btnCatalogo.addEventListener('click', function(e) {
                    e.preventDefault();
                    abrirCatalogoProdutos();
                });
            }

            // Event listeners para filtros (adicionar aps elementos serem criados)
            setTimeout(() => {
                const searchInput = document.getElementById('catalogo-search');
                if (searchInput) {
                    searchInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            filtrarCatalogo();
                        }
                    });
                }

                const categoriaFilter = document.getElementById('filter-categoria');
                if (categoriaFilter) {
                    categoriaFilter.addEventListener('change', filtrarCatalogo);
                }

                const estoqueFilter = document.getElementById('filter-estoque');
                if (estoqueFilter) {
                    estoqueFilter.addEventListener('change', filtrarCatalogo);
                }
            }, 500);
        });

        async function abrirCatalogoProdutos() {
            console.log(' Abrindo catlogo de produtos...');
            
            // Esconder todas as views
            document.querySelectorAll('.app-container > div').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Mostrar view do catlogo
            const catalogoView = document.getElementById('catalogo-produtos-view');
            if (catalogoView) {
                catalogoView.classList.remove('hidden');
            }
            
            // Remover active de todos os links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Adicionar active ao link do catlogo
            document.getElementById('btn-catalogo-produtos').classList.add('active');
            
            // Carregar produtos
            await carregarCatalogoProdutos();
        }

        async function carregarCatalogoProdutos(aplicarFiltros = false) {
            const grid = document.getElementById('catalogo-grid');
            
            // Mostrar skeleton loading
            if (grid) {
                grid.innerHTML = criarSkeletonCards();
            }
            
            try {
                console.log(' Carregando produtos do catlogo...');
                const token = localStorage.getItem('token');
                
                // Construir URL com filtros
                let url = '/api/pcp/produtos';
                if (aplicarFiltros) {
                    const params = new URLSearchParams();
                    
                    const search = document.getElementById('catalogo-search').value;
                    const categoria = document.getElementById('filter-categoria').value;
                    const estoque = document.getElementById('filter-estoque').value;
                    
                    if (search) params.append('search', search);
                    if (categoria && categoria !== 'todas') params.append('categoria', categoria);
                    if (estoque) {
                        // Mapear valores do frontend para backend
                        const estoqueMap = {
                            'disponivel': 'com-estoque',
                            'baixo': 'baixo',
                            'zeração': 'zeração'
                        };
                        params.append('estoque', estoqueMap[estoque] || estoque);
                    }
                    
                    const queryString = params.toString();
                    if (queryString) {
                        url += '' + queryString;
                    }
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                if (!response.ok) throw new Error('Erro ao carregar produtos');

                const result = await response.json();
                produtosCatalogo = Array.isArray(result)  result : (result.produtos || result.data || []);
                produtosFiltraçãos = [...produtosCatalogo];
                
                console.log(' Produtos carregaçãos:', produtosCatalogo.length);
                
                // Atualizar estatsticas (usar do servidor se disponvel)
                if (result.stats) {
                    document.getElementById('catalogo-total-produtos').textContent = result.stats.total_produtos || 0;
                    document.getElementById('catalogo-com-estoque').textContent = result.stats.com_estoque || 0;
                    document.getElementById('catalogo-estoque-baixo').textContent = result.stats.estoque_baixo || 0;
                    document.getElementById('catalogo-com-ean').textContent = result.stats.com_ean || 0;
                } else {
                    atualizarEstatisticasCatalogo();
                }
                
                // Renderizar produtos
                renderizarCatalogo();
                
            } catch (error) {
                console.error(' Erro ao carregar catlogo:', error);
                mostrarErroCatalogo('Erro ao carregar produtos. Tente novamente.');
            }
        }

        function criarSkeletonCards() {
            const skeletons = Array.from({ length: 12 }, (_, i) => `
                <div class="produto-card skeleton-card">
                    <div class="produto-image skeleton" style="height: 200px; width: 100%;"></div>
                    <div class="produto-content" style="padding: 16px;">
                        <div class="skeleton skeleton-title"></div>
                        <div class="skeleton skeleton-text" style="width: 40%; margin-top: 8px;"></div>
                        <div style="margin-top: 16px;">
                            <div class="skeleton skeleton-text" style="width: 80%;"></div>
                            <div class="skeleton skeleton-text" style="width: 60%; margin-top: 8px;"></div>
                        </div>
                    </div>
                </div>
            `).join('');
            return skeletons;
        }

        function atualizarEstatisticasCatalogo() {
            const total = produtosCatalogo.length;
            const comEstoque = produtosCatalogo.filter(p => (p.estoque_atual || 0) > 0).length;
            const estoqueBaixo = produtosCatalogo.filter(p => (p.estoque_atual || 0) > 0 && (p.estoque_atual || 0) < 10).length;
            const comEAN = produtosCatalogo.filter(p => p.gtin || p.ean13).length;

            document.getElementById('catalogo-total-produtos').textContent = total;
            document.getElementById('catalogo-com-estoque').textContent = comEstoque;
            document.getElementById('catalogo-estoque-baixo').textContent = estoqueBaixo;
            document.getElementById('catalogo-com-ean').textContent = comEAN;
        }

        function renderizarCatalogo() {
            const grid = document.getElementById('catalogo-grid');
            if (!grid) return;

            if (produtosFiltraçãos.length === 0) {
                grid.innerHTML = `
                    <div class="loading-catalogo">
                        <i class="fas fa-inbox" style="font-size: 64px; color: #cbd5e1; margin-bottom: 16px;"></i>
                        <p>Nenhum produto encontrado</p>
                    </div>
                `;
                return;
            }

            // Calcular paginao
            const inicio = (paginaAtual - 1) * produtosPorPagina;
            const fim = inicio + produtosPorPagina;
            const produtosPagina = produtosFiltraçãos.slice(inicio, fim);

            grid.innerHTML = produtosPagina.map(produto => criarCardProduto(produto)).join('');
            
            // Atualizar paginao
            renderizarPaginacao();
        }

        function criarCardProduto(produto) {
            const estoque = produto.estoque_atual || 0;
            const estoqueClass = estoque === 0 ? 'zeração' : estoque < 10 ? 'baixo' : 'disponivel';
            const estoqueLabel = estoque === 0 ? 'Sem Estoque' : estoque < 10 ? 'Estoque Baixo' : 'Disponvel';
            
            const categoria = produto.categoria || 'Sem Categoria';
            const ean = produto.gtin || produto.ean13 || 'N/A';
            const sku = produto.sku || 'N/A';
            const ncm = produto.ncm || 'N/A';
            const imagem = produto.imagem_url || '';

            return `
                <div class="produto-card" onclick="visualizarProdutoDetalhes(${produto.id})">
                    <div class="produto-image">
                        ${imagem ? `<img src="${imagem}" alt="${produto.nome}" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-box produto-image-placeholder\\'></i>'">` : '<i class="fas fa-box produto-image-placeholder"></i>'}
                        <span class="produto-badge-estoque badge-${estoqueClass}">${estoqueLabel}</span>
                    </div>
                    <div class="produto-content">
                        <div class="produto-header">
                            <h3 class="produto-nome">${produto.nome || 'Produto sem nome'}</h3>
                            <span class="produto-categoria">${categoria}</span>
                        </div>
                        <div class="produto-codes">
                            <div class="code-item">
                                <span class="code-label">EAN-13</span>
                                <span class="code-value">${ean}</span>
                            </div>
                            <div class="code-item">
                                <span class="code-label">SKU</span>
                                <span class="code-value">${sku}</span>
                            </div>
                            <div class="code-item">
                                <span class="code-label">NCM</span>
                                <span class="code-value">${ncm}</span>
                            </div>
                            <div class="code-item">
                                <span class="code-label">Cdigo</span>
                                <span class="code-value">${produto.codigo || 'N/A'}</span>
                            </div>
                        </div>
                        <div class="produto-footer">
                            <div class="produto-estoque">
                                <span class="estoque-label">Estoque</span>
                                <span class="estoque-value">${estoque}</span>
                            </div>
                            <div class="produto-actions">
                                <button class="btn-produto-action btn-view" onclick="event.stopPropagation(); visualizarProdutoDetalhes(${produto.id})" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-produto-action btn-edit" onclick="event.stopPropagation(); editarProdutoCatalogo(${produto.id})" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function filtrarCatalogo() {
            // Recarregar com filtros aplicaçãos (server-side filtering)
            paginaAtual = 1;
            await carregarCatalogoProdutos(true);
        }

        async function limparFiltrosCatalogo() {
            document.getElementById('catalogo-search').value = '';
            document.getElementById('filter-categoria').value = '';
            document.getElementById('filter-estoque').value = '';
            paginaAtual = 1;
            await carregarCatalogoProdutos(false);
        }

        function renderizarPaginacao() {
            const totalPaginas = Math.ceil(produtosFiltraçãos.length / produtosPorPagina);
            const paginationContainer = document.getElementById('catalogo-pagination');
            
            if (totalPaginas <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let html = `
                <button class="pagination-btn" onclick="mudarPagina(${paginaAtual - 1})" ${paginaAtual === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;

            for (let i = 1; i <= totalPaginas; i++) {
                if (i === 1 || i === totalPaginas || (i >= paginaAtual - 2 && i <= paginaAtual + 2)) {
                    html += `
                        <button class="pagination-btn ${i === paginaAtual ? 'active' : ''}" onclick="mudarPagina(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === paginaAtual - 3 || i === paginaAtual + 3) {
                    html += '<span class="pagination-info">...</span>';
                }
            }

            html += `
                <button class="pagination-btn" onclick="mudarPagina(${paginaAtual + 1})" ${paginaAtual === totalPaginas ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;

            paginationContainer.innerHTML = html;
        }

        function mudarPagina(novaPagina) {
            const totalPaginas = Math.ceil(produtosFiltraçãos.length / produtosPorPagina);
            if (novaPagina < 1 || novaPagina > totalPaginas) return;
            
            paginaAtual = novaPagina;
            renderizarCatalogo();
            
            // Scroll para o topo
            document.getElementById('catalogo-produtos-view').scrollIntoView({ behavior: 'smooth' });
        }

        function visualizarProdutoDetalhes(produtoId) {
            const produto = produtosCatalogo.find(p => p.id === produtoId);
            if (!produto) return;

            console.log(' Visualizando produto:', produto);
            
            // Abrir modal de visualizao (implementao futura ou usar modal existente)
            alert(`Produto: ${produto.nome}\\nEAN-13: ${produto.gtin || 'N/A'}\\nSKU: ${produto.sku || 'N/A'}\\nNCM: ${produto.ncm || 'N/A'}\\nEstoque: ${produto.estoque_atual || 0}`);
        }

        function editarProdutoCatalogo(produtoId) {
            const produto = produtosCatalogo.find(p => p.id === produtoId);
            if (!produto) return;

            console.log(' Editando produto:', produto);
            
            // Abrir modal de edio (implementao futura ou usar modal existente)
            alert('Funcionalidade de edio ser implementada em breve');
        }

        function exportarCatalogoPDF() {
            console.log(' Exportando catlogo em PDF...');
            alert('Exportao em PDF ser implementada em breve');
        }

        function exportarCatalogoExcel() {
            console.log(' Exportando catlogo em Excel...');
            alert('Exportao em Excel ser implementada em breve');
        }

        function mostrarErroCatalogo(mensagem) {
            const grid = document.getElementById('catalogo-grid');
            if (!grid) return;

            grid.innerHTML = `
                <div class="loading-catalogo" style="color: #ef4444;">
                    <i class="fas fa-exclamation-circle" style="font-size: 64px; margin-bottom: 16px;"></i>
                    <p>${mensagem}</p>
                    <button class="btn-catalogo primary" onclick="carregarCatalogoProdutos()" style="margin-top: 16px;">
                        <i class="fas fa-redo"></i> Tentar Novamente
                    </button>
                </div>
            `;
        }
    </script>

    <!-- Aplicaçãor de Tema Premium - J CARREGADO NO TOPO -->

    <!-- ===== SISTEMA DE SINCRONIZAO EM TEMPO REAL ===== -->
    <link rel="stylesheet" href="css/realtime-sync.css">
    <script src="js/realtime-sync.js"></script>
    
    <!-- Indicaçãor de conexo em tempo real -->
    <div id="realtime-indicator" class="connected" title="Sincronização em tempo real ativa">
        <i class="fas fa-sync-alt"></i>
    </div>

        </div> <!-- Fecha main-area -->
    </div> <!-- Fecha app-container --></body>
</html>

